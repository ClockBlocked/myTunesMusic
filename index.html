<!DOCTYPE html>
<html lang="en" class="dim">
<head>
    <!-- External Dependencies -->
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ytdl-core@4.11.2/dist/ytdl-core.min.js"></script>
    
    <!-- Meta Tags -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MyBeats™</title>
    <meta name="description" content="Stream & share your favourite music for free." />
    <meta name="keywords" content="music, player, web, audio, streaming, playlist, songs, albums, artists, videos, sharing, media, radio, pop, hiphop, country, dance, party, dubstep, alternative, rock, free, forever" />
    <meta name="author" content="ClockBlocked" />
    <meta name="theme-color" content="#1f2329" />

    <!-- SEO Meta Tags -->
    <meta property="og:title" content="MyBeats™ - Stream & Share Music" />
    <meta property="og:description" content="A sleek and modern web-based music player." />
    <meta property="og:image" content="thumbnail.jpg" />
    <meta property="og:url" content="https://koders.cloud" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="MyBeats™ - Stream & Share Music" />
    <meta name="twitter:description" content="A sleek and modern web-based music player." />
    <meta name="twitter:image" content="thumbnail.jpg" />

    <!-- PWA Configuration -->
    <link rel="manifest" href="./system/manifest.json" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="apple-touch-icon" href="apple-touch-icon.png" />

    <!-- Assets -->
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="./styleSheets/main.css" />
    <link rel="stylesheet" href="./dynamicOverlays.css">
    <link href="https://dev.wuaze.com/styleSheets/fonts.css" rel="stylesheet" />
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/preline@2.0.3/dist/preline.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css" />

    <!-- Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-P0KCT8TSPW"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      gtag("js", new Date());
      gtag("config", "G-P0KCT8TSPW");
    </script>
    

</head>

<body>
    <!-- Hidden YouTube Player -->
    <div id="youtube-audio-wrapper" style="position: absolute; left: -9999px;">
      <div id="youtube-player"></div>
    </div>

<!-- Remove Later -->  
    <button id="theme-toggle" style="opacity: 0; pointer-events: none; z-index: -9999999999999;">
    </button>
<!------------>  
    
    
    
    
    <!-- Main Page Wrapper -->
    <div id="pageWrapper">
      <!-- Theme Toggle Component -->
      <div class="theme-toggle-container">
        <div class="theme-trigger">
          <svg width="24" height="24" viewBox="0 0 24 24">
            <path fill="currentColor" d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121z"/>
          </svg>
        </div>
        <div class="theme-options">
          <button data-theme="light" aria-label="Light theme">
            <svg width="20" height="20" viewBox="0 0 24 24">
              <path fill="currentColor" d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121z"/>
            </svg>
          </button>
          <button data-theme="dim" aria-label="Dim theme">
            <svg width="20" height="20" viewBox="0 0 24 24">
              <path fill="currentColor" d="M9.822 2.238a9 9 0 0 0 11.94 11.94C20.768 18.654 16.775 22 12 22 6.477 22 2 17.523 2 12c0-4.775 3.346-8.768 7.822-9.762zm8.342.053L19 2.5v1l-.836.209a2 2 0 0 0-1.455 1.455L16.5 6h-1l-.209-.836a2 2 0 0 0-1.455-1.455L13 3.5v-1l.836-.209A2 2 0 0 0 15.291.836L15.5 0h1l.209.836a2 2 0 0 0 1.455 1.455zm5 5L24 7.5v1l-.836.209a2 2 0 0 0-1.455 1.455L21.5 11h-1l-.209-.836a2 2 0 0 0-1.455-1.455L18 8.5v-1l.836-.209a2 2 0 0 0 1.455-1.455L20.5 5h1l.209.836a2 2 0 0 0 1.455 1.455z"/>
            </svg>
          </button>
          <button data-theme="dark" aria-label="Dark theme">
            <svg width="20" height="20" viewBox="0 0 24 24">
              <path fill="currentColor" d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1-8.313-12.454z"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Navigation Bar -->
      <nav id="navbar" class="glass-effect">
        <div class="navbar-content">
          <div class="navbar-left">
            <button class="menu-trigger" id="menu-trigger" title="Menu">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>

<div class="navbar-center" id="now-playing-area" title="Click to open Now Playing">
  <div class="now-playing-display">

    <div id="navbar-album-cover" class="flex items-center justify-center relative">
      <svg class="w-6 h-6 text-white transition-opacity duration-500 ease-in-out" fill="currentColor" viewBox="0 0 20 20">
        <path d="M18 3a1 1 0 00-1.196-.98l-10 2A1 1 0 006 5v9.114A4.369 4.369 0 005 14c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V7.82l8-1.6v5.894A4.369 4.369 0 0015 12c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V3z" />
      </svg>
      
      <img src="" alt="Album Cover" class="absolute inset-0 w-full h-full object-cover opacity-0 transition-opacity duration-500 ease-in-out" />
    </div>

    <div class="now-playing-info">
      <div id="navbar-song-title" class="truncate">No song playing</div>
      <div id="navbar-artist" class="truncate">Select a song to get started</div>
    </div>

    <div class="play-indicator" id="play-indicator"></div>
  </div>
</div>

          <div class="navbar-right">
            <div class="nav-controls">
              <button class="nav-control-btn" id="prev-btn-navbar" title="Previous Track">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M8.445 14.832A1 1 0 0010 14v-2.798l5.445 3.63A1 1 0 0017 14V6a1 1 0 00-1.555-.832L10 8.798V6a1 1 0 00-1.555-.832l-6 4a1 1 0 000 1.664l6 4z" />
                </svg>
              </button>

              <button class="nav-control-btn play-pause" id="play-pause-navbar" title="Play/Pause">
                <svg id="play-icon-navbar" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                </svg>
                <svg id="pause-icon-navbar" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
              </button>

              <button class="nav-control-btn" id="next-btn-navbar" title="Next Track">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M4.555 5.168A1 1 0 003 6v8a1 1 0 001.555.832L10 11.202V14a1 1 0 001.555.832l6-4a1 1 0 000-1.664l-6-4A1 1 0 0010 6v2.798L4.555 5.168z" />
                </svg>
              </button>
            </div>

          </div>
        </div>
      </nav>

      <!-- Dropdown Menu -->
      <div class="dropdown-menu" id="dropdown-menu">
        <div class="dropdown-header">
          <h3 class="dropdown-title">Music Library</h3>
          <button class="dropdown-close" id="dropdown-close">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
          </button>
        </div>

        <div class="dropdown-section">
          <h4 class="section-title">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" />
            </svg>
            Favorites
          </h4>

          <div class="dropdown-item" id="favorite-songs">
            <div class="dropdown-item-icon">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <div class="dropdown-item-content">
              <div class="dropdown-item-title">Favorite Songs</div>
              <div class="dropdown-item-subtitle">Your liked tracks</div>
            </div>
            <div class="dropdown-item-badge" id="favorite-songs-count">0</div>
          </div>

          <div class="dropdown-item" id="favorite-artists">
            <div class="dropdown-item-icon">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9 12a3 3 0 00-3-3H2a1 1 0 100 2h4a1 1 0 011 1v.5a1 1 0 102 0V12zm3-8a3 3 0 100 6 3 3 0 000-6zm-1 4a1 1 0 11-2 0 1 1 0 012 0z" />
              </svg>
            </div>
            <div class="dropdown-item-content">
              <div class="dropdown-item-title">Favorite Artists</div>
              <div class="dropdown-item-subtitle">Artists you follow</div>
            </div>
            <div class="dropdown-item-badge" id="favorite-artists-count">0</div>
          </div>
        </div>

        <div class="dropdown-section">
          <h4 class="section-title">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
            </svg>
            Library
          </h4>

          <div class="dropdown-item" id="recently-played">
            <div class="dropdown-item-icon">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
              </svg>
            </div>
            <div class="dropdown-item-content">
              <div class="dropdown-item-title">Recent Plays</div>
              <div class="dropdown-item-subtitle">Recently played songs</div>
            </div>
            <div class="dropdown-item-badge" id="recent-count">0</div>
          </div>

          <div class="dropdown-item" id="queue-view">
            <div class="dropdown-item-icon">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" />
              </svg>
            </div>
            <div class="dropdown-item-content">
              <div class="dropdown-item-title">Up Next</div>
              <div class="dropdown-item-subtitle">Songs in queue</div>
            </div>
            <div class="dropdown-item-badge" id="queue-count">0</div>
          </div>
        </div>

        <div class="dropdown-section">
          <h4 class="section-title">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
            </svg>
            Playlists
          </h4>

          <div class="dropdown-item" id="create-playlist">
            <div class="dropdown-item-icon">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
              </svg>
            </div>
            <div class="dropdown-item-content">
              <div class="dropdown-item-title">Create Playlist</div>
              <div class="dropdown-item-subtitle">Make a new playlist</div>
            </div>
          </div>

          <div id="playlists-list">
            <div class="empty-state" id="playlists-empty">
              <div class="empty-state-icon">
                <svg class="w-full h-full" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
                </svg>
              </div>
              <div class="empty-state-text">
                No playlists yet.<br />
                Create your first playlist!
              </div>
            </div>
          </div>
        </div>

        <div class="dropdown-section">
          <h4 class="section-title">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z" />
            </svg>
            Actions
          </h4>

          <div class="dropdown-item" id="shuffle-all">
            <div class="dropdown-item-icon">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
              </svg>
            </div>
            <div class="dropdown-item-content">
              <div class="dropdown-item-title">Shuffle All</div>
              <div class="dropdown-item-subtitle">Play all songs randomly</div>
            </div>
          </div>
        </div>

        <div class="dropdown-section">
          <h4 class="section-title">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
            </svg>
            Settings
          </h4>

          <div class="dropdown-item" id="app-settings">
            <div class="dropdown-item-icon">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
              </svg>
            </div>
            <div class="dropdown-item-content">
              <div class="dropdown-item-title">Preferences</div>
              <div class="dropdown-item-subtitle">App settings & options</div>
            </div>
          </div>

          <div class="dropdown-item" id="about-app">
            <div class="dropdown-item-icon">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
              </svg>
            </div>
            <div class="dropdown-item-content">
              <div class="dropdown-item-title">About</div>
              <div class="dropdown-item-subtitle">Version & information</div>
            </div>
          </div>
        </div>
      </div>

<!-- Music Player -->
<style>
.musicPlayer {
  position: fixed;
  bottom: 6rem;
  left: 50%;
  transform: translateX(-50%);
  width: 90vw;
  height: 70vh;
  background: var(--background-400);
  backdrop-filter: var(--blur-lg);
  border-radius: 10px;
  border: 1px solid var(--border-200);
  color: var (--text-200);
  box-shadow: var(--shadow-2xl);
  z-index: var(--z-player);
  transition: var(--transition-smooth);
  overflow: hidden;
}

.musicPlayer.hidden {
  transform: translateX(-50%) translateY(100%);
  opacity: 0;
  pointer-events: none;
}




.musicPlayer > .handle {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-sm) 0;
  cursor: grab;
  transition: var(--transition-fast);
}

.musicPlayer > .handle:active {
  cursor: grabbing;
  background: var(--background-400);
}

.musicPlayer > .handle .grip {
  width: 40px;
  height: 4px;
  background: var(--text-400);
  border-radius: var(--radius-full);
  transition: var(--transition-fast);
}

.musicPlayer > .handle:hover .grip {
  background: var(--text-300);
  width: 50px;
}




.musicPlayer > .header {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  padding: var(--space-md) var(--space-lg) var(--space-sm);
  /**
  background: var(--background-200);
  border-bottom: 1px solid var(--border-200);
  **/
}

.musicPlayer > .header .close {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--background-400);
  border: none;
  border-radius: var(--radius-md);
  color: var(--text-300);
  cursor: pointer;
  transition: var(--transition-fast);
}

.musicPlayer > .header .close:hover {
  background: var(--accent-danger);
  color: var(--text-on-accent);
  transform: scale(1.05);
}

.musicPlayer > .header .close .icon {
  width: 16px;
  height: 16px;
}




.musicPlayer > .body {
  position: relative;
  padding: var(--space-lg);
  /**
  background: var(--background-300);
  **/
  max-height: 60vh;
  overflow-y: auto;
}

.musicPlayer > .body .content {
  display: none;
  animation: fadeIn 0.3s ease-out;
}

.musicPlayer > .body .content.active {
  display: block;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}




.musicPlayer > .body .cover {
  width: 100%;
  max-width: 280px;
  aspect-ratio: 1;
  object-fit: cover;
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-xl);
  margin: 0 auto var(--space-xl);
  display: block;
  background: var(--background-500);
  border: 1px solid var(--border-300);
}

.musicPlayer > .body .info {
  text-align: center;
  margin-bottom: var(--space-xl);
}

.musicPlayer > .body .info .title {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--text-100);
  margin-bottom: var(--space-xs);
  line-height: 1.3;
}

.musicPlayer > .body .info .artist {
  font-size: 1rem;
  color: var(--accent-primary);
  font-weight: 600;
  margin-bottom: var(--space-xs);
}

.musicPlayer > .body .info .album {
  font-size: 0.875rem;
  color: var(--text-300);
  font-weight: 500;
}




.musicPlayer > .body .progress {
  margin-bottom: var(--space-xl);
}

.musicPlayer > .body .progress .time {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-sm);
  font-size: 0.875rem;
  color: var(--text-300);
  font-weight: 500;
}

.musicPlayer > .body .progress .bar {
  height: 6px;
  background: var(--background-600);
  border-radius: var(--radius-full);
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

.musicPlayer > .body .progress .fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent-primary), var(--accent-purple));
  border-radius: var(--radius-full);
  position: relative;
  transition: width 0.1s ease-out;
}

.musicPlayer > .body .progress .thumb {
  position: absolute;
  right: -6px;
  top: 50%;
  transform: translateY(-50%);
  width: 12px;
  height: 12px;
  background: var(--text-100);
  border-radius: 50%;
  box-shadow: var(--shadow-md);
  opacity: 0;
  transition: var(--transition-fast);
}

.musicPlayer > .body .progress .bar:hover .thumb {
  opacity: 1;
}




.musicPlayer > .body .controls {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-md);
  margin-bottom: var(--space-xl);
}

.musicPlayer > .body .controls .btn {
  width: 38px;
  height: 38px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--background-400);
  border: none;
  border-radius: var(--radius-full);
  color: var(--text-200);
  cursor: pointer;
  transition: var(--transition-fast);
  border: 1px solid var(--border-200);
}

.musicPlayer > .body .controls .btn:hover {
  background: var(--background-500);
  transform: scale(1.05);
  color: var(--text-100);
  border-color: var(--border-300);
}

.musicPlayer > .body .controls .btn.primary {
  width: 45px;
  height: 45px;
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-purple));
  color: var(--text-on-accent);
  border-color: transparent;
  box-shadow: var(--shadow-lg);
}

.musicPlayer > .body .controls .btn.primary:hover {
  transform: scale(1.08);
  box-shadow: var(--shadow-xl);
}

.musicPlayer > .body .controls .btn .icon {
  width: 20px;
  height: 20px;
  fill: currentColor;
}

.musicPlayer > .body .controls .btn.primary .icon {
  width: 24px;
  height: 24px;
}

.musicPlayer > .body .controls .btn .icon.pause {
  display: none;
}

.musicPlayer > .body .controls .btn.playing .icon.play {
  display: none;
}

.musicPlayer > .body .controls .btn.playing .icon.pause {
  display: block;
}




.musicPlayer > .body .actions {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-md);
}

.musicPlayer > .body .actions .action {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  border-radius: var(--radius-md);
  color: var(--text-300);
  cursor: pointer;
  transition: var(--transition-fast);
}

.musicPlayer > .body .actions .action:hover {
  background: var(--background-400);
  color: var(--text-100);
  transform: scale(1.05);
}

.musicPlayer > .body .actions .action.active {
  background: var(--accent-primary);
  color: var(--text-on-accent);
}

.musicPlayer > .body .actions .action .icon {
  width: 16px;
  height: 16px;
  fill: currentColor;
}




.musicPlayer > .body .list {
  list-style: none;
  padding: 0;
  margin: 0;
  max-height: 300px;
  overflow-y: auto;
}

.musicPlayer > .body .list::-webkit-scrollbar {
  width: 6px;
}

.musicPlayer > .body .list::-webkit-scrollbar-track {
  background: var(--background-400);
  border-radius: var(--radius-full);
}

.musicPlayer > .body .list::-webkit-scrollbar-thumb {
  background: var(--background-600);
  border-radius: var(--radius-full);
}

.musicPlayer > .body .list::-webkit-scrollbar-thumb:hover {
  background: var(--background-700);
}

.musicPlayer > .body .empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--space-2xl);
  text-align: center;
}

.musicPlayer > .body .emptyIcon {
  width: 48px;
  height: 48px;
  color: var(--text-400);
  margin-bottom: var(--space-md);
  opacity: 0.7;
}

.musicPlayer > .body .emptyIcon .icon {
  width: 100%;
  height: 100%;
}

.musicPlayer > .body .emptyText {
  color: var(--text-300);
  font-size: 0.95rem;
  font-weight: 500;
}




.musicPlayer > .footer {
  /**
  background: var(--background-200);
  border-top: 1px solid var(--border-200);
  **/
  padding: var(--space-sm);
}

.musicPlayer > .footer .tabs {
  display: flex;
  /**
  background: var(--background-300);
  border-radius: var(--radius-lg);
  **/
  padding: var(--space-xs);
  gap: var(--space-xs);
}

.musicPlayer > .footer .tab {
  flex: 1;
  padding: var(--space-sm) var(--space-md);
  background: transparent;
  border-bottom: 2px solid transparent;
  
  color: var(--text-300);
  font-size: 0.875rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition-fast);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.musicPlayer > .footer .tab:hover {
  border-bottom: 2px solid var(--background-400);
  color: var(--text-200);
}

.musicPlayer > .footer .tab.active {
  border-bottom: 2px solid var(--accent-primary);
  color: var(--text-on-accent);

}




@media (max-width: 480px) {
  .musicPlayer {
    width: 90vw;
    border-radius: 0;
    border-left: none;
    border-right: none;
  }
  
  .musicPlayer > .body {
    padding: var(--space-md);
  }
  
  .musicPlayer > .body .controls {
    gap: var(--space-md);
  }
  
  .musicPlayer > .body .controls .btn {
    width: 30px;
    height: 30px;
  }
  
  .musicPlayer > .body .controls .btn.primary {
    width: 40px;
    height: 40px;
  }
  
  .musicPlayer > .body .actions {
    gap: var(--space-sm);
  }
  
  .musicPlayer > .body .actions .action {
    width: 25px;
    height: 25px;
  }
  
  .musicPlayer > .footer .tab {
    font-size: 0.8rem;
    padding: var(--space-xs) var(--space-sm);
  }
}

@media (max-width: 360px) {
  .musicPlayer > .body .controls .btn .icon {
    width: 18px;
    height: 18px;
  }
  
  .musicPlayer > .body .controls .btn.primary .icon {
    width: 20px;
    height: 20px;
  }
  
  .musicPlayer > .body .actions .action .icon {
    width: 14px;
    height: 14px;
  }
}




button:focus-visible {
  outline: 2px solid var(--accent-primary);
  outline-offset: 2px;
}

button:focus {
  outline: none;
}

.musicPlayer::-webkit-scrollbar {
  width: 6px;
}

.musicPlayer::-webkit-scrollbar-track {
  background: var(--background-400);
}

.musicPlayer::-webkit-scrollbar-thumb {
  background: var(--background-600);
  border-radius: var(--radius-full);
}

.musicPlayer::-webkit-scrollbar-thumb:hover {
  background: var(--background-700);
}

@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
</style>
<div class="musicPlayer" id="musicPlayer">
  <div class="handle" id="handle">
    <div class="grip"></div>
  </div>

  <div class="header">
    <button class="close" id="closeBtn">
      <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
      </svg>
    </button>
  </div>

  <div class="body">
    <!-- Now Playing -->
    <div class="content active" data-tab="playing">
      <img id="cover" src="" alt="Album Cover" class="cover" />

      <div class="info">
        <h4 id="title" class="title"></h4>
        <p id="artist" class="artist"></p>
        <p id="album" class="album"></p>
      </div>

      <div class="progress">
        <div class="time">
          <span id="current">0:00</span>
          <span id="total">0:00</span>
        </div>
        <div class="bar" id="progressBar">
          <div class="fill" id="progressFill" style="width: 0%;">
            <div class="thumb" id="progressThumb"></div>
          </div>
        </div>
      </div>

      <div class="controls">
        <button class="btn" id="prevBtn">
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
            <path d="M267.5 440.6c9.5 7.9 22.8 9.7 34.1 4.4s18.4-16.6 18.4-29V96c0-12.4-7.2-23.7-18.4-29s-24.5-3.6-34.1 4.4L75.5 231l0 49 192 160z" />
          </svg>
        </button>

        <button class="btn" id="rewindBtn">
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
            <path d="M459.5 440.6c9.5 7.9 22.8 9.7 34.1 4.4s18.4-16.6 18.4-29V96c0-12.4-7.2-23.7-18.4-29s-24.5-3.6-34.1 4.4L288 214.3V296l171.5 144.6zM256 352V96c0-12.4-7.2-23.7-18.4-29s-24.5-3.6-34.1 4.4L11.5 231C4.2 237.5 0 246.5 0 256s4.2 18.5 11.5 24.6l192 160c9.5 7.9 22.8 9.7 34.1 4.4s18.4-16.6 18.4-29V352z" />
          </svg>
        </button>

        <button class="btn primary" id="playBtn">
          <svg class="icon play" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
            <path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z" />
          </svg>
          
          <svg class="icon pause" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
            <path d="M48 64C21.5 64 0 85.5 0 112L0 400c0 26.5 21.5 48 48 48l32 0c26.5 0 48-21.5 48-48l0-288c0-26.5-21.5-48-48-48L48 64zm192 0c-26.5 0-48 21.5-48 48l0 288c0 26.5 21.5 48 48 48l32 0c26.5 0 48-21.5 48-48l0-288c0-26.5-21.5-48-48-48l-32 0z" />
          </svg>
        </button>

        <button class="btn" id="forwardBtn">
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
            <path d="M52.5 440.6c-9.5 7.9-22.8 9.7-34.1 4.4S0 428.4 0 416V96c0-12.4 7.2-23.7 18.4-29s24.5-3.6 34.1 4.4L224 214.3V296L52.5 440.6zM256 352V96c0-12.4 7.2-23.7 18.4-29s24.5-3.6 34.1 4.4l192 160c7.3 6.1 11.5 15.1 11.5 24.6s-4.2 18.5-11.5 24.6L308.5 440.6c-9.5 7.9-22.8 9.7-34.1 4.4S256 428.4 256 416V352z" />
          </svg>
        </button>

        <button class="btn" id="nextBtn">
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
            <path d="M52.5 440.6c-9.5 7.9-22.8 9.7-34.1 4.4S0 428.4 0 416V96c0-12.4 7.2-23.7 18.4-29s24.5-3.6 34.1 4.4l192 160V96c0-17.7 14.3-32 32-32s32 14.3 32 32v320c0 17.7-14.3 32-32 32s-32-14.3-32-32V271.4L52.5 440.6z" />
          </svg>
        </button>
      </div>

      <div class="actions">
        <button class="action" id="favoriteBtn" title="Add to Favorites">
          <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
            <path d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" />
          </svg>
        </button>

        <button class="action" id="queueBtn" title="View Queue">
          <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
            <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
          </svg>
        </button>

        <button class="action" id="shareBtn" title="Share">
          <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
            <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z" />
          </svg>
        </button>

        <button class="action" id="moreBtn" title="More Options">
          <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Queue -->
    <div class="content" data-tab="queue">
      <ul id="queueList" class="list">
        <div class="empty">
          <div class="emptyIcon">
            <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
              <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
            </svg>
          </div>
          <div class="emptyText">Queue is empty.</div>
        </div>
      </ul>
    </div>

    <!-- Recent -->
    <div class="content" data-tab="recent">
      <ul id="recentList" class="list">
        <div class="empty">
          <div class="emptyIcon">
            <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
              <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
            </svg>
          </div>
          <div class="emptyText">No recently played songs.</div>
        </div>
      </ul>
    </div>
  </div>
  
  <!-- Tabs -->
  <div class="footer">
    <div class="tabs">
      <button class="tab active" data-tab="playing">Now Playing</button>
      <button class="tab" data-tab="recent">Recent Plays</button>
      <button class="tab" data-tab="queue">Up Next</button>
    </div>
  </div>
</div>

      <!-- Main Content Area -->
      <div id="mainArea">
        <main id="main-container" class="content-container max-w-6xl mx-auto pb-24">
          <div id="contentWrapper" class="relative">
            <nav id="breadcrumb-nav" class="breadcrumb-navigation flex items-center text-fg-muted">
              <ol class="breadcrumb-list flex items-center flex-wrap"></ol>
            </nav>

            <div id="dynamic-content" class="mx-auto max-w-2xl px-6 lg:max-w-7xl lg:px-8">
              <div class="text-center py-8 md:py-12">
                <h1 class="text-4xl md:text-5xl font-bold mb-6 gradient-text">Discover Amazing Music</h1>
                <p class="text-lg md:text-xl text-gray-400 mb-8 md:mb-12 max-w-2xl mx-auto">Explore artists, albums, and songs from your personal library with an immersive listening experience</p>
              </div>
              
              <h4 class="text-2xl md:text-3xl font-bold mb-6 md:mb-8 px-4 font-semibold text-indigo-600">Featured Artists</h4>
              
              <div id="featured-artists" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-8 px-4"></div>
            </div>

            <div id="content-loading" class="absolute inset-0 bg-bg-default bg-opacity-80 backdrop-blur-sm flex items-center justify-center hidden">
              <div class="loading-animation">
                <div class="spinner-container">
                  <div class="spinner"></div>
                </div>
                <p class="mt-4 text-fg-muted">Loading content...</p>
              </div>
            </div>
          </div>
        </main>
      </div>

      <!-- Floating Action Button -->
      <button class="floating-add-button" id="floating-add-button" title="Create Playlist">
        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
        </svg>
      </button>

      <!-- Popover Portal -->
      <div id="popover-portal" class="popover-portal"></div>

      <!-- PWA Install Banner -->
      <div id="pwa-install-banner" class="fixed bottom-0 end-0 z-60 sm:max-w-sm w-full mx-auto p-6 opacity-0 pointer-events-none transition-all duration-300">
        <div class="p-4 bg-white border border-gray-200 rounded-xl shadow-2xs dark:bg-neutral-900 dark:border-neutral-800 flex gap-x-4">
          <svg class="shrink-0 w-8 h-auto" width="72" height="63" viewBox="0 0 72 63" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15.5174 56.1528C16.2903 57.6825 16.929 61.4559 14.8118 60.9459C13.5013 60.5381 11.4445 57.6213 12.493 56.1528C12.661 55.8468 13.2189 55.2757 14.106 55.4389" stroke="currentColor" class="dark:stroke-neutral-200" stroke-width="2" stroke-linecap="round"/>
            <path d="M15.5173 49.6263L14.0262 48.5579C13.5346 48.2056 12.8477 48.3707 12.658 48.945C12.3456 49.8907 12.1258 51.1463 12.462 52.2324C12.5336 52.4636 12.7127 52.6466 12.9449 52.7146C13.8342 52.9751 15.2568 52.9048 15.8197 51.054" stroke="currentColor" class="dark:stroke-neutral-200" stroke-width="2" stroke-linecap="round"/>
            <ellipse cx="51.2061" cy="22.3973" rx="3.02446" ry="3.05945" fill="currentColor" class="text-gray-800 dark:fill-neutral-200"/>
          </svg>
          <div class="grow">
            <p class="text-sm text-gray-800 dark:text-neutral-200">
              Open in the app, or 
              <a id="pwa-download-link" class="inline-flex items-center gap-x-1.5 text-blue-600 decoration-2 hover:underline font-medium dark:text-blue-500" href="#">
                Install App
              </a>
            </p>
          </div>
          <div>
            <button id="pwa-dismiss" type="button" class="p-2 inline-flex items-center gap-x-2 text-sm font-semibold rounded-full border border-transparent text-gray-500 hover:bg-gray-50 focus:outline-hidden focus:bg-gray-50 dark:text-neutral-400 dark:hover:bg-neutral-700 dark:focus:bg-neutral-700">
              <span class="sr-only">Dismiss</span>
              <svg class="shrink-0 size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- External Scripts -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/preline@2.0.3/dist/preline.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tippy.js@6.3.7/dist/tippy.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    
    <!-- MyTunes Debug Script - Professional debugging utilities -->
    <script src="./siteScripts/utilities/debugScript.js"></script>

    <script src="./dynamicOverlays.js"></script>

    <!-- Inline Scripts -->
    <script>
      // Theme Toggle Functionality
      document.addEventListener('DOMContentLoaded', () => {
        const container = document.querySelector('.theme-toggle-container');
        const trigger = document.querySelector('.theme-trigger');
        const themeButtons = document.querySelectorAll('.theme-options button');
        const html = document.documentElement;
        
        // Set initial theme from localStorage or default
        const savedTheme = localStorage.getItem('theme') || 'dark';
        html.setAttribute('data-theme', savedTheme);
        
        // Set active button
        themeButtons.forEach(btn => {
          btn.classList.toggle('active', btn.dataset.theme === savedTheme);
          
          btn.addEventListener('click', () => {
            const theme = btn.dataset.theme;
            html.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            
            // Update button states
            themeButtons.forEach(b => b.classList.toggle('active', b === btn));
            
            // Close the menu after selection
            container.classList.remove('active');
          });
        });
        
        // Toggle menu
        trigger.addEventListener('click', (e) => {
          e.stopPropagation();
          container.classList.toggle('active');
        });
        
        // Close when clicking outside
        document.addEventListener('click', () => {
          container.classList.remove('active');
        });
      });

      // Breadcrumb Navigation Intersection Observer
      document.addEventListener("DOMContentLoaded", function () {
        let nav = document.querySelector(".breadcrumb-navigation");
        let artistTop = document.querySelector(".artistTop");

        if (nav && artistTop) {
          let observer = new IntersectionObserver(
            function (entries) {
              entries.forEach(function (entry) {
                nav.classList.toggle("stuck", !entry.isIntersecting);
                artistTop.classList.toggle("stuck", !entry.isIntersecting);
              });
            },
            {
              threshold: 0,
              rootMargin: "-1px 0px 0px 0px",
            }
          );

          observer.observe(artistTop);
        }
      });

      // Music Player Toggle
      const triggerEl = document.getElementById("now-playing-area");
      const closePlayerEl = document.getElementById("closePlayer");
      const musicPlayer = document.querySelector(".musicPlayer");

      triggerEl.addEventListener("click", () => {
        musicPlayer.classList.toggle("show");
      });

      closePlayerEl.addEventListener("click", () => {
        musicPlayer.classList.remove("show");
      });

      // PWA Installation Banner
      let deferredPrompt;
      const banner = document.getElementById("pwa-install-banner");
      const installLink = document.getElementById("pwa-download-link");
      const dismissBtn = document.getElementById("pwa-dismiss");

      window.addEventListener("beforeinstallprompt", e => {
        e.preventDefault();
        deferredPrompt = e;
        showPWABanner();
      });

      function showPWABanner() {
        banner.style.opacity = "1";
        banner.style.pointerEvents = "auto";
        banner.classList.remove("translate-y-5");
      }

      function hidePWABanner() {
        banner.style.opacity = "0";
        banner.style.pointerEvents = "none";
      }

      installLink.addEventListener("click", async e => {
        e.preventDefault();
        hidePWABanner();
        if (deferredPrompt) {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          console.log(`User response to the install prompt: ${outcome}`);
          deferredPrompt = null;
        }
      });

      dismissBtn.addEventListener("click", hidePWABanner);

      window.addEventListener("DOMContentLoaded", () => {
        if (window.matchMedia("(display-mode: standalone)").matches) {
          console.log("App running in standalone mode.");
        } else if ("getInstalledRelatedApps" in navigator) {
          navigator.getInstalledRelatedApps().then(relatedApps => {
            if (relatedApps.length > 0) {
              console.log("PWA installed.");
              showPWABanner();
            } else {
              console.log("PWA not installed.");
            }
          });
        }
      });

      // Service Worker Registration
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("./system/serviceWorker.js")
            .then(registration => {
              console.log("Service Worker registered:", registration.scope);
            })
            .catch(err => {
              console.error("Service Worker registration failed:", err);
            });
        });
      }

      // Eruda Dev Tools Initialization
      eruda.init();

      // Create a custom Eruda tool for live CSS editing
      eruda.add({
        name: "Live CSS",
        init($el) {
          $el.html(`
            <textarea id="liveCssArea" style="width:100%;height:200px;"></textarea>
            <button id="applyCssBtn">Apply CSS</button>
          `);

          let styleTag = document.createElement("style");
          document.head.appendChild(styleTag);

          $el.on("click", "#applyCssBtn", () => {
            styleTag.innerHTML = document.getElementById("liveCssArea").value;
          });
        },
        show() {},
        hide() {},
      });

      // Floating UI Components (Tooltips, Popovers, Dropdowns)
      (function () {
        // Hide / then Kill Component
        function killAllFloating() {
          document.querySelectorAll(".gh-floating").forEach((el) => el.remove());
        }

        window.GHUI = window.GHUI || {}; // Global use
        window.GHUI.killAllFloating = killAllFloating;

        // Create the element
        function createFloating(content, type = "tooltip") {
          const el = document.createElement("div");
          el.classList.add("gh-floating");
          if (type === "dropdown") el.classList.add("gh-dropdown");
          el.innerHTML = content;
          document.body.appendChild(el);
          return el;
        }
        
        // Determine when & where to render it
        function placeFloating(trigger, floating) {
          const rect = trigger.getBoundingClientRect();
          const floatRect = floating.getBoundingClientRect();
          let top, left, placement = "top";

          if (rect.top > floatRect.height + 10) {
            top = window.scrollY + rect.top - floatRect.height - 12;
            left = window.scrollX + rect.left + rect.width / 2 - floatRect.width / 2;
            placement = "top";
          } else if (window.innerHeight - rect.bottom > floatRect.height + 10) {
            top = window.scrollY + rect.bottom + 12;
            left = window.scrollX + rect.left + rect.width / 2 - floatRect.width / 2;
            placement = "bottom";
          } else if (rect.left > floatRect.width + 10) {
            top = window.scrollY + rect.top + rect.height / 2 - floatRect.height / 2;
            left = window.scrollX + rect.left - floatRect.width - 12;
            placement = "left";
          } else {
            top = window.scrollY + rect.top + rect.height / 2 - floatRect.height / 2;
            left = window.scrollX + rect.right + 12;
            placement = "right";
          }

          floating.style.top = `${Math.max(4, top)}px`;
          floating.style.left = `${Math.max(4, left)}px`;
          floating.setAttribute("data-placement", placement);
        }

        // ToolTip Functionality
        document.addEventListener(
          "mouseenter",
          function (e) {
            const el = e.target.closest("[data-tooltip]");
            if (!el) return;
            let floating = null;
            const content = el.getAttribute("data-tooltip");
            floating = createFloating(content, "tooltip");
            placeFloating(el, floating);
            requestAnimationFrame(() => floating.setAttribute("data-show", "true"));

            // Click inside tooltip on "More options…" to expand
            floating.addEventListener("click", (ev) => {
              const expandTrigger = ev.target.closest("[data-expand]");
              if (expandTrigger) {
                ev.stopPropagation();
                floating.classList.add("gh-expanded");
                // Replace content or append extra options
                floating.innerHTML = `
                  <div style="padding:4px 0;">
                    <div style="font-weight:bold;margin-bottom:4px;">${el.dataset.album || "Album"}</div>
                    <div class="gh-separator"></div>
                    <div style="padding:6px;">Option A</div>
                    <div style="padding:6px;">Option B</div>
                    <div style="padding:6px;">Option C</div>
                  </div>
                `;
                placeFloating(el, floating); // re-position after size change
              }
            });

            el.addEventListener(
              "mouseleave",
              () => {
                if (floating && !floating.classList.contains("gh-expanded")) {
                  floating.remove();
                  floating = null;
                }
              },
              { once: true }
            );

            window.addEventListener("scroll", () => {
              if (floating) placeFloating(el, floating);
            });
            window.addEventListener("resize", () => {
              if (floating) placeFloating(el, floating);
            });
          },
          true
        );

        // DropDown Menus Functionality
        document.addEventListener(
          "click",
          function (e) {
            const el = e.target.closest("[data-dropdown]");
            if (!el) return;
            e.stopPropagation();
            killAllFloating(); // CLOSE ANY EXISTING FLOATERS FIRST
            const html = el.querySelector("template")?.innerHTML || "";
            const floating = createFloating(html, "dropdown");
            placeFloating(el, floating);
            requestAnimationFrame(() => floating.setAttribute("data-show", "true"));

            floating.addEventListener("mouseenter", () => {
              clearTimeout(floating._hideTimer);
            });
            floating.addEventListener("mouseleave", () => {
              floating._hideTimer = setTimeout(() => {
                floating.remove();
              }, 200);
            });
          },
          true
        );

        // When to hide / then kill the components
        document.addEventListener("click", () => killAllFloating());
      })();
    </script>
    
    
    
    
    <script>
document.addEventListener("DOMContentLoaded", function() {
  const trigger = document.getElementById("menu-trigger");
  const dropdown = document.getElementById("dropdown-menu");

  if (trigger && dropdown) {
    trigger.addEventListener("click", function() {
      dropdown.classList.toggle("show");
    });
  }
});
</script>



















<!--

<script type="module">
import { music } from './modules/library.js';
const state = {
    currentSong: null,
    isPlaying: false,
    queue: [],
    recentlyPlayed: [],
    favorites: new Set(),
    audioElement: null,
    initialized: false,
    autoPlayEnabled: true
};

function initializeApp() {
    console.log("🚀 Initializing MyTunes...");
    
    try {
        if (!state.audioElement) {
            state.audioElement = new Audio();
            state.audioElement.addEventListener('play', () => {
                state.isPlaying = true;
                updatePlayButtons();
            });
            state.audioElement.addEventListener('pause', () => {
                state.isPlaying = false;
                updatePlayButtons();
            });
        }
        
        setTimeout(() => {
            bindAllEvents();
            loadHomePage();
            
            window.music = music;
            window.playSong = playSong;
            window.togglePlayPause = togglePlayPause;
            window.nextTrack = nextTrack;
            window.previousTrack = previousTrack;
            window.getAlbumImageUrl = getAlbumImageUrl;
            window.formatTime = formatTime;
            
            state.initialized = true;
            console.log("✅ MyTunes initialized successfully!");
        }, 200);
        
    } catch (error) {
        console.error("❌ Initialization failed:", error);
    }
}

function bindAllEvents() {
    console.log("🔗 Binding events...");
    
    const menuTrigger = document.getElementById('menu-trigger');
    if (menuTrigger) {
        const newMenuTrigger = menuTrigger.cloneNode(true);
        menuTrigger.parentNode.replaceChild(newMenuTrigger, menuTrigger);
        
        newMenuTrigger.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log("🔧 Menu trigger clicked!");
            toggleDropdownMenu();
        });
        console.log("✅ Menu trigger bound");
    } else {
        console.log("❌ Menu trigger not found");
    }

    const dropdownClose = document.getElementById('dropdown-close');
    if (dropdownClose) {
        dropdownClose.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log("🔧 Dropdown close clicked!");
            closeDropdownMenu();
        });
    }

    const nowPlayingArea = document.getElementById('now-playing-area');
    if (nowPlayingArea) {
        const newNowPlayingArea = nowPlayingArea.cloneNode(true);
        nowPlayingArea.parentNode.replaceChild(newNowPlayingArea, nowPlayingArea);
        
        newNowPlayingArea.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log("🔧 Now playing area clicked!");
            toggleMusicPlayer();
        });
        console.log("✅ Now playing area bound");
    } else {
        console.log("❌ Now playing area not found");
    }

    const closePlayer = document.getElementById('closePlayer');
    if (closePlayer) {
        closePlayer.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log("🔧 Close player clicked!");
            closeMusicPlayer();
        });
    }

    const playPauseNavbar = document.getElementById('play-pause-navbar');
    if (playPauseNavbar) {
        playPauseNavbar.addEventListener('click', function(e) {
            e.stopPropagation();
            e.preventDefault();
            console.log("🔧 Navbar play/pause clicked!");
            togglePlayPause();
        });
        console.log("✅ Navbar play/pause bound");
    }

    const prevBtn = document.getElementById('prev-btn-navbar');
    const nextBtn = document.getElementById('next-btn-navbar');
    if (prevBtn) {
        prevBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            e.preventDefault();
            console.log("🔧 Navbar previous clicked!");
            previousTrack();
        });
    }
    if (nextBtn) {
        nextBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            e.preventDefault();
            console.log("🔧 Navbar next clicked!");
            nextTrack();
        });
    }

    bindMenuItems();

    setTimeout(() => {
        bindPopupEvents();
    }, 500);

    document.addEventListener('click', function(e) {
        const dropdownMenu = document.getElementById('dropdown-menu');
        const menuTrigger = document.getElementById('menu-trigger');
        const musicPlayer = document.querySelector('.musicPlayer');
        const nowPlayingArea = document.getElementById('now-playing-area');
        
        if (dropdownMenu && !dropdownMenu.contains(e.target) && !menuTrigger?.contains(e.target)) {
            closeDropdownMenu();
        }
    });

    document.addEventListener('keydown', handleKeyboard);

    console.log("✅ All events bound");
}

function bindMenuItems() {
    const menuItems = {
        'shuffle-all': function() {
            console.log("🔧 Shuffle all clicked!");
            shuffleAllSongs();
        },
        'create-playlist': function() {
            console.log("🔧 Create playlist clicked!");
            createPlaylist();
        },
        'favorite-songs': function() {
            console.log("🔧 Favorite songs clicked!");
            openFavorites();
        },
        'recently-played': function() {
            console.log("🔧 Recently played clicked!");
            openMusicPlayer();
            setTimeout(() => switchTab('recent'), 100);
        },
        'queue-view': function() {
            console.log("🔧 Queue view clicked!");
            openMusicPlayer();
            setTimeout(() => switchTab('queue'), 100);
        }
    };

    Object.entries(menuItems).forEach(([id, handler]) => {
        const element = document.getElementById(id);
        if (element) {
            element.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                handler();
                closeDropdownMenu();
            });
            console.log(`✅ Menu item bound: ${id}`);
        } else {
            console.log(`❌ Menu item not found: ${id}`);
        }
    });
}

function bindPopupEvents() {
    document.querySelectorAll('.popup-tab').forEach(tab => {
        tab.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            switchTab(tab.dataset.tab);
        });
    });

    const popupControls = {
        'popup-play-pause-btn': togglePlayPause,
        'popup-prev-btn': previousTrack,
        'popup-next-btn': nextTrack,
        'popup-shuffle-btn': toggleShuffle,
        'popup-repeat-btn': toggleRepeat,
        'popup-favorite-btn': toggleFavorite
    };

    Object.entries(popupControls).forEach(([id, handler]) => {
        const element = document.getElementById(id);
        if (element) {
            element.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                handler();
            });
            console.log(`✅ Popup control bound: ${id}`);
        } else {
            console.log(`⚠️ Popup control not found: ${id} (may load later)`);
        }
    });
}

function toggleDropdownMenu() {
    console.log("📋 Toggle dropdown menu");
    const dropdown = document.getElementById('dropdown-menu');
    const trigger = document.getElementById('menu-trigger');
    
    if (dropdown && trigger) {
        const isOpen = dropdown.classList.contains('show');
        console.log(`Dropdown currently ${isOpen ? 'open' : 'closed'}`);
        
        if (isOpen) {
            dropdown.classList.remove('show');
            trigger.classList.remove('active');
            console.log("✅ Dropdown closed");
        } else {
            dropdown.classList.add('show');
            trigger.classList.add('active');
            updateDropdownCounts();
            console.log("✅ Dropdown opened");
        }
    } else {
        console.log("❌ Dropdown elements not found");
    }
}

function closeDropdownMenu() {
    console.log("📋 Close dropdown menu");
    const dropdown = document.getElementById('dropdown-menu');
    const trigger = document.getElementById('menu-trigger');
    
    if (dropdown) dropdown.classList.remove('show');
    if (trigger) trigger.classList.remove('active');
}

function toggleMusicPlayer() {
    console.log("🎶 Toggle music player");
    const player = document.querySelector('.musicPlayer');
    
    if (player) {
        const isOpen = player.classList.contains('show');
        console.log(`Music player currently ${isOpen ? 'open' : 'closed'}`);
        
        if (isOpen) {
            player.classList.remove('show');
            console.log("✅ Music player closed");
        } else {
            player.classList.add('show');
            updatePopupContent();
            console.log("✅ Music player opened");
        }
    } else {
        console.log("❌ Music player not found");
    }
}

function openMusicPlayer() {
    console.log("🎶 Open music player");
    const player = document.querySelector('.musicPlayer');
    
    if (player) {
        player.classList.add('show');
        updatePopupContent();
        console.log("✅ Music player opened");
    } else {
        console.log("❌ Music player not found");
    }
}

function closeMusicPlayer() {
    console.log("🎶 Close music player");
    const player = document.querySelector('.musicPlayer');
    
    if (player) {
        player.classList.remove('show');
        console.log("✅ Music player closed");
    }
}

function playSong(songData, autoTriggered = false) {
    if (!songData) return;
    
    if (autoTriggered && !state.autoPlayEnabled) {
        console.log("🚫 Auto-play disabled, not playing song");
        return;
    }
    
    console.log(`🎵 Playing: ${songData.title} by ${songData.artist}`);
    
    state.currentSong = songData;
    
    if (state.recentlyPlayed.length === 0 || state.recentlyPlayed[0].id !== songData.id) {
        state.recentlyPlayed.unshift(songData);
        if (state.recentlyPlayed.length > 20) {
            state.recentlyPlayed = state.recentlyPlayed.slice(0, 20);
        }
    }
    
    updateNowPlayingDisplay();
    
    if (state.audioElement) {
        state.isPlaying = true;
        updatePlayButtons();
        showNotification(`Playing: ${songData.title}`, 'success');
    }
}

function togglePlayPause() {
    console.log("🎵 Toggle play/pause");
    
    if (!state.currentSong) {
        if (music.length > 0 && music[0].albums.length > 0 && music[0].albums[0].songs.length > 0) {
            const firstSong = {
                ...music[0].albums[0].songs[0],
                artist: music[0].artist,
                album: music[0].albums[0].album
            };
            playSong(firstSong);
            return;
        }
    }
    
    state.isPlaying = !state.isPlaying;
    updatePlayButtons();
    
    if (state.audioElement) {
        if (state.isPlaying) {
            state.audioElement.play().catch(() => {
                console.log("Audio playback failed (expected)");
            });
        } else {
            state.audioElement.pause();
        }
    }
    
    showNotification(state.isPlaying ? 'Playing' : 'Paused', 'info');
}

function nextTrack() {
    console.log("⏭️ Next track");
    
    if (state.queue.length > 0) {
        const nextSong = state.queue.shift();
        playSong(nextSong);
        return;
    }
    
    if (state.currentSong) {
        const artist = music.find(a => a.artist === state.currentSong.artist);
        const album = artist?.albums.find(a => a.album === state.currentSong.album);
        if (album) {
            const currentIndex = album.songs.findIndex(s => s.id === state.currentSong.id);
            const nextIndex = (currentIndex + 1) % album.songs.length;
            const nextSong = {
                ...album.songs[nextIndex],
                artist: artist.artist,
                album: album.album
            };
            playSong(nextSong);
        }
    }
}

function previousTrack() {
    console.log("⏮️ Previous track");
    
    if (state.currentSong) {
        const artist = music.find(a => a.artist === state.currentSong.artist);
        const album = artist?.albums.find(a => a.album === state.currentSong.album);
        if (album) {
            const currentIndex = album.songs.findIndex(s => s.id === state.currentSong.id);
            const prevIndex = (currentIndex - 1 + album.songs.length) % album.songs.length;
            const prevSong = {
                ...album.songs[prevIndex],
                artist: artist.artist,
                album: album.album
            };
            playSong(prevSong);
        }
    }
}

function enableAutoPlay() {
    state.autoPlayEnabled = true;
    showNotification('Auto-play enabled', 'success');
    console.log("✅ Auto-play enabled");
}

function disableAutoPlay() {
    state.autoPlayEnabled = false;
    showNotification('Auto-play disabled', 'info');
    console.log("🚫 Auto-play disabled");
}

function toggleAutoPlay() {
    if (state.autoPlayEnabled) {
        disableAutoPlay();
    } else {
        enableAutoPlay();
    }
}

function renderFeaturedArtists() {
    const container = document.getElementById('featured-artists');
    if (!container || !music.length) return;
    
    const shuffled = [...music].sort(() => 0.5 - Math.random());
    const featured = shuffled.slice(0, 4);
    
    container.innerHTML = featured.map(artist => `
        <div class="artist-card bg-white bg-opacity-5 rounded-xl p-6 cursor-pointer hover:bg-opacity-10 transition-all" onclick="handleArtistClick('${artist.artist}')">
            <div class="text-center">
                <div class="w-32 h-32 mx-auto mb-4 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                    <img src="${getArtistImageUrl(artist.artist)}" alt="${artist.artist}" class="w-full h-full object-cover rounded-full">
                </div>
                <h3 class="text-lg font-bold mb-2">${artist.artist}</h3>
                <div class="text-xs bg-blue-600 bg-opacity-30 px-3 py-1 rounded-full mb-3">${artist.genre}</div>
                <p class="text-sm opacity-70">${artist.albums.length} albums</p>
            </div>
        </div>
    `).join('');
}

function renderFeaturedAlbums() {
    const container = document.getElementById('featured-albums');
    if (!container || !music.length) return;
    
    const allAlbums = [];
    music.forEach(artist => {
        artist.albums.forEach(album => {
            allAlbums.push({ ...album, artist: artist.artist });
        });
    });
    
    const shuffled = [...allAlbums].sort(() => 0.5 - Math.random());
    const featured = shuffled.slice(0, 4);
    
    container.innerHTML = featured.map(album => `
        <div class="album-card bg-white bg-opacity-5 rounded-xl p-6 cursor-pointer hover:bg-opacity-10 transition-all" onclick="handleAlbumClick('${album.artist}', '${album.album}')">
            <div class="text-center">
                <div class="w-32 h-32 mx-auto mb-4 bg-gradient-to-br from-purple-500 to-blue-600 rounded-lg flex items-center justify-center">
                    <img src="${getAlbumImageUrl(album.album)}" alt="${album.album}" class="w-full h-full object-cover rounded-lg">
                </div>
                <h3 class="text-lg font-bold mb-2">${album.album}</h3>
                <p class="text-sm opacity-70 mb-1">${album.artist}</p>
                <p class="text-xs opacity-50">${album.year || 'Unknown'} • ${album.songs.length} tracks</p>
            </div>
        </div>
    `).join('');
}

function renderRecentlyListened() {
    const container = document.getElementById('recently-listened');
    if (!container) return;
    
    if (state.recentlyPlayed.length === 0) {
        container.innerHTML = `
            <div class="text-center py-8 text-gray-400">
                <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <p>No recently played songs</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = state.recentlyPlayed.slice(0, 5).map(song => `
        <div class="flex items-center p-3 bg-white bg-opacity-5 rounded-lg hover:bg-opacity-10 cursor-pointer transition-all" onclick="handleSongClick(${JSON.stringify(song).replace(/"/g, '&quot;')})">
            <img src="${getAlbumImageUrl(song.album)}" class="w-12 h-12 rounded-lg mr-4">
            <div class="flex-1 min-w-0">
                <div class="font-medium truncate">${song.title}</div>
                <div class="text-sm text-gray-400 truncate">${song.artist}</div>
            </div>
            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
            </svg>
        </div>
    `).join('');
}

function renderQuickActions() {
    const container = document.getElementById('quick-actions');
    if (!container) return;
    
    container.innerHTML = `
        <div class="bg-gradient-to-br from-blue-500 to-purple-600 p-6 rounded-xl cursor-pointer hover:scale-105 transition-transform" onclick="createPlaylist()">
            <div class="text-center text-white">
                <svg class="w-12 h-12 mx-auto mb-3" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                </svg>
                <h3 class="font-bold">Create Playlist</h3>
                <p class="text-sm opacity-80">Build your collection</p>
            </div>
        </div>
        
        <div class="bg-gradient-to-br from-green-500 to-teal-600 p-6 rounded-xl cursor-pointer hover:scale-105 transition-transform" onclick="shuffleAllSongs()">
            <div class="text-center text-white">
                <svg class="w-12 h-12 mx-auto mb-3" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1z" clip-rule="evenodd"/>
                </svg>
                <h3 class="font-bold">Shuffle All</h3>
                <p class="text-sm opacity-80">Random playback</p>
            </div>
        </div>
        
        <div class="bg-gradient-to-br from-red-500 to-pink-600 p-6 rounded-xl cursor-pointer hover:scale-105 transition-transform" onclick="openFavorites()">
            <div class="text-center text-white">
                <svg class="w-12 h-12 mx-auto mb-3" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
                <h3 class="font-bold">Favorites</h3>
                <p class="text-sm opacity-80">${state.favorites.size} songs</p>
            </div>
        </div>
        
        <div class="bg-gradient-to-br from-gray-600 to-gray-800 p-6 rounded-xl">
            <div class="text-center text-white">
                <h3 class="font-bold mb-3">Library Stats</h3>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span>Artists:</span>
                        <span>${music.length}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Albums:</span>
                        <span>${music.reduce((total, artist) => total + artist.albums.length, 0)}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Songs:</span>
                        <span>${getTotalSongs()}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>Auto-play:</span>
                        <button onclick="toggleAutoPlay()" class="text-xs px-2 py-1 rounded ${state.autoPlayEnabled ? 'bg-green-600' : 'bg-red-600'}">
                            ${state.autoPlayEnabled ? 'ON' : 'OFF'}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function handleArtistClick(artistName) {
    console.log(`🎨 Artist clicked: ${artistName}`);
    
    if (state.autoPlayEnabled) {
        playArtist(artistName);
    } else {
        showNotification(`Selected artist: ${artistName}`, 'info');
    }
}

function handleAlbumClick(artistName, albumName) {
    console.log(`💿 Album clicked: ${albumName} by ${artistName}`);
    
    if (state.autoPlayEnabled) {
        playAlbum(artistName, albumName);
    } else {
        showNotification(`Selected album: ${albumName}`, 'info');
    }
}

function handleSongClick(songData) {
    console.log(`🎵 Song clicked: ${songData.title}`);
    
    if (state.autoPlayEnabled) {
        playSong(songData, true);
    } else {
        showNotification(`Selected song: ${songData.title}`, 'info');
    }
}

function toggleShuffle() {
    console.log("🔀 Toggle shuffle");
    showNotification('Shuffle toggled', 'info');
}

function toggleRepeat() {
    console.log("🔁 Toggle repeat");
    showNotification('Repeat toggled', 'info');
}

function toggleFavorite() {
    if (!state.currentSong) return;
    
    const songId = state.currentSong.id;
    if (state.favorites.has(songId)) {
        state.favorites.delete(songId);
        showNotification('Removed from favorites', 'info');
    } else {
        state.favorites.add(songId);
        showNotification('Added to favorites', 'success');
    }
}

function switchTab(tabName) {
    console.log(`📑 Switch to tab: ${tabName}`);
    
    document.querySelectorAll('.popup-tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.tab === tabName);
    });
    
    document.querySelectorAll('.popup-tab-content').forEach(content => {
        content.style.display = content.dataset.tab === tabName ? 'block' : 'none';
    });
    
    if (tabName === 'queue') {
        updateQueueTab();
    } else if (tabName === 'recent') {
        updateRecentTab();
    }
}

function updatePlayButtons() {
    const playIcons = document.querySelectorAll('#play-icon-navbar, #popup-play-icon');
    const pauseIcons = document.querySelectorAll('#pause-icon-navbar, #popup-pause-icon');
    
    playIcons.forEach(icon => {
        if (icon) icon.style.display = state.isPlaying ? 'none' : 'block';
    });
    
    pauseIcons.forEach(icon => {
        if (icon) icon.style.display = state.isPlaying ? 'block' : 'none';
    });
}

function updateNowPlayingDisplay() {
    if (!state.currentSong) return;
    
    const navTitle = document.getElementById('navbar-song-title');
    const navArtist = document.getElementById('navbar-artist');
    const navCover = document.getElementById('navbar-album-cover');
    const nowPlayingArea = document.getElementById('now-playing-area');
    
    if (navTitle) navTitle.textContent = state.currentSong.title;
    if (navArtist) navArtist.textContent = state.currentSong.artist;
    if (navCover) navCover.src = getAlbumImageUrl(state.currentSong.album);
    if (nowPlayingArea) nowPlayingArea.classList.add('has-song');
    
    const logo = document.getElementById('navbar-logo');
    if (logo) logo.classList.add('hidden');
    if (navCover) navCover.classList.remove('hidden');
}

function updatePopupContent() {
    if (!state.currentSong) return;
    
    const popupTitle = document.getElementById('popup-song-title');
    const popupArtist = document.getElementById('popup-artist-name');
    const popupAlbum = document.getElementById('popup-album-name');
    const popupCover = document.getElementById('popup-album-cover');
    
    if (popupTitle) popupTitle.textContent = state.currentSong.title;
    if (popupArtist) popupArtist.textContent = state.currentSong.artist;
    if (popupAlbum) popupAlbum.textContent = state.currentSong.album;
    if (popupCover) popupCover.src = getAlbumImageUrl(state.currentSong.album);
}

function updateQueueTab() {
    const queueList = document.getElementById('queue-list');
    if (!queueList) return;
    
    if (state.queue.length === 0) {
        queueList.innerHTML = '<li class="text-gray-400 p-4">Queue is empty</li>';
        return;
    }
    
    queueList.innerHTML = state.queue.map((song, index) => `
        <li class="flex items-center p-3 hover:bg-gray-700 cursor-pointer" onclick="playFromQueue(${index})">
            <img src="${getAlbumImageUrl(song.album)}" class="w-10 h-10 rounded mr-3">
            <div>
                <div class="font-medium">${song.title}</div>
                <div class="text-sm text-gray-400">${song.artist}</div>
            </div>
        </li>
    `).join('');
}

function updateRecentTab() {
    const recentList = document.getElementById('recent-list');
    if (!recentList) return;
    
    if (state.recentlyPlayed.length === 0) {
        recentList.innerHTML = '<li class="text-gray-400 p-4">No recently played songs</li>';
        return;
    }
    
    recentList.innerHTML = state.recentlyPlayed.map((song, index) => `
        <li class="flex items-center p-3 hover:bg-gray-700 cursor-pointer" onclick="playSong(${JSON.stringify(song).replace(/"/g, '&quot;')})">
            <img src="${getAlbumImageUrl(song.album)}" class="w-10 h-10 rounded mr-3">
            <div>
                <div class="font-medium">${song.title}</div>
                <div class="text-sm text-gray-400">${song.artist}</div>
            </div>
        </li>
    `).join('');
}

function updateDropdownCounts() {
    const counts = {
        'queue-count': state.queue.length,
        'recent-count': state.recentlyPlayed.length,
        'favorite-songs-count': state.favorites.size,
        'favorite-artists-count': 0
    };
    
    Object.entries(counts).forEach(([id, count]) => {
        const element = document.getElementById(id);
        if (element) element.textContent = count;
    });
}

function loadHomePage() {
    console.log("🏠 Loading home page...");
    
    const content = document.getElementById('dynamic-content');
    if (!content) {
        console.log("❌ dynamic-content not found");
        return;
    }
    
    content.innerHTML = `
        <div class="text-center py-12">
            <h1 class="text-5xl font-bold mb-6 gradient-text">Discover Amazing Music</h1>
            <p class="text-xl text-gray-400 mb-12 max-w-2xl mx-auto">Explore artists, albums, and songs from your personal library</p>
        </div>
        
        <div class="mb-12">
            <h2 class="text-3xl font-bold mb-8 px-4">Featured Artists</h2>
            <div id="featured-artists" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8 px-4"></div>
        </div>
        
        <div class="mb-12">
            <h2 class="text-3xl font-bold mb-8 px-4">Featured Albums</h2>
            <div id="featured-albums" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8 px-4"></div>
        </div>
        
        <div class="mb-12 px-4">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bento-grid-container">
                    <h2 class="text-3xl font-bold mb-6">Recently Listened</h2>
                    <div id="recently-listened" class="space-y-2"></div>
                </div>
                
                <div class="bento-grid-container">
                    <h2 class="text-3xl font-bold mb-6">Quick Actions</h2>
                    <div id="quick-actions" class="grid grid-cols-2 gap-4"></div>
                </div>
            </div>
        </div>
    `;
    
    setTimeout(() => {
        renderFeaturedArtists();
        renderFeaturedAlbums();
        renderRecentlyListened();
        renderQuickActions();
    }, 100);
}

function shuffleAllSongs() {
    console.log("🔀 Shuffle all songs");
    
    const allSongs = [];
    music.forEach(artist => {
        artist.albums.forEach(album => {
            album.songs.forEach(song => {
                allSongs.push({
                    ...song,
                    artist: artist.artist,
                    album: album.album
                });
            });
        });
    });
    
    if (allSongs.length === 0) {
        showNotification('No songs found', 'warning');
        return;
    }
    
    for (let i = allSongs.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [allSongs[i], allSongs[j]] = [allSongs[j], allSongs[i]];
    }
    
    state.queue = allSongs.slice(1);
    playSong(allSongs[0]);
    
    showNotification(`Shuffling ${allSongs.length} songs!`, 'success');
}

function createPlaylist() {
    const name = prompt("Enter playlist name:");
    if (name && name.trim()) {
        showNotification(`Created playlist: ${name}`, 'success');
    }
}

function openFavorites() {
    if (state.favorites.size === 0) {
        showNotification('No favorites yet', 'info');
    } else {
        showNotification(`You have ${state.favorites.size} favorite songs`, 'info');
    }
}

function playArtist(artistName) {
    const artist = music.find(a => a.artist === artistName);
    if (artist && artist.albums.length > 0 && artist.albums[0].songs.length > 0) {
        const firstSong = {
            ...artist.albums[0].songs[0],
            artist: artist.artist,
            album: artist.albums[0].album
        };
        playSong(firstSong);
    }
}

function playAlbum(artistName, albumName) {
    const artist = music.find(a => a.artist === artistName);
    const album = artist?.albums.find(a => a.album === albumName);
    if (album && album.songs.length > 0) {
        const firstSong = {
            ...album.songs[0],
            artist: artistName,
            album: albumName
        };
        
        state.queue = album.songs.slice(1).map(song => ({
            ...song,
            artist: artistName,
            album: albumName
        }));
        
        playSong(firstSong);
    }
}

function playFromQueue(index) {
    if (index >= 0 && index < state.queue.length) {
        const song = state.queue.splice(index, 1)[0];
        playSong(song);
        updateQueueTab();
    }
}

function formatTime(seconds) {
    if (isNaN(seconds) || seconds < 0) return '0:00';
    const minutes = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${minutes}:${secs.toString().padStart(2, '0')}`;
}

function getAlbumImageUrl(albumName) {
    if (!albumName) return 'https://via.placeholder.com/300x300/4F46E5/white?text=Album';
    const normalized = albumName.toLowerCase().replace(/[^\w]/g, '');
    return `https://koders.cloud/global/content/images/albumCovers/${normalized}.png`;
}

function getArtistImageUrl(artistName) {
    if (!artistName) return 'https://via.placeholder.com/300x300/7C3AED/white?text=Artist';
    const normalized = artistName.toLowerCase().replace(/[^\w]/g, '');
    return `https://koders.cloud/global/content/images/artistPortraits/${normalized}.png`;
}

function getTotalSongs() {
    return music.reduce((total, artist) => {
        return total + artist.albums.reduce((albumTotal, album) => albumTotal + album.songs.length, 0);
    }, 0);
}

function handleKeyboard(e) {
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
    
    switch (e.key) {
        case ' ':
            e.preventDefault();
            togglePlayPause();
            break;
        case 'ArrowLeft':
            if (e.ctrlKey) {
                e.preventDefault();
                previousTrack();
            }
            break;
        case 'ArrowRight':
            if (e.ctrlKey) {
                e.preventDefault();
                nextTrack();
            }
            break;
        case 'Escape':
            closeMusicPlayer();
            closeDropdownMenu();
            break;
    }
}

function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg text-white transition-all duration-300 ${
        type === 'success' ? 'bg-green-600' : 
        type === 'error' ? 'bg-red-600' : 
        type === 'warning' ? 'bg-yellow-600' : 
        'bg-blue-600'
    }`;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.classList.add('opacity-0', 'translate-y-2');
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

window.playSong = playSong;
window.handleArtistClick = handleArtistClick;
window.handleAlbumClick = handleAlbumClick;
window.handleSongClick = handleSongClick;
window.toggleAutoPlay = toggleAutoPlay;
window.enableAutoPlay = enableAutoPlay;
window.disableAutoPlay = disableAutoPlay;
window.playArtist = playArtist;
window.playAlbum = playAlbum;
window.playFromQueue = playFromQueue;
window.shuffleAllSongs = shuffleAllSongs;
window.createPlaylist = createPlaylist;
window.openFavorites = openFavorites;

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeApp);
} else {
    initializeApp();
}        
</script>
-->

<script type="module" src="./modules/library.js"></script>
<script type="module" src="./siteEngine/siteMap.js"></script>
<script type="module" src="./siteEngine/newScript.js"></script>




</body>
</html>
