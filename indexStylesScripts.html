<!DOCTYPE html>
<html lang="en" class="dim">
<head>
    <!-- External Dependencies -->
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ytdl-core@4.11.2/dist/ytdl-core.min.js"></script>
    
    <!-- Meta Tags -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MyBeats™</title>
    <meta name="description" content="Stream & share your favourite music for free." />
    <meta name="keywords" content="music, player, web, audio, streaming, playlist, songs, albums, artists, videos, sharing, media, radio, pop, hiphop, country, dance, party, dubstep, alternative, rock, free, forever" />
    <meta name="author" content="ClockBlocked" />
    <meta name="theme-color" content="#1f2329" />

    <!-- SEO Meta Tags -->
    <meta property="og:title" content="MyBeats™ - Stream & Share Music" />
    <meta property="og:description" content="A sleek and modern web-based music player." />
    <meta property="og:image" content="thumbnail.jpg" />
    <meta property="og:url" content="https://koders.cloud" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="MyBeats™ - Stream & Share Music" />
    <meta name="twitter:description" content="A sleek and modern web-based music player." />
    <meta name="twitter:image" content="thumbnail.jpg" />

    <!-- PWA Configuration -->
    <link rel="manifest" href="./system/manifest.json" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="apple-touch-icon" href="apple-touch-icon.png" />

    <!-- Assets -->
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="./newNewNew.css" />
    <link rel="stylesheet" href="./dynamicOverlays.css">
    <link href="https://dev.wuaze.com/styleSheets/fonts.css" rel="stylesheet" />
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/preline@2.0.3/dist/preline.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css" />

    <!-- Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-P0KCT8TSPW"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      gtag("js", new Date());
      gtag("config", "G-P0KCT8TSPW");
    </script>
 
 
 
 
    <style>
      /* ===== Theme Toggle Component ===== */
      .theme-toggle-container {
        position: fixed;
        bottom: 4rem;
        left: 1rem;
        z-index: var(--z-tooltip);
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }

      .theme-trigger {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--background-400);
        color: var(--text-100);
        border-radius: var(--radius-full);
        cursor: pointer;
        box-shadow: var(--shadow-md);
        transition: var(--transition-base);
      }

      .theme-trigger:hover {
        background: var(--background-500);
        transform: translateY(-2px);
      }

      .theme-options {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        transform: translateY(100%);
        opacity: 0;
        pointer-events: none;
        transition: var(--transition-smooth);
      }

      .theme-toggle-container.active .theme-options {
        transform: translateY(0);
        opacity: 1;
        pointer-events: all;
      }

      .theme-options button {
        width: 40px;
        height: 40px;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--background-400);
        border: none;
        border-radius: var(--radius-full);
        color: var(--text-100);
        cursor: pointer;
        transition: var(--transition-fast);
        box-shadow: var(--shadow-sm);
      }

      .theme-options button:hover {
        background: var(--background-500);
        transform: translateY(-2px);
      }

      .theme-options button.active {
        background: var(--accent-primary);
        color: var(--text-on-accent);
        box-shadow: var(--shadow-sm);
      }

      /* ===== Artist Card Component ===== *
      .artist-card {
        display: flex; 
        height: 250px; 
        flex-direction: row;
        background-color: #FEFEFE !important;
        border: 1px solid rgba(234, 238, 242, 0.65);
      }
      
      .artist-card .artist-avatar {
        float: left;
      }
      
      .text-center > h3,
      .text-center > .genre-tag,
      .text-center > p {
        float: right;
        justify-content: space-between;
      }
      
      .text-center > h3,
      .text-center > .genre-tag {
        margin-left: 1rem; 
        margin-bottom: 0.5rem; 
        opacity: 0.5; 
        transition: opacity 0.65s ease-in-out;
      }
      
      .artist-card:hover .text-center > h3 {
        opacity: 1; 
        transition: opacity 0.65s ease-in-out;
      }
      
      .text-center > .genre-tag {
        margin-top: 2rem;
      }


      #dynamic-content {
        padding: 0;
        background-color: var(--background-300) !important;
        border-top-right-radius: 15px;
      }

      .album-content,
      .songs-container {
        background-color: var(--background-300) !important;
        border-top-right-radius: 15px;
      }
      
      .album-selector-container, 
      .album-content {
        margin-top: 2rem;
      }
      
      .content-offset {
        border-top-right-radius: 15px;
      }

      #album-tabs {
        margin-bottom: 2rem;
      }
      **/
    </style>
    
<style>
.mainCard {
  background-color: var(--background-400) !important;
  border-color: var(--background-200) !important;
  color: var(--text-200) !important;
  border-radius: 10px !important;
}


 :root {
  /* Shadows - Universal across themes */
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
  --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);
  --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15), 0 6px 10px rgba(0, 0, 0, 0.08);
  --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.2), 0 10px 20px rgba(0, 0, 0, 0.1);
  --shadow-2xl: 0 25px 50px rgba(0, 0, 0, 0.25), 0 15px 30px rgba(0, 0, 0, 0.15);
  --shadow-nav: 0 8px 24px rgba(0, 0, 0, 0.18), 0 4px 12px rgba(0, 0, 0, 0.12);
  --shadow-inset: inset 0 2px 4px rgba(0, 0, 0, 0.06);

  /* Blur Effects */
  --blur-sm: blur(4px);
  --blur-md: blur(8px);
  --blur-lg: blur(16px);
  --blur-xl: blur(24px);
  --blur-nav: blur(12px);

  /* Transitions */
  --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-base: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-smooth: 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  --transition-bounce: 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  --transition-elastic: 0.5s cubic-bezier(0.68, -0.6, 0.32, 1.6);

  /* Border Radius */
  --radius-xs: 4px;
  --radius-sm: 6px;
  --radius-md: 8px;
  --radius-lg: 12px;
  --radius-xl: 16px;
  --radius-2xl: 24px;
  --radius-full: 9999px;

  /* Z-index Layers */
  --z-base: 1;
  --z-dropdown: 10;
  --z-sticky: 20;
  --z-overlay: 30;
  --z-modal: 40;
  --z-popover: 50;
  --z-tooltip: 60;
  --z-notification: 70;
  --z-player: 100;
  --z-player-controls: 110;
  --z-nav: 100;
  --z-search: 100;

  /* Spacing Scale */
  --space-xs: 0.25rem;
  --space-sm: 0.5rem;
  --space-md: 1rem;
  --space-lg: 1.5rem;
  --space-xl: 2rem;
  --space-2xl: 3rem;
  --space-3xl: 4rem;
 }

 /* This CSS can be added to your existing stylesheet or as a separate file */
 .gradient-text {
  background-image: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
 }

 .bento-grid {
  display: grid;
  gap: 1.5rem;
  padding-bottom: 2rem;
 }

 @media (min-width: 768px) {
  .bento-grid {
   grid-template-columns: repeat(2, 1fr);
  }
 }

 @media (min-width: 1024px) {
  .bento-grid {
   grid-template-columns: repeat(3, 1fr);
  }
 }

 .album-card:nth-child(1) {
  animation-delay: 0.1s;
 }
 .album-card:nth-child(2) {
  animation-delay: 0.2s;
 }
 .album-card:nth-child(3) {
  animation-delay: 0.3s;
 }
 .album-card:nth-child(4) {
  animation-delay: 0.4s;
 }
 .album-card:nth-child(5) {
  animation-delay: 0.5s;
 }
 .album-card:nth-child(6) {
  animation-delay: 0.6s;
 }

 .recent-track:nth-child(1) {
  animation-delay: 0.1s;
 }
 .recent-track:nth-child(2) {
  animation-delay: 0.2s;
 }
 .recent-track:nth-child(3) {
  animation-delay: 0.3s;
 }
 .recent-track:nth-child(4) {
  animation-delay: 0.4s;
 }
 .recent-track:nth-child(5) {
  animation-delay: 0.5s;
 }

 .artist-card:nth-child(1) {
  animation-delay: 0.1s;
 }
 .artist-card:nth-child(2) {
  animation-delay: 0.2s;
 }
 .artist-card:nth-child(3) {
  animation-delay: 0.3s;
 }
 .artist-card:nth-child(4) {
  animation-delay: 0.4s;
 }
 .artist-card:nth-child(5) {
  animation-delay: 0.5s;
 }
 .artist-card:nth-child(6) {
  animation-delay: 0.6s;
 }

 .playlist-card:nth-child(1) {
  animation-delay: 0.1s;
 }
 .playlist-card:nth-child(2) {
  animation-delay: 0.2s;
 }
 .playlist-card:nth-child(3) {
  animation-delay: 0.3s;
 }

 .modal {
  --modal-bg: var(--background-400);
  --modal-surface: var(--background-500);
  --modal-border: var(--border-200);
  --modal-text: var(--text-200);
  --modal-radius: var(--radius-2xl);
  --modal-pad-x: var(--space-xl);
  --modal-pad-y: var(--space-lg);
  --modal-w: min(90vw, 400px);
  --modal-h: min(75vh, 600px);
  margin: auto;
  padding: 1.5rem;
  border: 1px solid var(--modal-border);
  border-radius: var(--modal-radius);
  background: linear-gradient(180deg, var(--modal-bg), var(--modal-surface));
  color: var(--modal-text);
  box-shadow: var(--shadow-2xl);
  width: var(--modal-w);
  max-width: 90vw;
  max-height: var(--modal-h);
  overflow: hidden;
  opacity: 0;
  transform: translateY(12px) scale(0.98);
  transition: opacity 0.45s ease-in-out, transform var(--transition-bounce);
  outline: none;
  backdrop-filter: blur(10px);
 }
 .modal {
  position: fixed !important;
  top: 20% !important;
  left: 50% !important;
  transform: translateX(-50%) !important;
  transition: opacity 0.45s ease-in-out;
 }
 .modal[open] {
  opacity: 1;
  transform: translateY(0) scale(1);
  transition: opacity 0.45s ease-in-out;
 }

 .modal[closing] {
  opacity: 0;
  transform: translateY(8px) scale(0.98);
  transition: opacity 0.45s ease-out, transform 0.5s cubic-bezier(0.68, -0.6, 0.32, 1.6);
 }

 .modal:modal {
  inset: unset;
 }

 .modal::backdrop {
  background: var(--background-overlay);
  backdrop-filter: var(--blur-xl);
  -webkit-backdrop-filter: var(--blur-xl);
  opacity: 0;
  transition: opacity 0.45s ease-in-out;
 }

 .modal[open]::backdrop {
  opacity: 0.75;
  transition: opacity 0.45s ease-in-out;
 }

 .modal[closing]::backdrop {
  opacity: 0;
  transition: opacity 0.45s ease-in-out;
 }

 .modal-content {
  display: block;
  padding: var(--modal-pad-y) var(--modal-pad-x);
  overflow: auto;
  max-height: calc(var(--modal-h) - (var(--modal-pad-y) * 2));
  scrollbar-width: thin;
  scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);
  overscroll-behavior: contain;
 }

 .modal-content::-webkit-scrollbar {
  width: 10px;
 }
 .modal-content::-webkit-scrollbar-track {
  background: var(--scrollbar-track);
  border-left: 1px solid var(--border-100);
 }
 .modal-content::-webkit-scrollbar-thumb {
  background: var(--scrollbar-thumb);
  border-radius: var(--radius-full);
  border: 2px solid var(--scrollbar-track);
 }
 .modal-content::-webkit-scrollbar-thumb:hover {
  background: var(--scrollbar-thumb-hover);
 }

 .modal :focus-visible {
  outline: 2px solid var(--accent-primary);
  outline-offset: 2px;
  border-radius: var(--radius-sm);
 }

 .modal-close {
  position: absolute;
  top: var(--space-sm);
  right: var(--space-sm);
  width: 40px;
  height: 40px;
  display: grid;
  place-items: center;
  font-size: 2.25rem;
  font-weight: bolder;
  line-height: 1;
  border-radius: var(--radius-full);
  border: 1px solid transparent;
  background: rgba(0, 0, 0, 0);
  color: var(--text-300);
  cursor: pointer;
  transition: transform var(--transition-bounce), background 0.45s ease-in-out, color 0.45s ease-in-out, border-color 0.45s ease-in-out;
  backdrop-filter: var(--blur-sm);
  -webkit-backdrop-filter: var(--blur-sm);
 }

 .modal-close:hover {
  background: var(--background-600);
  border-color: var(--border-200);
  color: var(--text-100);
  transform: scale(1.05);
 }

 .modal-close:active {
  transform: scale(0.96);
  background: var(--background-700);
 }

 .modal-close:focus-visible {
  outline: 2px solid var(--accent-primary);
  outline-offset: 2px;
 }

 .modal--sm {
  --modal-w: min(90vw, 400px);
 }

 .modal--lg {
  --modal-w: min(90vw, 400px);
 }

 .modal--xl {
  --modal-w: min(90vw, 400px);
 }

 .modal--sheet {
  --modal-w: 90vw;
  --modal-h: min(75vh, 600px);
  width: var(--modal-w);
  max-width: none;
  margin: 0;
  border-radius: var(--radius-2xl) var(--radius-2xl) 0 0;
  align-self: end;
  transform: translateY(24px);
 }

 .modal--sheet[open] {
  transform: translateY(0);
 }

 @media (max-width: 640px) {
  .modal {
   --modal-w: 90vw;
   --modal-h: 75vh;
   width: var(--modal-w);
   max-width: none;
   margin: 0;
   border-radius: var(--radius-xl);
  }
  .modal-content {
   padding: var(--space-md) var(--space-lg);
   max-height: calc(var(--modal-h) - (var(--space-md) * 2));
  }
  .modal-close {
   top: var(--space-xs);
   right: var(--space-xs);
  }
 }

 @media (prefers-reduced-motion: reduce) {
  .modal,
  .modal::backdrop {
   transition: none;
  }
 }

 .modal--popover {
  --modal-w: min(92vw, 420px);
  --modal-pad-x: var(--space-lg);
  --modal-pad-y: var(--space-lg);
 }
 .modal-popover {
  display: grid;
  gap: var(--space-lg);
 }
 .modal-popover-header {
  font-size: 1.05rem;
  color: var(--text-100);
 }
 .modal-popover-body {
  color: var(--text-200);
 }
 .modal-popover-actions {
  display: flex;
  gap: var(--space-sm);
  justify-content: flex-end;
 }

 .modal-input {
  width: 100%;
  padding: 0.75rem 0.875rem;
  border: 1px solid var(--input-border);
  border-radius: var(--radius-md);
  background: var(--input-background);
  color: var(--text-100);
  transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
 }
 .modal-input:focus {
  border-color: var(--border-accent);
  outline: 0;
 }

 .btn {
  appearance: none;
  border: 1px solid transparent;
  border-radius: var(--radius-md);
  padding: 0.6rem 0.9rem;
  font-weight: 600;
  cursor: pointer;
  transition: transform var(--transition-bounce), background var(--transition-fast), border-color var(--transition-fast), color var(--transition-fast);
 }
 .btn:active {
  transform: scale(0.98);
 }

 .btn-primary {
  background: var(--accent-primary);
  color: var(--text-on-accent);
 }
 .btn-primary:hover {
  background: var(--accent-primary-hover);
 }
 .btn-primary:active {
  background: var(--accent-primary-active);
 }

 .btn-muted {
  background: var(--button-background);
  color: var(--text-200);
  border-color: var(--border-200);
 }
 .btn-muted:hover {
  background: var(--button-hover);
  color: var(--text-100);
  border-color: var(--border-300);
 }
 .btn-danger {
  background: var(--accent-danger);
  color: var(--text-on-accent);
 }
 .btn-danger:hover {
  background: var(--accent-danger-hover);
 }

 @media (max-width: 480px) {
  .modal--popover {
   --modal-w: min(60vw, 150px);
  }
  .modal-popover-actions {
   gap: var(--space-xs);
  }
 }

 @keyframes fadeInUp {
  from {
   opacity: 0;
   transform: translateY(30px);
  }
  to {
   opacity: 1;
   transform: translateY(0);
  }
 }

 @keyframes fadeInScale {
  from {
   opacity: 0;
   transform: scale(0.95);
  }
  to {
   opacity: 1;
   transform: scale(1);
  }
 }

 @keyframes slideInRight {
  from {
   opacity: 0;
   transform: translateX(30px);
  }
  to {
   opacity: 1;
   transform: translateX(0);
  }
 }

 @keyframes pulse-glow {
  0%,
  100% {
   box-shadow: 0 0 0 0 rgba(88, 166, 255, 0.7);
  }
  50% {
   box-shadow: 0 0 0 10px rgba(88, 166, 255, 0);
  }
 }

 @keyframes gradient-shift {
  0% {
   background-position: 0% 50%;
  }
  50% {
   background-position: 100% 50%;
  }
  100% {
   background-position: 0% 50%;
  }
 }

 @keyframes float {
  0%,
  100% {
   transform: translateY(0px);
  }
  50% {
   transform: translateY(-10px);
  }
 }

 @keyframes shimmer {
  0% {
   transform: translateX(-100%);
  }
  100% {
   transform: translateX(100%);
  }
 }

 @keyframes pulse {
  0%,
  100% {
   opacity: 1;
  }
  50% {
   opacity: 0.5;
  }
 }

 .modal .playlists-page {
  min-height: 60vh;
  max-height: 80vh;
  padding: var(--space-lg);
  background: var(--background-300);
  animation: fadeInScale 0.6s ease-out;
  overflow-y: auto;
 }

 .modal .playlists-page .page-header {
  position: sticky;
  top: 0;
  background: var(--background-300);
  z-index: var(--z-sticky);
  margin-bottom: var(--space-xl);
  padding-bottom: var(--space-lg);
  border-bottom: 1px solid var(--border-200);
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: var(--space-md);
 }

 .modal .playlists-page .page-header::after {
  content: "";
  position: absolute;
  bottom: -1px;
  left: 0;
  width: 80px;
  height: 3px;
  background: linear-gradient(90deg, var(--accent-primary), var(--accent-purple));
  border-radius: var(--radius-full);
 }

 .modal .playlists-page .page-header h1 {
  font-size: clamp(1.75rem, 3vw, 2.5rem);
  font-weight: 800;
  line-height: 1.2;
  background: linear-gradient(135deg, var(--text-100) 0%, var(--text-200) 100%);
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: var(--space-xs);
 }

 .modal .playlists-page .page-header p {
  color: var(--text-300);
  font-size: 1rem;
  font-weight: 500;
 }

 .modal .create-playlist-btn {
  position: relative;
  background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-purple) 100%);
  border: none;
  color: var(--text-on-accent);
  padding: var(--space-sm) var(--space-lg);
  border-radius: var(--radius-full);
  font-weight: 600;
  font-size: 0.9rem;
  cursor: pointer;
  transition: var(--transition-base);
  overflow: hidden;
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  box-shadow: var(--shadow-md);
  background-size: 200% 200%;
  animation: gradient-shift 3s ease infinite;
  white-space: nowrap;
 }

 .modal .create-playlist-btn::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: var(--transition-base);
 }

 .modal .create-playlist-btn:hover {
  transform: translateY(-2px) scale(1.03);
  box-shadow: var(--shadow-lg);
 }

 .modal .create-playlist-btn:hover::before {
  left: 100%;
 }

 .modal .create-playlist-btn:active {
  transform: translateY(0) scale(1.01);
 }

 .modal .create-playlist-btn svg {
  width: 18px;
  height: 18px;
  transition: var(--transition-fast);
 }

 .modal .create-playlist-btn:hover svg {
  transform: rotate(90deg);
 }

 .modal .playlists-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: var(--space-lg);
  margin-top: var(--space-lg);
 }

 .modal .playlist-card {
  background: var(--background-400);
  border-radius: var(--radius-lg);
  overflow: hidden;
  transition: var(--transition-base);
  cursor: pointer;
  position: relative;
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--border-200);
  animation: fadeInUp 0.6s ease-out backwards;
  transform-origin: center bottom;
 }

 .modal .playlist-card:hover {
  background: var(--background-500);
  transform: translateY(-4px) scale(1.02);
  box-shadow: var(--shadow-lg);
  border-color: var(--accent-primary);
 }

 .modal .playlist-card::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, var(--accent-primary), var(--accent-purple));
  transform: scaleX(0);
  transition: var(--transition-base);
  transform-origin: left;
  z-index: var(--z-base);
 }

 .modal .playlist-card:hover::before {
  transform: scaleX(1);
 }

 .modal .playlist-cover {
  aspect-ratio: 1;
  background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-primary) 100%);
  position: relative;
  overflow: hidden;
  background-size: 200% 200%;
  animation: gradient-shift 6s ease infinite;
 }

 .modal .playlist-cover::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.2) 0%, rgba(0, 0, 0, 0.4) 100%);
  opacity: 0.3;
  transition: var(--transition-base);
 }

 .modal .playlist-card:hover .playlist-cover::before {
  opacity: 0.1;
 }

 .modal .playlist-cover .absolute.inset-0 {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2;
 }

 .modal .playlist-cover svg {
  width: 3rem;
  height: 3rem;
  color: var(--text-on-accent);
  opacity: 0.9;
  transition: var(--transition-base);
  animation: float 4s ease-in-out infinite;
 }

 .modal .playlist-card:hover .playlist-cover svg {
  opacity: 1;
  transform: scale(1.1);
 }

 .modal .playlist-cover .absolute.top-2.right-2 {
  position: absolute;
  top: var(--space-sm);
  right: var(--space-sm);
  z-index: 3;
 }

 .modal .play-playlist-btn {
  width: 2.5rem;
  height: 2.5rem;
  background: var(--accent-primary);
  border: none;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: var(--transition-bounce);
  opacity: 0;
  transform: scale(0.8);
  box-shadow: var(--shadow-md);
 }

 .modal .playlist-card:hover .play-playlist-btn {
  opacity: 1;
  transform: scale(1);
  animation: pulse-glow 2s infinite;
 }

 .modal .play-playlist-btn:hover {
  background: var(--accent-primary-hover);
  transform: scale(1.15);
 }

 .modal .play-playlist-btn svg {
  width: 1rem;
  height: 1rem;
  color: var(--text-on-accent);
  margin-left: 2px;
 }

 .modal .playlist-card .p-4 {
  padding: var(--space-md);
  position: relative;
 }

 .modal .playlist-card h3 {
  font-size: 1rem;
  font-weight: 700;
  color: var(--text-100);
  margin-bottom: var(--space-xs);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  transition: var(--transition-fast);
 }

 .modal .playlist-card:hover h3 {
  color: var(--accent-primary);
 }

 .modal .playlist-card p {
  color: var(--text-300);
  font-size: 0.875rem;
  margin-bottom: var(--space-md);
  font-weight: 500;
 }

 .modal .playlist-card .flex.gap-2 {
  display: flex;
  gap: var(--space-sm);
 }

 .modal .view-playlist-btn {
  flex: 1;
  background: var(--background-600);
  color: var(--text-100);
  border: none;
  padding: var(--space-sm) var(--space-md);
  border-radius: var(--radius-md);
  font-size: 0.875rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition-base);
  position: relative;
  overflow: hidden;
  border: 1px solid var(--border-200);
 }

 .modal .view-playlist-btn::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  transition: var(--transition-base);
 }

 .modal .view-playlist-btn:hover {
  background: var(--accent-primary);
  border-color: var(--accent-primary);
  transform: translateY(-1px);
 }

 .modal .view-playlist-btn:hover::before {
  left: 100%;
 }

 .modal .delete-playlist-btn {
  padding: var(--space-sm);
  background: var(--accent-danger);
  color: var(--text-on-accent);
  border: none;
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: var(--transition-base);
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid transparent;
 }

 .modal .delete-playlist-btn:hover {
  background: var(--accent-danger-hover);
  border-color: var(--accent-danger-hover);
  transform: translateY(-1px) scale(1.05);
 }

 .modal .delete-playlist-btn svg {
  width: 1rem;
  height: 1rem;
 }

 .modal .playlist-card:not(.grid-card) {
  background: var(--background-400);
  border-radius: var(--radius-lg);
  padding: var(--space-md);
  transition: var(--transition-base);
  cursor: pointer;
  position: relative;
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--border-200);
  animation: fadeInUp 0.6s ease-out backwards;
  display: flex;
  align-items: center;
  gap: var(--space-md);
  overflow: hidden;
  margin-bottom: var(--space-sm);
 }

 .modal .playlist-card:not(.grid-card):hover {
  background: var(--background-500);
  transform: translateX(4px);
  box-shadow: var(--shadow-md);
  border-color: var(--accent-primary);
 }

 .modal .playlist-card:not(.grid-card)::before {
  content: "";
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background: var(--accent-primary);
  transform: scaleY(0);
  transition: var(--transition-base);
  transform-origin: bottom;
 }

 .modal .playlist-card:not(.grid-card):hover::before {
  transform: scaleY(1);
 }

 .modal .playlist-card:not(.grid-card) .playlist-icon {
  width: 40px !important;
  height: 40px !important;
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-purple)) !important;
  border-radius: var(--radius-md) !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  flex-shrink: 0 !important;
  position: relative;
  overflow: hidden;
  box-shadow: var(--shadow-sm);
  transition: var(--transition-base);
 }

 .modal .playlist-card:not(.grid-card) .playlist-icon::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), transparent);
  opacity: 0;
  transition: var(--transition-fast);
 }

 .modal .playlist-card:not(.grid-card):hover .playlist-icon {
  transform: scale(1.05);
  box-shadow: var(--shadow-md);
 }

 .modal .playlist-card:not(.grid-card):hover .playlist-icon::before {
  opacity: 1;
 }

 .modal .playlist-card:not(.grid-card) .playlist-icon svg {
  width: 20px;
  height: 20px;
  fill: var(--text-on-accent);
  transition: var(--transition-fast);
 }

 .modal .playlist-card:not(.grid-card):hover .playlist-icon svg {
  transform: scale(1.1);
 }

 .modal .playlist-card:not(.grid-card) .playlist-info {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
 }

 .modal .playlist-card:not(.grid-card) .playlist-name {
  font-size: 0.95rem;
  font-weight: 600;
  color: var(--text-100);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  transition: var(--transition-fast);
  line-height: 1.2;
 }

 .modal .playlist-card:not(.grid-card):hover .playlist-name {
  color: var(--accent-primary);
 }

 .modal .playlist-card:not(.grid-card) .playlist-tracks {
  font-size: 0.8rem;
  color: var(--text-300);
  font-weight: 500;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
 }

 .modal .playlist-card:not(.grid-card) .play-button-overlay {
  width: 32px;
  height: 32px;
  background: var(--accent-primary);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: var(--transition-bounce);
  opacity: 0;
  transform: scale(0.8);
  flex-shrink: 0;
  border: 2px solid transparent;
 }

 .modal .playlist-card:not(.grid-card):hover .play-button-overlay {
  opacity: 1;
  transform: scale(1);
 }

 .modal .playlist-card:not(.grid-card) .play-button-overlay:hover {
  background: var(--accent-primary-hover);
  transform: scale(1.1);
  border-color: var(--background-600);
  box-shadow: var(--shadow-md);
 }

 .modal .playlist-card:not(.grid-card) .play-button-overlay svg {
  width: 14px;
  height: 14px;
  fill: var(--text-on-accent);
  margin-left: 1px;
  transition: var(--transition-fast);
 }

 .modal .playlist-card:not(.grid-card) .play-button-overlay:hover svg {
  transform: scale(1.1);
 }

 #dynamic-content .playlists-page {
  min-height: 100vh;
  padding: var(--space-2xl);
  background: var(--background-200);
  animation: fadeInScale 0.6s ease-out;
  position: relative;
 }

 #dynamic-content .playlists-page::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: radial-gradient(circle at 20% 20%, rgba(88, 166, 255, 0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(188, 140, 255, 0.05) 0%, transparent 50%);
  pointer-events: none;
  z-index: 0;
 }

 #dynamic-content .playlists-page > * {
  position: relative;
  z-index: 1;
 }

 #dynamic-content .playlists-page .page-header {
  position: relative;
  margin-bottom: var(--space-2xl);
  padding-bottom: var(--space-xl);
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: var(--space-lg);
 }

 #dynamic-content .playlists-page .page-header::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;
  width: 120px;
  height: 4px;
  background: linear-gradient(90deg, var(--accent-primary), var(--accent-purple));
  border-radius: var(--radius-full);
 }

 #dynamic-content .playlists-page .page-header h1 {
  font-size: clamp(2.5rem, 5vw, 4rem);
  font-weight: 900;
  line-height: 1.1;
  background: linear-gradient(135deg, var(--text-100) 0%, var(--text-200) 60%, var(--accent-primary) 100%);
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: var(--space-sm);
 }

 #dynamic-content .playlists-page .page-header p {
  color: var(--text-300);
  font-size: 1.25rem;
  font-weight: 500;
 }

 #dynamic-content .create-playlist-btn {
  position: relative;
  background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-purple) 100%);
  border: none;
  color: var(--text-on-accent);
  padding: var(--space-lg) var(--space-2xl);
  border-radius: var(--radius-full);
  font-weight: 700;
  font-size: 1.1rem;
  cursor: pointer;
  transition: var(--transition-base);
  overflow: hidden;
  display: flex;
  align-items: center;
  gap: var(--space-md);
  box-shadow: var(--shadow-lg);
  background-size: 200% 200%;
  animation: gradient-shift 4s ease infinite;
  white-space: nowrap;
  min-width: 200px;
 }

 #dynamic-content .create-playlist-btn::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: var(--transition-base);
 }

 #dynamic-content .create-playlist-btn:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: var(--shadow-xl);
 }

 #dynamic-content .create-playlist-btn:hover::before {
  left: 100%;
 }

 #dynamic-content .create-playlist-btn:active {
  transform: translateY(-1px) scale(1.02);
 }

 #dynamic-content .create-playlist-btn svg {
  width: 22px;
  height: 22px;
  transition: var(--transition-fast);
 }

 #dynamic-content .create-playlist-btn:hover svg {
  transform: rotate(90deg);
 }

 #dynamic-content .playlists-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: var(--space-2xl);
  margin-top: var(--space-2xl);
 }

 #dynamic-content .playlist-card {
  background: var(--background-400);
  border-radius: var(--radius-xl);
  overflow: hidden;
  transition: var(--transition-base);
  cursor: pointer;
  position: relative;
  box-shadow: var(--shadow-md);
  border: 1px solid var(--border-200);
  animation: fadeInUp 0.6s ease-out backwards;
  transform-origin: center bottom;
 }

 #dynamic-content .playlist-card:hover {
  background: var(--background-500);
  transform: translateY(-8px) scale(1.02);
  box-shadow: var(--shadow-xl);
  border-color: var(--accent-primary);
 }

 #dynamic-content .playlist-card::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--accent-primary), var(--accent-purple));
  transform: scaleX(0);
  transition: var(--transition-base);
  transform-origin: left;
  z-index: var(--z-base);
 }

 #dynamic-content .playlist-card:hover::before {
  transform: scaleX(1);
 }

 #dynamic-content .playlist-cover {
  aspect-ratio: 1;
  background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-primary) 100%);
  position: relative;
  overflow: hidden;
  background-size: 200% 200%;
  animation: gradient-shift 8s ease infinite;
 }

 #dynamic-content .playlist-cover::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.2) 0%, rgba(0, 0, 0, 0.4) 100%);
  opacity: 0.3;
  transition: var(--transition-base);
 }

 #dynamic-content .playlist-card:hover .playlist-cover::before {
  opacity: 0.1;
 }

 #dynamic-content .playlist-cover .absolute.inset-0 {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2;
 }

 #dynamic-content .playlist-cover svg {
  width: 4rem;
  height: 4rem;
  color: var(--text-on-accent);
  opacity: 0.9;
  transition: var(--transition-base);
  animation: float 5s ease-in-out infinite;
 }

 #dynamic-content .playlist-card:hover .playlist-cover svg {
  opacity: 1;
  transform: scale(1.1);
 }

 #dynamic-content .playlist-cover .absolute.top-2.right-2 {
  position: absolute;
  top: var(--space-md);
  right: var(--space-md);
  z-index: 3;
 }

 #dynamic-content .play-playlist-btn {
  width: 3rem;
  height: 3rem;
  background: var(--accent-primary);
  border: none;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: var(--transition-bounce);
  opacity: 0;
  transform: scale(0.8);
  box-shadow: var(--shadow-lg);
 }

 #dynamic-content .playlist-card:hover .play-playlist-btn {
  opacity: 1;
  transform: scale(1);
  animation: pulse-glow 2s infinite;
 }

 #dynamic-content .play-playlist-btn:hover {
  background: var(--accent-primary-hover);
  transform: scale(1.15);
 }

 #dynamic-content .play-playlist-btn svg {
  width: 1.25rem;
  height: 1.25rem;
  color: var(--text-on-accent);
  margin-left: 2px;
 }

 #dynamic-content .playlist-card .p-4 {
  padding: var(--space-lg);
  position: relative;
 }

 #dynamic-content .playlist-card h3 {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--text-100);
  margin-bottom: var(--space-xs);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  transition: var(--transition-fast);
 }

 #dynamic-content .playlist-card:hover h3 {
  color: var(--accent-primary);
 }

 #dynamic-content .playlist-card p {
  color: var(--text-300);
  font-size: 1rem;
  margin-bottom: var(--space-lg);
  font-weight: 500;
 }

 #dynamic-content .playlist-card .flex.gap-2 {
  display: flex;
  gap: var(--space-md);
 }

 #dynamic-content .view-playlist-btn {
  flex: 1;
  background: var(--background-600);
  color: var(--text-100);
  border: none;
  padding: var(--space-md) var(--space-lg);
  border-radius: var(--radius-lg);
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition-base);
  position: relative;
  overflow: hidden;
  border: 1px solid var(--border-200);
 }

 #dynamic-content .view-playlist-btn::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  transition: var(--transition-base);
 }

 #dynamic-content .view-playlist-btn:hover {
  background: var(--accent-primary);
  border-color: var(--accent-primary);
  transform: translateY(-2px);
 }

 #dynamic-content .view-playlist-btn:hover::before {
  left: 100%;
 }

 #dynamic-content .delete-playlist-btn {
  padding: var(--space-md);
  background: var(--accent-danger);
  color: var(--text-on-accent);
  border: none;
  border-radius: var(--radius-lg);
  cursor: pointer;
  transition: var(--transition-base);
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid transparent;
 }

 #dynamic-content .delete-playlist-btn:hover {
  background: var(--accent-danger-hover);
  border-color: var(--accent-danger-hover);
  transform: translateY(-2px) scale(1.05);
  box-shadow: var(--shadow-lg);
 }

 #dynamic-content .delete-playlist-btn svg {
  width: 1.125rem;
  height: 1.125rem;
 }

 #dynamic-content .playlist-page {
  min-height: 100vh;
  padding: var(--space-2xl);
  background: var(--background-200);
  animation: fadeInScale 0.6s ease-out;
  position: relative;
 }

 #dynamic-content .playlist-page::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: radial-gradient(circle at 20% 20%, rgba(88, 166, 255, 0.08) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(188, 140, 255, 0.08) 0%, transparent 50%);
  pointer-events: none;
  z-index: 0;
 }

 #dynamic-content .playlist-page > * {
  position: relative;
  z-index: 1;
 }

 #dynamic-content .playlist-header {
  display: flex;
  align-items: flex-start;
  gap: var(--space-2xl);
  margin-bottom: var(--space-3xl);
  padding: var(--space-xl);
  background: var(--background-300);
  border-radius: var(--radius-2xl);
  border: 1px solid var(--border-200);
  backdrop-filter: var(--blur-md);
  position: relative;
  overflow: hidden;
  box-shadow: var(--shadow-lg);
 }

 #dynamic-content .playlist-header::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(88, 166, 255, 0.03) 0%, rgba(188, 140, 255, 0.03) 100%);
  z-index: -1;
 }

 #dynamic-content .playlist-header .playlist-cover {
  width: 12rem;
  height: 12rem;
  background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-primary) 100%);
  border-radius: var(--radius-xl);
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
  flex-shrink: 0;
  box-shadow: var(--shadow-xl);
  border: 1px solid var(--border-300);
  background-size: 200% 200%;
  animation: gradient-shift 10s ease infinite;
 }

 #dynamic-content .playlist-header .playlist-cover::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.1) 0%, rgba(0, 0, 0, 0.3) 100%);
  opacity: 0.2;
  transition: var(--transition-base);
 }

 #dynamic-content .playlist-header .playlist-cover:hover::before {
  opacity: 0.1;
 }

 #dynamic-content .playlist-header .playlist-cover svg {
  width: 6rem;
  height: 6rem;
  color: var(--text-on-accent);
  opacity: 0.9;
  transition: var(--transition-base);
  animation: float 8s ease-in-out infinite;
  z-index: 2;
  position: relative;
 }

 #dynamic-content .playlist-header .playlist-cover:hover svg {
  opacity: 1;
  transform: scale(1.05);
 }

 #dynamic-content .playlist-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  min-height: 12rem;
  animation: slideInRight 0.8s ease-out 0.2s backwards;
 }

 #dynamic-content .playlist-info p:first-child {
  font-size: 0.875rem;
  font-weight: 700;
  color: var(--text-400);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  margin-bottom: var(--space-sm);
  opacity: 0.8;
 }

 #dynamic-content .playlist-info h1 {
  font-size: clamp(2.5rem, 6vw, 4.5rem);
  font-weight: 900;
  line-height: 1.1;
  margin-bottom: var(--space-lg);
  background: linear-gradient(135deg, var(--text-100) 0%, var(--text-200) 60%, var(--accent-primary) 100%);
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  position: relative;
 }

 #dynamic-content .playlist-info h1::after {
  content: "";
  position: absolute;
  bottom: -8px;
  left: 0;
  width: 80px;
  height: 4px;
  background: linear-gradient(90deg, var(--accent-primary), var(--accent-purple));
  border-radius: var(--radius-full);
  animation: fadeInUp 1s ease-out 0.5s backwards;
 }

 #dynamic-content .playlist-info > p:nth-of-type(2) {
  font-size: 1.125rem;
  color: var(--text-300);
  margin-bottom: var(--space-xl);
  font-weight: 500;
  line-height: 1.5;
 }

 #dynamic-content .playlist-info .flex.gap-4 {
  display: flex;
  gap: var(--space-lg);
  flex-wrap: wrap;
  align-items: center;
 }

 #dynamic-content .playlist-info .play-playlist-btn {
  background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-purple) 100%);
  color: var(--text-on-accent);
  border: none;
  padding: var(--space-lg) var(--space-2xl);
  border-radius: var(--radius-full);
  font-size: 1.125rem;
  font-weight: 700;
  cursor: pointer;
  transition: var(--transition-base);
  display: flex;
  align-items: center;
  gap: var(--space-md);
  position: relative;
  overflow: hidden;
  box-shadow: var(--shadow-lg);
  background-size: 200% 200%;
  animation: gradient-shift 6s ease infinite;
  min-width: 140px;
 }

 #dynamic-content .playlist-info .play-playlist-btn::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: var(--transition-base);
 }

 #dynamic-content .playlist-info .play-playlist-btn:not([disabled]):hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: var(--shadow-xl);
 }

 #dynamic-content .playlist-info .play-playlist-btn:not([disabled]):hover::before {
  left: 100%;
 }

 #dynamic-content .playlist-info .play-playlist-btn:disabled {
  background: var(--background-600);
  cursor: not-allowed;
  opacity: 0.6;
  transform: none;
  box-shadow: var(--shadow-sm);
 }

 #dynamic-content .playlist-info .play-playlist-btn svg {
  width: 1.25rem;
  height: 1.25rem;
  margin-left: 2px;
  transition: var(--transition-fast);
 }

 #dynamic-content .playlist-info .play-playlist-btn:not([disabled]):hover svg {
  transform: scale(1.1);
 }

 #dynamic-content .edit-playlist-btn {
  background: var(--background-600);
  color: var(--text-100);
  border: 1px solid var(--border-300);
  padding: var(--space-lg) var(--space-xl);
  border-radius: var(--radius-full);
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition-base);
  position: relative;
  overflow: hidden;
 }

 #dynamic-content .edit-playlist-btn::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  transition: var(--transition-base);
 }

 #dynamic-content .edit-playlist-btn:hover {
  background: var(--accent-primary);
  border-color: var(--accent-primary);
  transform: translateY(-2px);
 }

 #dynamic-content .edit-playlist-btn:hover::before {
  left: 100%;
 }

 #dynamic-content .playlist-info .delete-playlist-btn {
  background: var(--accent-danger);
  color: var(--text-on-accent);
  border: 1px solid transparent;
  padding: var(--space-lg) var(--space-xl);
  border-radius: var(--radius-full);
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition-base);
  position: relative;
  overflow: hidden;
 }

 #dynamic-content .playlist-info .delete-playlist-btn::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  transition: var(--transition-base);
 }

 #dynamic-content .playlist-info .delete-playlist-btn:hover {
  background: var(--accent-danger-hover);
  border-color: var(--accent-danger-hover);
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
 }

 #dynamic-content .playlist-info .delete-playlist-btn:hover::before {
  left: 100%;
 }

 #dynamic-content .empty-playlist {
  text-align: center;
  padding: var(--space-3xl) var(--space-xl);
  background: var(--background-300);
  border-radius: var(--radius-2xl);
  border: 2px dashed var(--border-300);
  margin-top: var(--space-2xl);
  position: relative;
  overflow: hidden;
  animation: fadeInUp 0.8s ease-out 0.4s backwards;
  box-shadow: var(--shadow-md);
 }

 #dynamic-content .empty-playlist::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(88, 166, 255, 0.02) 0%, rgba(188, 140, 255, 0.02) 100%);
  z-index: -1;
 }

 #dynamic-content .empty-playlist svg {
  width: 5rem;
  height: 5rem;
  color: var(--text-400);
  margin: 0 auto var(--space-lg);
  opacity: 0.7;
  animation: float 6s ease-in-out infinite;
 }

 #dynamic-content .empty-playlist h3 {
  font-size: 1.75rem;
  font-weight: 700;
  color: var(--text-100);
  margin-bottom: var(--space-sm);
  opacity: 0.9;
 }

 #dynamic-content .empty-playlist p {
  color: var(--text-300);
  font-size: 1.125rem;
  margin-bottom: var(--space-xl);
  line-height: 1.6;
 }

 #dynamic-content .browse-music-btn {
  background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-purple) 100%);
  color: var(--text-on-accent);
  border: none;
  padding: var(--space-md) var(--space-xl);
  border-radius: var(--radius-full);
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition-base);
  position: relative;
  overflow: hidden;
  box-shadow: var(--shadow-lg);
  background-size: 200% 200%;
  animation: gradient-shift 7s ease infinite;
 }

 #dynamic-content .browse-music-btn::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: var(--transition-base);
 }

 #dynamic-content .browse-music-btn:hover {
  transform: translateY(-2px) scale(1.05);
  box-shadow: var(--shadow-xl);
 }

 #dynamic-content .browse-music-btn:hover::before {
  left: 100%;
 }

 #dynamic-content .playlist-card:not(.grid-card) {
  background: var(--background-400);
  border-radius: var(--radius-xl);
  padding: var(--space-lg);
  transition: var(--transition-base);
  cursor: pointer;
  position: relative;
  box-shadow: var(--shadow-md);
  border: 1px solid var(--border-200);
  animation: fadeInUp 0.6s ease-out backwards;
  display: flex;
  align-items: center;
  gap: var(--space-lg);
  overflow: hidden;
  margin-bottom: var(--space-md);
 }

 #dynamic-content .playlist-card:not(.grid-card):hover {
  background: var(--background-500);
  transform: translateX(8px);
  box-shadow: var(--shadow-lg);
  border-color: var(--accent-primary);
 }

 #dynamic-content .playlist-card:not(.grid-card)::before {
  content: "";
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 4px;
  background: linear-gradient(180deg, var(--accent-primary), var(--accent-purple));
  transform: scaleY(0);
  transition: var(--transition-base);
  transform-origin: bottom;
 }

 #dynamic-content .playlist-card:not(.grid-card):hover::before {
  transform: scaleY(1);
 }

 #dynamic-content .playlist-card:not(.grid-card) .playlist-icon {
  width: 56px !important;
  height: 56px !important;
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-purple)) !important;
  border-radius: var(--radius-lg) !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  flex-shrink: 0 !important;
  position: relative;
  overflow: hidden;
  box-shadow: var(--shadow-md);
  transition: var(--transition-base);
  background-size: 200% 200%;
  animation: gradient-shift 8s ease infinite;
 }

 #dynamic-content .playlist-card:not(.grid-card) .playlist-icon::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), transparent);
  opacity: 0;
  transition: var(--transition-fast);
 }

 #dynamic-content .playlist-card:not(.grid-card):hover .playlist-icon {
  transform: scale(1.05);
  box-shadow: var(--shadow-lg);
 }

 #dynamic-content .playlist-card:not(.grid-card):hover .playlist-icon::before {
  opacity: 1;
 }

 #dynamic-content .playlist-card:not(.grid-card) .playlist-icon svg {
  width: 28px;
  height: 28px;
  fill: var(--text-on-accent);
  transition: var(--transition-fast);
  animation: float 6s ease-in-out infinite;
 }

 #dynamic-content .playlist-card:not(.grid-card):hover .playlist-icon svg {
  transform: scale(1.1);
 }

 #dynamic-content .playlist-card:not(.grid-card) .playlist-info {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
 }

 #dynamic-content .playlist-card:not(.grid-card) .playlist-name {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--text-100);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  transition: var(--transition-fast);
  line-height: 1.2;
 }

 #dynamic-content .playlist-card:not(.grid-card):hover .playlist-name {
  color: var(--accent-primary);
 }

 #dynamic-content .playlist-card:not(.grid-card) .playlist-tracks {
  font-size: 1rem;
  color: var(--text-300);
  font-weight: 500;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
 }

 #dynamic-content .playlist-card:not(.grid-card) .play-button-overlay {
  width: 48px;
  height: 48px;
  background: var(--accent-primary);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: var(--transition-bounce);
  opacity: 0;
  transform: scale(0.8);
  flex-shrink: 0;
  border: 3px solid transparent;
  box-shadow: var(--shadow-md);
 }

 #dynamic-content .playlist-card:not(.grid-card):hover .play-button-overlay {
  opacity: 1;
  transform: scale(1);
  animation: pulse-glow 2s infinite;
 }

 #dynamic-content .playlist-card:not(.grid-card) .play-button-overlay:hover {
  background: var(--accent-primary-hover);
  transform: scale(1.15);
  border-color: var(--background-600);
  box-shadow: var(--shadow-lg);
 }

 #dynamic-content .playlist-card:not(.grid-card) .play-button-overlay svg {
  width: 20px;
  height: 20px;
  fill: var(--text-on-accent);
  margin-left: 2px;
  transition: var(--transition-fast);
 }

 #dynamic-content .playlist-card:not(.grid-card) .play-button-overlay:hover svg {
  transform: scale(1.1);
 }

 .modal .playlist-card:nth-child(1) {
  animation-delay: 0ms;
 }
 .modal .playlist-card:nth-child(2) {
  animation-delay: 100ms;
 }
 .modal .playlist-card:nth-child(3) {
  animation-delay: 200ms;
 }
 .modal .playlist-card:nth-child(4) {
  animation-delay: 300ms;
 }
 .modal .playlist-card:nth-child(5) {
  animation-delay: 400ms;
 }
 .modal .playlist-card:nth-child(6) {
  animation-delay: 500ms;
 }
 .modal .playlist-card:nth-child(7) {
  animation-delay: 600ms;
 }
 .modal .playlist-card:nth-child(8) {
  animation-delay: 700ms;
 }

 .playlist-card:not(.grid-card):nth-child(1) {
  animation-delay: 0ms;
 }
 .playlist-card:not(.grid-card):nth-child(2) {
  animation-delay: 50ms;
 }
 .playlist-card:not(.grid-card):nth-child(3) {
  animation-delay: 100ms;
 }
 .playlist-card:not(.grid-card):nth-child(4) {
  animation-delay: 150ms;
 }
 .playlist-card:not(.grid-card):nth-child(5) {
  animation-delay: 200ms;
 }
 .playlist-card:not(.grid-card):nth-child(6) {
  animation-delay: 250ms;
 }
 .playlist-card:not(.grid-card):nth-child(7) {
  animation-delay: 300ms;
 }
 .playlist-card:not(.grid-card):nth-child(8) {
  animation-delay: 350ms;
 }
 .playlist-card:not(.grid-card):nth-child(9) {
  animation-delay: 400ms;
 }
 .playlist-card:not(.grid-card):nth-child(10) {
  animation-delay: 450ms;
 }

 .playlist-card:not(.grid-card):active {
  transform: translateX(2px) scale(0.98);
 }

 .playlist-card:not(.grid-card) .play-button-overlay:active {
  transform: scale(0.95);
 }

 .playlist-card:not(.grid-card).loading {
  opacity: 0.6;
  pointer-events: none;
 }

 .playlist-card:not(.grid-card).loading .playlist-icon {
  animation: pulse 1.5s ease-in-out infinite;
 }

 .playlist-card:not(.grid-card).selected {
  background: var(--background-500);
  border-color: var(--accent-primary);
  transform: translateX(4px);
 }

 .playlist-card:not(.grid-card).selected::before {
  transform: scaleY(1);
 }

 .playlist-card:not(.grid-card).selected .playlist-name {
  color: var(--accent-primary);
 }

 .playlist-card:not(.grid-card):disabled,
 .playlist-card:not(.grid-card).disabled {
  opacity: 0.5;
  cursor: not-allowed;
  pointer-events: none;
 }

 .playlist-card:not(.grid-card):disabled:hover,
 .playlist-card:not(.grid-card).disabled:hover {
  transform: none;
  background: var(--background-400);
  border-color: var(--border-200);
 }

 @media (max-width: 1024px) {
  #dynamic-content .playlists-grid {
   grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
   gap: var(--space-xl);
  }

  #dynamic-content .playlist-header {
   gap: var(--space-xl);
   padding: var(--space-lg);
  }

  #dynamic-content .playlist-header .playlist-cover {
   width: 10rem;
   height: 10rem;
  }

  #dynamic-content .playlist-header .playlist-cover svg {
   width: 5rem;
   height: 5rem;
  }
 }

 @media (max-width: 768px) {
  .modal .playlists-page {
   padding: var(--space-md);
  }

  .modal .playlists-grid {
   grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
   gap: var(--space-md);
  }

  .modal .page-header {
   flex-direction: column;
   align-items: stretch;
   gap: var(--space-md);
  }

  .modal .create-playlist-btn {
   justify-content: center;
  }

  .modal .playlist-card:not(.grid-card) {
   padding: var(--space-sm) var(--space-md);
   gap: var(--space-sm);
  }

  .modal .playlist-card:not(.grid-card) .playlist-icon {
   width: 36px !important;
   height: 36px !important;
  }

  .modal .playlist-card:not(.grid-card) .playlist-icon svg {
   width: 18px;
   height: 18px;
  }

  .modal .playlist-card:not(.grid-card) .playlist-name {
   font-size: 0.9rem;
  }

  .modal .playlist-card:not(.grid-card) .playlist-tracks {
   font-size: 0.75rem;
  }

  .modal .playlist-card:not(.grid-card) .play-button-overlay {
   width: 28px;
   height: 28px;
  }

  .modal .playlist-card:not(.grid-card) .play-button-overlay svg {
   width: 12px;
   height: 12px;
  }

  #dynamic-content .playlists-page,
  #dynamic-content .playlist-page {
   padding: var(--space-xl);
  }

  #dynamic-content .playlists-grid {
   grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
   gap: var(--space-lg);
  }

  #dynamic-content .playlist-header {
   flex-direction: column;
   align-items: center;
   text-align: center;
   gap: var(--space-lg);
  }

  #dynamic-content .playlist-header .playlist-cover {
   width: 8rem;
   height: 8rem;
  }

  #dynamic-content .playlist-header .playlist-cover svg {
   width: 4rem;
   height: 4rem;
  }

  #dynamic-content .playlist-info h1 {
   font-size: 2.5rem;
  }

  #dynamic-content .playlist-info .flex.gap-4 {
   justify-content: center;
   gap: var(--space-md);
  }

  #dynamic-content .playlist-info .play-playlist-btn,
  #dynamic-content .edit-playlist-btn,
  #dynamic-content .playlist-info .delete-playlist-btn {
   padding: var(--space-md) var(--space-lg);
   font-size: 1rem;
  }

  #dynamic-content .page-header {
   flex-direction: column;
   align-items: flex-start;
   gap: var(--space-lg);
  }

  #dynamic-content .create-playlist-btn {
   align-self: stretch;
   justify-content: center;
  }

  #dynamic-content .playlist-card:not(.grid-card) {
   padding: var(--space-md) var(--space-lg);
   gap: var(--space-md);
  }

  #dynamic-content .playlist-card:not(.grid-card) .playlist-icon {
   width: 48px !important;
   height: 48px !important;
  }

  #dynamic-content .playlist-card:not(.grid-card) .playlist-icon svg {
   width: 24px;
   height: 24px;
  }

  #dynamic-content .playlist-card:not(.grid-card) .playlist-name {
   font-size: 1.1rem;
  }

  #dynamic-content .playlist-card:not(.grid-card) .playlist-tracks {
   font-size: 0.9rem;
  }

  #dynamic-content .playlist-card:not(.grid-card) .play-button-overlay {
   width: 40px;
   height: 40px;
  }

  #dynamic-content .playlist-card:not(.grid-card) .play-button-overlay svg {
   width: 16px;
   height: 16px;
  }
 }

 @media (max-width: 480px) {
  .modal .playlists-grid {
   grid-template-columns: 1fr;
   gap: var(--space-md);
  }

  .modal .playlist-card .flex.gap-2 {
   flex-direction: column;
   gap: var(--space-sm);
  }

  .modal .delete-playlist-btn {
   align-self: flex-end;
   width: fit-content;
  }

  .modal .playlist-card:not(.grid-card) {
   padding: var(--space-sm);
   gap: var(--space-sm);
  }

  .modal .playlist-card:not(.grid-card) .playlist-icon {
   width: 32px !important;
   height: 32px !important;
  }

  .modal .playlist-card:not(.grid-card) .playlist-icon svg {
   width: 16px;
   height: 16px;
  }

  .modal .playlist-card:not(.grid-card) .play-button-overlay {
   width: 24px;
   height: 24px;
  }

  .modal .playlist-card:not(.grid-card) .play-button-overlay svg {
   width: 10px;
   height: 10px;
  }

  #dynamic-content .playlists-page,
  #dynamic-content .playlist-page {
   padding: var(--space-lg);
  }

  #dynamic-content .playlists-grid {
   grid-template-columns: 1fr;
   gap: var(--space-lg);
  }

  #dynamic-content .playlist-card .flex.gap-2 {
   flex-direction: column;
   gap: var(--space-sm);
  }

  #dynamic-content .delete-playlist-btn {
   align-self: flex-end;
   width: fit-content;
  }

  #dynamic-content .playlist-info .flex.gap-4 {
   flex-direction: column;
   align-items: stretch;
   gap: var(--space-sm);
  }

  #dynamic-content .empty-playlist {
   padding: var(--space-xl);
  }

  #dynamic-content .playlist-card:not(.grid-card) {
   padding: var(--space-sm) var(--space-md);
   gap: var(--space-sm);
  }

  #dynamic-content .playlist-card:not(.grid-card) .playlist-icon {
   width: 40px !important;
   height: 40px !important;
  }

  #dynamic-content .playlist-card:not(.grid-card) .playlist-icon svg {
   width: 20px;
   height: 20px;
  }

  #dynamic-content .playlist-card:not(.grid-card) .playlist-name {
   font-size: 1rem;
  }

  #dynamic-content .playlist-card:not(.grid-card) .playlist-tracks {
   font-size: 0.85rem;
  }

  #dynamic-content .playlist-card:not(.grid-card) .play-button-overlay {
   width: 36px;
   height: 36px;
  }

  #dynamic-content .playlist-card:not(.grid-card) .play-button-overlay svg {
   width: 14px;
   height: 14px;
  }
 }

 button:focus-visible,
 .playlist-card:focus-visible {
  outline: 2px solid var(--accent-primary);
  outline-offset: 2px;
 }

 button:focus {
  outline: none;
 }

 @media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
   animation-duration: 0.01ms !important;
   animation-iteration-count: 1 !important;
   transition-duration: 0.01ms !important;
  }

  .playlist-cover svg,
  .empty-playlist svg {
   animation: none;
  }

  .create-playlist-btn,
  .playlist-cover {
   background-size: 100% 100%;
   animation: none;
  }
 }

 @media (prefers-contrast: high) {
  .playlist-card {
   border-width: 2px;
  }

  .playlist-header {
   border-width: 2px;
  }
 }
</style>








<style>

:root {
  /* Shadows - Universal across themes */
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
  --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);
  --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15), 0 6px 10px rgba(0, 0, 0, 0.08);
  --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.2), 0 10px 20px rgba(0, 0, 0, 0.1);
  --shadow-2xl: 0 25px 50px rgba(0, 0, 0, 0.25), 0 15px 30px rgba(0, 0, 0, 0.15);
  --shadow-nav: 0 8px 24px rgba(0, 0, 0, 0.18), 0 4px 12px rgba(0, 0, 0, 0.12);
  --shadow-inset: inset 0 2px 4px rgba(0, 0, 0, 0.06);

  /* Blur Effects */
  --blur-sm: blur(4px);
  --blur-md: blur(8px);
  --blur-lg: blur(16px);
  --blur-xl: blur(24px);
  --blur-nav: blur(12px);

  /* Transitions */
  --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-base: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-smooth: 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  --transition-bounce: 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  --transition-elastic: 0.5s cubic-bezier(0.68, -0.6, 0.32, 1.6);

  /* Border Radius */
  --radius-xs: 4px;
  --radius-sm: 6px;
  --radius-md: 8px;
  --radius-lg: 12px;
  --radius-xl: 16px;
  --radius-2xl: 24px;
  --radius-full: 9999px;

  /* Z-index Layers */
  --z-base: 1;
  --z-dropdown: 10;
  --z-sticky: 20;
  --z-overlay: 30;
  --z-modal: 40;
  --z-popover: 50;
  --z-tooltip: 60;
  --z-notification: 70;
  --z-player: 100;
  --z-player-controls: 110;
  --z-nav: 100;
  --z-search: 100;

  /* Spacing Scale */
  --space-xs: 0.25rem;
  --space-sm: 0.5rem;
  --space-md: 1rem;
  --space-lg: 1.5rem;
  --space-xl: 2rem;
  --space-2xl: 3rem;
  --space-3xl: 4rem;
}

[data-theme="dark"] {
  /* Background Colors - Dark to Light */
  --background-100: #0d1117; /* Deepest background */
  --background-200: #161b22; /* Body background */
  --background-300: #1c2128; /* Main content */
  --background-400: #22272e; /* Cards/panels */
  --background-500: #2d333b; /* Elevated surfaces */
  --background-600: #373e47; /* Hover states */
  --background-700: #444c56; /* Active states */
  --background-800: #545d68; /* Subtle emphasis */
  --background-900: #636e7b; /* Maximum elevation */
  

  --breadCrumbsBG: rgba(22, 27, 34, 0.75);


  
  
  /* Special Backgrounds */
  --background-canvas: #22272e;
  --background-overlay: rgba(28, 33, 40, 0.95);
  --background-overlay-solid: #2d333b;
  --background-inset: #1c2128;
  --background-songs: rgba(34, 39, 46, 1);
  --background-gradient: linear-gradient(
    to bottom,
    rgba(28, 33, 40, 0) 0%,
    rgba(28, 33, 40, 0.05) 10%,
    rgba(28, 33, 40, 0.25) 30%,
    rgba(28, 33, 40, 0.5) 50%,
    rgba(28, 33, 40, 0.75) 70%,
    rgba(28, 33, 40, 0.95) 90%,
    rgba(28, 33, 40, 1) 100%
  );

  /* Border Colors */
  --border-100: #21262d; /* Subtle borders */
  --border-200: #30363d; /* Default borders */
  --border-300: #444c56; /* Emphasized borders */
  --border-400: #545d68; /* Strong borders */
  --border-500: #6e7681; /* Focus borders */
  --border-accent: #58a6ff; /* Accent borders */

  /* Text Colors */
  --text-100: #f0f6fc; /* Primary text */
  --text-200: #c9d1d9; /* Secondary text */
  --text-300: #8b949e; /* Muted text */
  --text-400: #6e7681; /* Subtle text */
  --text-500: #484f58; /* Disabled text */
  --text-inverse: #0d1117; /* Text on light backgrounds */
  --text-on-accent: #ffffff; /* Text on accent backgrounds */

  /* Accent Colors */
  --accent-primary: #58a6ff; /* Primary blue */
  --accent-primary-hover: #79b8ff;
  --accent-primary-active: #388bfd;
  --accent-secondary: #316dca;
  --accent-success: #3fb950;
  --accent-success-hover: #56d364;
  --accent-warning: #d29922;
  --accent-warning-hover: #f0b638;
  --accent-danger: #f85149;
  --accent-danger-hover: #ff6b63;
  --accent-info: #58a6ff;
  --accent-purple: #bc8cff;
  --accent-pink: #ff7b9d;

  /* Component-specific */
  --scrollbar-track: var(--background-300);
  --scrollbar-thumb: var(--background-600);
  --scrollbar-thumb-hover: var(--background-700);
  --input-background: var(--background-200);
  --input-border: var(--border-200);
  --button-background: var(--background-500);
  --button-hover: var(--background-600);
  --button-active: var(--background-700);
}

[data-theme="dim"] {
  /* Background Colors - Dark to Light */
  --background-100: #1a1f26; /* Deepest background */
  --background-200: #22282f; /* Body background */
  --background-300: #2a3139; /* Main content */
  --background-400: #333b45; /* Cards/panels */
  --background-500: #3d4651; /* Elevated surfaces */
  --background-600: #4a5461; /* Hover states */
  --background-700: #5a6472; /* Active states */
  --background-800: #6b7583; /* Subtle emphasis */
  --background-900: #7d8694; /* Maximum elevation */
  
  --breadCrumbsBG: rgba(37, 42, 49, 0.75);


  
  
  
  /* Special Backgrounds */
  --background-canvas: #333b45;
  --background-overlay: rgba(42, 49, 57, 0.95);
  --background-overlay-solid: #3d4651;
  --background-inset: #2a3139;
  --background-songs: rgba(51, 59, 69, 1);
  --background-gradient: linear-gradient(
    to bottom,
    rgba(42, 49, 57, 0) 0%,
    rgba(42, 49, 57, 0.05) 10%,
    rgba(42, 49, 57, 0.25) 30%,
    rgba(42, 49, 57, 0.5) 50%,
    rgba(42, 49, 57, 0.75) 70%,
    rgba(42, 49, 57, 0.95) 90%,
    rgba(42, 49, 57, 1) 100%
  );

  /* Border Colors */
  --border-100: #333b45; /* Subtle borders */
  --border-200: #444d58; /* Default borders */
  --border-300: #5a6472; /* Emphasized borders */
  --border-400: #6b7583; /* Strong borders */
  --border-500: #848d97; /* Focus borders */
  --border-accent: #6cb6ff; /* Accent borders */

  /* Text Colors */
  --text-100: #f7f8fa; /* Primary text */
  --text-200: #dde2e8; /* Secondary text */
  --text-300: #a7b1bd; /* Muted text */
  --text-400: #8a95a2; /* Subtle text */
  --text-500: #6a7481; /* Disabled text */
  --text-inverse: #1a1f26; /* Text on light backgrounds */
  --text-on-accent: #ffffff; /* Text on accent backgrounds */

  /* Accent Colors */
  --accent-primary: #6cb6ff; /* Primary blue */
  --accent-primary-hover: #8dc5ff;
  --accent-primary-active: #4ea1ff;
  --accent-secondary: #4d7fc7;
  --accent-success: #56c463;
  --accent-success-hover: #6dd079;
  --accent-warning: #e6a835;
  --accent-warning-hover: #f0b94f;
  --accent-danger: #ff6b61;
  --accent-danger-hover: #ff857d;
  --accent-info: #6cb6ff;
  --accent-purple: #c79eff;
  --accent-pink: #ff8fab;

  /* Component-specific */
  --scrollbar-track: var(--background-300);
  --scrollbar-thumb: var(--background-600);
  --scrollbar-thumb-hover: var(--background-700);
  --input-background: var(--background-200);
  --input-border: var(--border-200);
  --button-background: var(--background-500);
  --button-hover: var(--background-600);
  --button-active: var(--background-700);
}


[data-theme="light"] {
            --background-200: #f8f9fa; /* Body background */
            --background-300: #f1f3f5; /* Main content */
            --background-400: #e9ecef; /* Cards/panels */
            --background-500: #dee2e6; /* Elevated surfaces */
            --background-600: #ced4da; /* Hover states */
            --background-700: #adb5bd; /* Active states */
            --background-800: #8c959f; /* Subtle emphasis */
            --background-900: #6c757d; /* Maximum elevation */
            
              --breadCrumbsBG: rgba(240, 240, 240, 0.75);


            
            /* Special Backgrounds */
            --background-canvas: #f1f3f5;
            --background-overlay: rgba(241, 243, 245, 0.95);
            --background-overlay-solid: #e9ecef;
            --background-inset: #f8f9fa;
            --background-songs: rgba(241, 243, 245, 1);
            --background-gradient: linear-gradient(
                to bottom,
                rgba(241, 243, 245, 0) 0%,
                rgba(241, 243, 245, 0.05) 10%,
                rgba(241, 243, 245, 0.25) 30%,
                rgba(241, 243, 245, 0.5) 50%,
                rgba(241, 243, 245, 0.75) 70%,
                rgba(241, 243, 245, 0.95) 90%,
                rgba(241, 243, 245, 1) 100%
            );

            /* Border Colors */
            --border-100: #e9ecef; /* Subtle borders */
            --border-200: #dee2e6; /* Default borders */
            --border-300: #ced4da; /* Emphasized borders */
            --border-400: #adb5bd; /* Strong borders */
            --border-500: #8c959f; /* Focus borders */
            --border-accent: #3b5bdb; /* Accent borders - slightly brighter blue */

            /* Text Colors */
            --text-100: #212529; /* Primary text */
            --text-200: #495057; /* Secondary text */
            --text-300: #6c757d; /* Muted text */
            --text-400: #adb5bd; /* Subtle text */
            --text-500: #ced4da; /* Disabled text */
            --text-inverse: #ffffff; /* Text on dark backgrounds */
            --text-on-accent: #ffffff; /* Text on accent backgrounds */

            /* Accent Colors */
            --accent-primary: #3b5bdb; /* Primary blue - brighter */
            --accent-primary-hover: #4263eb;
            --accent-primary-active: #364fc7;
            --accent-secondary: #5c7cfa;
            --accent-success: #2b8a3e;
            --accent-success-hover: #2f9e44;
            --accent-warning: #e67700;
            --accent-warning-hover: #f08c00;
            --accent-danger: #e03131;
            --accent-danger-hover: #f03e3e;
            --accent-info: #1c7ed6;
            --accent-purple: #7950f2;
            --accent-pink: #cc5de8;

            /* Component-specific */
            --scrollbar-track: var(--background-300);
            --scrollbar-thumb: var(--background-500);
            --scrollbar-thumb-hover: var(--background-600);
            --input-background: var(--background-200);
            --input-border: var(--border-200);
            --button-background: var(--background-400);
            --button-hover: var(--background-500);
            --button-active: var(--background-600);
}



.breadcrumb-navigation {
  background-color: var(--breadCrumbsBG)
  border-bottom: 1.5px solid var(--text-500);
  color: var(--text-100);
}

.artistTop {
  background: var(--background-400);
  border: 1.5px solid var(--gray-750);
}

.artist-header {
  background: linear-gradient(to bottom, 
              rgba(26, 30, 36, 0.2) 0%, 
              var(--background-400) 80%);
}

.content-offset {
  background-color: transparent !important;
  color: var(--text-100);
}

.albumSongsArea {
  background: var(--background-songs) !important;
  border: 1px solid var(--gray-750);
}

.songs-container {
  background: var(--background-300) !important;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

*, body, html {
  scroll-behavior: smooth;
}

body, html {
  position: relative;
  height: 100%;
  overflow-x: hidden;
  scrollbar-width: none;
  -ms-overflow-style: none;
}

::-webkit-scrollbar, body::-webkit-scrollbar, html::-webkit-scrollbar {
  display: none;
}

body {
  background-color: var(--background-200);
  color: var(--text-100);
  line-height: 1;
  max-width: 100vw !important;
  overflow-x: hidden !important;
  overflow-y: auto;
  transition: background-color var(--transition-base), color var(--transition-base);
}

html {
  font-size: 13px !important;
}

* {
  user-select: none !important;
}

#pageWrapper {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  overflow-y: auto;
}

#main-container {
  border-radius: 12px;
  transition: all var(--transition-base);
}

#songName-NAVBar.marquee {
  display: inline-block;
  white-space: nowrap;
  overflow: hidden;
  animation: marquee-scroll 12s linear infinite;
}

.notification {
  position: fixed;
  bottom: 24px;
  left: 50%;
  z-index: var(--z-nav);
  padding: 16px 24px;
  background: var(--background-700);
  border: 1px solid var(--border-accent);
  border-radius: 12px;
  box-shadow: var(--shadow-lg);
  backdrop-filter: var(--blur-md);
  color: var(--text-on-accent);
  font-weight: 500;
  opacity: 1;
  transform: translateX(-50%);
  transition: all var(--transition-base);
}

.notification.fade-out {
  opacity: 0;
  transform: translateX(-50%) translateY(20px) scale(0.95);
}

#contentWrapper {
  position: relative;
  height: 100vh;
  padding-bottom: 5rem;
  overflow-y: auto;
  overscroll-behavior: none;
  overscroll-behavior-y: contain;
}

.musicPlayer {
  position: fixed;
  bottom: 6.5rem;
  left: 50%;
  z-index: var(--z-player);
  width: 92vw;
  max-width: 450px;
  height: 75vh;
  padding: 2rem;
  background: var(--background-600);
  border: 1px solid var(--text-300);
  border-radius: 13px;
  box-shadow: var(--shadow-md);
  backdrop-filter: var(--blur-lg);
  opacity: 0;
  visibility: hidden;
  transform: translateX(-50%) translateY(20px) scale(0.95);
  transition: all 0.25s;
  transition-timing-function: cubic-bezier(0.1, 0.1, 0.4, 0.1);
}

.musicPlayer.show {
  opacity: 1;
  visibility: visible;
  transform: translateX(-50%) translateY(0) scale(1);
}

.musicPlayer .header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 0.25rem;
}

.musicPlayer .close {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2rem;
  height: 2rem;
  border-radius: 50%;
  cursor: pointer;
  transition: all var(--transition-fast);
}

.musicPlayer .body {
  height: 80%;
  padding: 2rem;
  transition: all 0.65s ease-in-out;
}

#popUpTabsWrapper {
  position: relative;
  height: 15%;
  z-index: var(--z-player-controls);
}

.popup-tabs {
  position: absolute;
  bottom: 0.5rem;
  left: -50%;
  display: flex;
  justify-content: center;
  flex: 1;
  width: 100%;
  transform: translateX(50%);
}

.popup-tab {
  flex: 1;
  padding: 12px 0;
  position: relative;
  background: none;
  border: none;
  color: rgba(255, 255, 255, 0.6);
  font-weight: 500;
  text-align: center;
  cursor: pointer;
  transition: color var(--transition-slow);
}

.popup-tab.active {
  color: white;
}

.popup-tab.active::after {
  content: '';
  position: absolute;
  bottom: -1px;
  left: 0;
  right: 0;
  height: 2px;
  background: var(--accent-primary);
}

.popup-tab-content {
  display: none;
  height: 100%;
  opacity: 1;
  pointer-events: none;
  transition: opacity 0.45s ease-in-out;
}

.popup-tab-content[style*="block"] {
  display: block !important;
}

.popup-tab-content.show {
  opacity: 1;
  pointer-events: auto;
}

.popup-tab-content[data-tab="now-playing"] {
  opacity: 1;
  pointer-events: auto;
  transition: 0.45s ease-in-out;
  display: block;
}

.popup-tab-content[data-tab="queue"].show {
  opacity: 1;
  pointer-events: auto;
  transition: 0.45s ease-in-out;
}

.popup-tab-content[data-tab="recent"].show {
  opacity: 1;
  pointer-events: auto;
  transition: 0.45s ease-in-out;
}

.popup-song-item {
  pointer-events: auto;
}

.empty-state {
  padding: 2rem;
  color: var(--accent-primary);
  font-size: 0.875rem;
  text-align: center;
}

.popup-album-cover {
  width: 100%;
  aspect-ratio: 1/1;
  margin-bottom: 0.25rem;
  border: 1.5px dashed var(--background-600);
  border-radius: 16px;
  box-shadow: var(--shadow-lg);
  object-fit: cover;
  transition: all var(--transition-base);
}

.popup-album-cover:hover {
  transform: scale(1.02);
}

.popup-song-info {
  margin: 1.5rem 0;
  text-align: center;
}

.popup-song-title {
  margin: 0 0 0.5rem;
  color: var(--text-100);
  font-size: 1.5rem;
  font-weight: 700;
}

.popup-artist-name {
  margin: 0 0 0.25rem;
  color: var(--text-300);
  font-size: 1rem;
}

.popup-album-name {
  margin: 0;
  color: var(--text-400);
  font-size: 0.875rem;
}

.playerControls {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1.45rem;
  margin-bottom: 2rem;
}

.playerControls > .button {
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  width: 3.05rem;
  height: 3.05rem;
  padding: 0;
  background-color: var(--background-500);
  border: 1px solid var(--border-200);
  border-radius: 50%;
  outline: 0.25px solid transparent;
  box-shadow: var(--shadow-sm);
  overflow: hidden;
  cursor: pointer;
  transition: all var(--transition-smooth);
}

.playerControls > .button .icon {
  width: 1.05rem;
  height: 1.05rem;
  fill: var(--text-100);
  transition: fill var(--transition-smooth), transform var(--transition-smooth);
}

.playerControls > .button:hover {
  box-shadow: var(--shadow-md);
  transform: scale(1.1);
}

.playerControls > .button:hover .icon {
  fill: var(--text-on-accent);
}

.playerControls > .button.active {
  background-color: var(--background-overlay);
  border-color: var(--border-400);
  outline: 0.25px solid var(--accent-primary);
}

.playerControls > .button.active .icon {
  fill: var(--accent-primary);
}

#btnPlayPause {
  width: 4.35rem;
  height: 4.35rem;
}

#btnPlayPause .icon {
  width: 2.05rem;
  height: 2.05rem;
}

.popup-actions {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1rem;
  margin-top: 2rem;
}

.popup-action-btn {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 3rem;
  height: 3rem;
  background: var(--background-500);
  border: 1px solid var(--border-200);
  border-radius: 40%;
  color: var(--text-100);
  cursor: pointer;
  opacity: 1;
  transition: all var(--transition-smooth);
}

.popup-action-btn:hover {
  background: var(--background-overlay);
  color: var(--accent-primary);
  transform: scale(1.025);
  opacity: 1;
  transition: opacity 0.35s ease-in-out;
}

.popup-action-btn.active {
  background: transparent;
  color: var(--accent-primary);
  border-color: var(--text-on-accent);
}

.artist-card {
  position: relative;
  overflow: hidden;
  background: var(--background-600);
  border: 1px solid var(--border-200);
  border-radius: 16px;
  box-shadow: var(--shadow-sm);
  transition: all var(--transition-base);
}

.artist-card:before {
  content: "";
  position: absolute;
  inset: 0;
  z-index: -1;
  background: var(--gradPrimary);
  opacity: 0;
  transition: opacity var(--transition-base);
}

.artist-card:hover {
  border-color: var(--border-accent);
  box-shadow: var(--shadow-xl);
  transform: translateY(-8px) scale(1.02);
}

.artist-card:hover:before {
  opacity: 0.1;
}

.album-card {
  position: relative;
  overflow: hidden;
  overflow-y: auto;
  padding-top: 3rem;
  background: var(--background-300) !important;
  transition: all var(--transition-base);
}

.songs-container {
  margin: 1rem;
}

.album-cover {
  border-radius: 8px;
  box-shadow: var(--shadow-md);
  object-fit: cover;
  border-radius: inherit;
  transition: all var(--transition-base);
  will-change: transform;
}

.album-cover:hover {
  box-shadow: var(--shadow-lg);
  transform: scale(1.03);
}

.album-cover.image-loading {
  border-radius: inherit;
}

.album-cover.image-error {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  background: linear-gradient(135deg, var(--accent-success), var(--accent-warning));
  color: #fff;
  border-radius: inherit;
}

.album-cover.image-error:after {
  content: "🎵";
  font-size: 3rem;
  margin-bottom: 0.5rem;
}

.play-overlay {
  background: rgba(0, 0, 0, 0.4);
  opacity: 0;
  backdrop-filter: var(--blur-sm);
  transition: all var(--transition-base);
}

.group:hover .play-overlay {
  opacity: 1;
}

.song-item {
  position: relative;
  overflow: hidden;
  border-bottom: 1px solid var(--border-100);
  transition: all var(--transition-fast);
  will-change: transform, background-color;
}

.song-toolbar {
  opacity: 0;
  transform: translateX(10px);
  transition: all var(--transition-fast);
  will-change: opacity, transform;
}

.song-item:hover .song-toolbar {
  opacity: 1 !important;
  transform: translateX(0);
}

.album-grid-item {
  cursor: pointer;
  transition: all var(--transition-base);
}

.album-grid-item:hover {
  box-shadow: var(--shadow-lg);
  transform: translateY(-6px) scale(1.02);
}

.album-grid-item .album-image {
  box-shadow: var(--shadow-sm);
  transition: all 0.3s ease;
}

.album-grid-item:hover .album-image {
  box-shadow: var(--shadow-md);
  transform: scale(1.02);
}

.queue-item {
  transition: background-color var(--transition-fast);
}

.queue-item:hover {
  background-color: var(--background-500) !important;
}

.albumFade {
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  width: 100%;
  height: 100%;
  padding: 2rem;
  border-radius: 12px;
  overflow: hidden;
  background-position: top, top;
  background-size: 100% 100%, cover;
  background-repeat: no-repeat, no-repeat;
  color: white;
  background-image:
    var(--background-gradient),
    var(--album-cover);
}

.album-image {
  width: 100%;
  height: 200px;
  border-radius: 15px;
}

.control-button {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
  background: var(--background-500);
  border: 1px solid var(--border-200);
  border-radius: 50%;
  color: var(--text-100);
  cursor: pointer;
  overflow: hidden;
  transition: all var(--transition-fast);
  will-change: transform, background-color, box-shadow;
}

.control-button:before {
  content: "";
  position: absolute;
  inset: 0;
  background: var(--gradPrimary);
  border-radius: inherit;
  opacity: 0;
  transition: opacity var(--transition-fast);
}

.control-button:hover {
  box-shadow: var(--shadow-md);
  transform: scale(1.1);
}

.control-button:hover:before {
  opacity: 1;
}

.control-button.play-pause {
  width: 64px;
  height: 64px;
  background: var(--gradPrimary);
  border: none;
  color: var(--text-on-accent);
  box-shadow: var(--shadow-lg);
}

.control-button.play-pause:hover {
  box-shadow: 0 0 0 12px rgba(83, 155, 245, 0.15);
  transform: scale(1.08);
}

.toolbar-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  background: var(--background-600);
  border: 1px solid var(--border-200);
  border-radius: 8px;
  color: var(--text-300);
  cursor: pointer;
  transition: all var(--transition-fast);
  will-change: transform, background-color, color;
}

.toolbar-button:hover {
  background: var(--accent-primary);
  color: var(--text-on-accent);
  box-shadow: var(--shadow-sm);
  transform: scale(1.15);
}

.toolbar-button.favorite.active {
  background: var(--accent-danger);
  color: var(--text-on-accent);
}

.floating-add-button {
  position: fixed;
  bottom: 32px;
  right: 32px;
  z-index: 10;
  width: 64px;
  height: 64px;
  background: var(--gradPrimary);
  border: none;
  border-radius: 50%;
  box-shadow: var(--shadow-lg);
  cursor: pointer;
  transition: all var(--transition-base);
}

.floating-add-button:hover {
  box-shadow: var(--shadow-xl);
  transform: scale(1.15) rotate(90deg);
}

.button-loading {
  position: relative;
  pointer-events: none;
  overflow: hidden;
}

.button-loading:after {
  content: "";
  position: absolute;
  top: 50%;
  left: 50%;
  width: 20px;
  height: 20px;
  margin: -10px 0 0 -10px;
  border: 2px solid hsla(0, 0%, 100%, 0.3);
  border-top: 2px solid var(--text-on-accent);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

.button {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0.5rem;
  background-color: transparent;
  border: none;
  color: var(--text-100);
  cursor: pointer;
  transition: all var(--transition-fast);
}

.button:hover {
  color: var(--accent-primary);
  transform: scale(1.1);
}

.icon {
  width: 1.5rem;
  height: 1.5rem;
  fill: currentColor;
}

.btn-primary {
  background: var(--accent-primary);
  color: var(--text-on-accent);
  font-size: 1rem;
  font-weight: 700;
  cursor: pointer;
  transition: all var(--transition-fast);
  box-shadow: var(--shadow-md);
}

.btn-primary:hover {
  box-shadow: var(--shadow-lg);
  transform: translateY(-2px) scale(1.05);
}

.btn-secondary {
  padding: 1rem 2rem;
  background: transparent;
  border: 2px solid var(--border-200);
  border-radius: var(--radius-md);
  color: var(--text-100);
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--transition-fast);
}

.btn-secondary:hover {
  background: var(--background-500);
  border-color: var(--border-accent);
  transform: translateY(-2px);
}

.loading-bar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: var(--z-player);
  height: 1.5px;
  background: crimson;
  box-shadow: 0 0 8px rgba(255, 0, 0, 0.6);
  transform-origin: left;
  transform: scaleX(0);
  will-change: transform;
}

.loading-bar.active {
  transition: transform 0.3s ease-out;
}

.loading-bar.complete {
  animation: loading-complete 0.4s ease-out forwards;
  transform: scaleX(1);
}















#NAVBar {
  position: fixed;
  bottom: 1rem;
  left: 50%;
  z-index: var(--z-player);
  width: 92vw;
  max-width: 1000px;
  height: 45px !important;
  padding: 0 0.75rem;
  background-color: var(--background-400);
  border: 1px solid var(--border-200);
  border-radius: 10px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  backdrop-filter: var(--blur-navbar);
  box-shadow: var(--shadow-navbar);
  display: flex;
  justify-content: center;
  transform: translateX(-50%);
  transition: all var(--transition-smooth);
  color: var(--text-200);
  will-change: transform, opacity, border-color;
}

.navbar-content {
  display: grid;
  grid-template-columns: auto 1fr auto;
  align-items: center;
  gap: 1.5rem;
  width: 100%;
}

.navbar-left {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.menu-trigger {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2.75rem;
  height: 2.75rem;
  background: var(--txt);
  border: 1px solid var(--border-200);
  border-radius: 12px;
  color: var(--text-200);
  cursor: pointer;
  overflow: hidden;
  transition: all var(--transition-fast);
}

.menu-trigger:before {
  content: "";
  position: absolute;
  inset: 0;
  background: var(--gradPrimary);
  border-radius: inherit;
  opacity: 0;
  transition: opacity var(--transition-fast);
}

.menu-trigger:hover {
  box-shadow: var(--shadow-md);
  transform: scale(1.05);
}

.menu-trigger:hover:before {
  opacity: 1;
}

.menu-trigger.active {
  color: var(--text-on-accent);
}

.navbar-center {
  display: flex;
  align-items: center;
  flex: 1;
  gap: 0.5rem;
  min-width: 0;
  padding: 0.75rem 0.5rem;
  background: transparent;
  border-radius: 14px;
  cursor: pointer;
  transition: all var(--transition-fast);
}

.now-playing-display {
  display: flex;
  align-items: center;
  flex: 1;
  gap: 1rem;
  min-width: 0;
}

#albumArtwork {
  width: 3rem;
  height: 3rem;
  border: 1px solid var(--border-100);
  border-radius: 10px;
  box-shadow: var(--shadow-sm);
  flex-shrink: 0;
  object-fit: cover;
  transition: all var(--transition-fast);
}

#albumArtwork:hover {
  box-shadow: var(--shadow-md);
  transform: scale(1.025);
}

#albumArtwork.image-loading {
  background: var(--background-500);
}

#albumArtwork.image-error {
  background: var(--background-700);
  border: 2px dashed var(--border-100);
}

#albumArtwork.image-error:after {
  content: "";
  position: absolute;
  inset: 0;
  z-index: 1;
  background: linear-gradient(90deg, transparent, rgba(255, 0, 0, 0.1) 25%, transparent 50%, rgba(0, 255, 0, 0.1) 75%, transparent);
  animation: glitch-sweep 3s ease-in-out infinite;
}

#albumArtwork:hover.image-loaded {
  transform: scale(1.05);
}

#navbar-logo {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2rem;
  height: 2rem;
  background: var(--border-200);
  border-radius: 12px;
  box-shadow: var(--shadow-sm);
  flex-shrink: 0;
  transition: all var(--transition-base);
}

#navbar-logo:hover {
  box-shadow: var(--shadow-md);
  transform: scale(1.025);
}

.now-playing-info {
  display: flex;
  flex-direction: column;
  flex: 1;
  min-width: 0;
  gap: 0.25rem;
}

#songName-NAVBar {
  margin: 0;
  color: var(--text-primary);
  font-size: 0.95rem;
  font-weight: 600;
  line-height: 1.2;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

#songName-NAVBar.marquee {
  display: inline-block;
  white-space: nowrap;
  overflow: hidden;
  animation: marquee-scroll 12s linear infinite;
}

#artistName-NAVBar {
  margin: 0;
  color: var(--text-200);
  font-size: 0.8rem;
  line-height: 1.2;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.play-indicator {
  width: 0.85rem;
  height: 0.85rem;
  margin-left: 0.25rem;
  background: var(--text-200);
  border-radius: 50%;
  flex-shrink: 0;
  opacity: 0;
  transition: opacity var(--transition-fast);
}

.play-indicator.active {
  opacity: 1;
  animation: pulse-glow 2s ease-in-out infinite;
}

.navbar-right {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.nav-controls {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.nav-control-btn {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2.85rem;
  height: 2.85rem;
  background: var(--background-canvas);
  border-radius: 25px;
  color: var(--text-200);
  cursor: pointer;
  font-size: 1.375rem;
  overflow: hidden;
  transition: all var(--transition-fast);
}

.nav-control-btn.active {
  border-color: var(--accent-primary);
  color: var(--text-on-accent);
}

.nav-control-btn.play-pause {
  width: 2.75rem;
  height: 2.75rem;
  border: none;
  color: var(--text-on-accent);
}

.nav-control-btn.play-pause:hover {
  box-shadow: var(--shadow-lg);
  transform: scale(1.08);
}





.breadcrumb-navigation {
  position: sticky;
  top: 0;
  z-index: var(--z-sticky);
  height: 40px;
  padding: 1.5rem;
  background-color: var(--breadCrumbsBG);
  backdrop-filter: var(--blur-md);
  border-bottom: 1.5px solid var(--borderColor-neutral-muted);
  color: var(--header-fgColor-logo);
  font-size: 1.15rem;
  font-weight: 800;
  letter-spacing: -0.35px;
  line-height: 0.55;
  text-shadow: 2px 2px 6px #252525;
  border-bottom: none;
}

.breadcrumb-list {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 0.25rem;
  margin: 0;
  padding: 0;
  list-style: none;
}

.breadcrumb-item,
.breadcrumb-separator {
  display: flex;
  align-items: center;
}

.breadcrumb-separator {
  color: var(--header-borderColor-divider);
}











        .popup-progress {
            /* CSS Variables for easy themeing */
            --progress-height: 8px;
            --thumb-size: 20px;
            --primary-color: #3B82F6; /* blue-500 */
            --secondary-color: #60A5FA; /* blue-400 */
            --track-color: #4B5563; /* gray-600 */
            --thumb-color: #EFF6FF; /* blue-50 */
            --text-color: #9CA3AF; /* gray-400 */
            --glow-effect: 0 0 8px rgba(96, 165, 250, 0.5);
            --transition-speed: 0.15s;
            margin: 1.5rem 0;
        }

        .progress-time {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            color: var(--text-color);
            font-size: 0.8rem;
            font-weight: 500;
        }

        .popup-progress-bar {
            position: relative;
            height: var(--progress-height);
            background-color: var(--track-color);
            border-radius: 100px;
            cursor: pointer;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .popup-progress-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: inherit;
            /* Prevent the fill from capturing mouse events meant for the track */
            pointer-events: none; 
        }

        .popup-progress-thumb {
            position: absolute;
            top: 50%;
            /* 'left' will be controlled by JavaScript */
            width: var(--thumb-size);
            height: var(--thumb-size);
            background-color: var(--thumb-color);
            border: 3px solid var(--primary-color);
            border-radius: 50%;
            /* This transform centers the thumb on the line */
            transform: translate(-50%, -50%);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4), var(--glow-effect);
            transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
            cursor: grab;
            opacity: 1; 
        }

        /* Interaction states */
        .popup-progress-bar:hover .popup-progress-thumb {
            transform: translate(-50%, -50%) scale(1.15);
        }

        .popup-progress-thumb.grabbing {
            cursor: grabbing;
            transform: translate(-50%, -50%) scale(1.25);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5), 0 0 12px rgba(96, 165, 250, 0.7);
        }











.breadcrumb {
  display: flex;
  align-items: center;
  padding: 0.25rem 0.5rem;
  text-decoration: none;
  transition: all 0.45s ease;
}

.breadcrumb:hover {
  color: var(--accent-primary);
  transition: all 0.45s ease;
}

.genre-tag {
  padding: 6px 12px;
  border: 1px solid var(--border-200);
  border-radius: 16px;
  font-weight: 500;
  transition: all var(--transition-fast);
}

.genre-tag:hover {
  background: var(--accent-primary);
  color: var(--text-on-accent);
  transform: scale(1.05);
}

.gradient-text {
  background: var(--gradRainbow);
  background-size: 300% 300%;
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  animation: gradient-flow 8s ease infinite;
}

.similar-artist {
  padding: 8px 16px;
  background: var(--background-500);
  border: 1px solid var(--border-200);
  border-radius: 20px;
  color: var(--text-100);
  font-size: 0.875rem;
  font-weight: 500;
  white-space: nowrap;
  cursor: pointer;
  transition: all var(--transition-fast);
  will-change: background-color, transform;
}

.similar-artist:hover {
  background: var(--accent-primary);
  color: var(--text-on-accent);
  box-shadow: var(--shadow-sm);
  transform: translateY(-2px);
}

.album-selector-container {
  margin-bottom: 2rem;
}

.album-selector-tabs {
  display: flex;
  gap: 0.85rem;
  padding: 1.5rem;
  border-radius: 0.75rem;
  overflow-x: auto;
  scrollbar-width: none;
}

.album-selector-tabs:hover .album-tab:not(.active) {
  opacity: 1;
  transition: all 0.45s ease-in-out;
}

.album-selector-tabs::-webkit-scrollbar {
  display: none;
}

.album-tab {
  flex: 0 0 auto;
  padding: 0.5rem 1rem;
  background: var(--background-600);
  border-radius: 0.5rem;
  color: var(--text-300);
  font-size: 0.875rem;
  font-weight: 500;
  white-space: nowrap;
  cursor: pointer;
  border: 1px dashed transparent;
  opacity: 0.25;
  transition: all var(--transition-smooth);
}

.album-tab.active {
  background: var(--accent-primary);
  color: var(--text-on-accent);
  box-shadow: var(--shadow-sm);
  opacity: 1;
  transition: var(--transition-smooth);
}

.album-tab:hover:not(.active) {
  background: var(--background-500);
  color: var(--text-100);
  transform: translateY(-1px);
  border: 1px dashed var(--border-accent);
  transition: all 0.45s ease-in-out;
}

.album-content {
  padding: 1rem;
  opacity: 1;
  transform: translateY(0);
  transition: all var(--transition-base);
}

.album-content.fade-out {
  opacity: 0;
  pointer-events: none;
  transform: translateY(20px);
}

.album-content.fade-in {
  opacity: 1;
  transform: translateY(0);
}

.artistTop {
  --artist-header-height: 280px;
  --avatar-size: 100px;
  --action-button-height: 30px;
  --tag-spacing: 8px;
  --content-max-width: 1200px;
  width: 95%; 
  margin-left: auto; 
  margin-right: auto;
  left: 0; 
  right: 0;
  overflow: hidden;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
  margin-top: 1rem;
  justify-content: center;
  border-top-right-radius: 15px;
  border-top-left-radius: 15px;
  border-bottom-left-radius: 5px;
  border-bottom-right-radius: 5px;
}

.artist-header {
  position: relative; 
  margin-top: 4rem;
  height: var(--artist-header-height);
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 0 32px 32px;
}

.content-wrapper {
  display: flex;
  align-items: center;
  flex-direction: row;
  gap: 16px;
  max-width: fit-content;
  margin: 0 auto;
}

.artist-avatar {
  width: var(--avatar-size);
  height: var(--avatar-size);
  flex-shrink: 0;
  border-radius: 50%;
  border: 4px solid var(--background-canvas);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  background: var(--background-600);
  overflow: hidden;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.artist-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.artist-avatar::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 60%);
  border-radius: 50%;
}

.artist-info {
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 8px;
  padding-bottom: 0;
  flex: unset;
}

.metadata-tags {
  display: flex;
  flex-direction: column;
  gap: var(--tag-spacing);
}

.metadata-tags span {
  background: var(--background-500);
  color: rgba(255,255,255,0.9);
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 500;
  letter-spacing: 0.5px;
  transition: all 0.2s ease;
}

.metadata-tags span:hover {
  background: var(--background-700);
  transform: translateY(-1px);
}

.action-buttons {
  display: flex;
  gap: 8px;
  margin-top: 4px;
}

.action-buttons button {
  height: var(--action-button-height);
  padding: 10px;
  border-radius: 8px;
  font-weight: 600;
  font-size: 0.95rem;
  letter-spacing: 0.5px;
  border: none;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  gap: 8px;
}

.action-buttons .play {
  background: linear-gradient(to right, #4a8eff, #6d5ff6);
  color: white;
  box-shadow: 0 4px 12px rgba(74, 142, 255, 0.3);
}

.action-buttons .play:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(74, 142, 255, 0.4);
}

.action-buttons .follow {
  background: var(--background-inset);
  color: rgba(255,255,255,0.9);
  border: 1px solid var(--background-700);
}

.action-buttons .follow:hover {
  background: var(--background-600);
  transform: translateY(-2px);
}

.image-loaded {
  opacity: 0;
  animation: fadeIn 0.6s ease forwards 0.3s;
}

.playing-indicator {
  animation: pulse-glow 2s ease-in-out infinite;
  will-change: opacity;
}

.spinner {
  animation: spin 1s linear infinite;
  will-change: transform;
}

.content-fade-in {
  opacity: 0;
  transform: translateY(20px);
  animation: content-enter 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  will-change: opacity, transform;
}

.image-loading {
  position: relative;
  background: linear-gradient(90deg, var(--background-500) 25%, var(--background-600) 50%, var(--background-500) 75%);
  background-size: 400% 100%;
  animation: image-shimmer 1.5s ease-in-out infinite;
  opacity: 0.7;
}

.image-loading:before {
  content: "";
  position: absolute;
  top: 50%;
  left: 50%;
  z-index: 2;
  width: 24px;
  height: 24px;
  margin: -12px 0 0 -12px;
  border: 2px solid var(--border-100);
  border-top-color: var(--accent-primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.image-loaded {
  opacity: 1;
  animation: image-fade-in 0.5s ease-out;
}

.image-loading-pulse {
  animation: loading-pulse 2s ease-in-out infinite;
}

.lazy-image {
  opacity: 0;
  transition: opacity 0.3s ease;
}

.lazy-image.loaded {
  opacity: 1;
}

.progressive-image {
  background-size: cover;
  background-position: 50%;
  background-repeat: no-repeat;
}

.progressive-image.blur-up {
  filter: blur(10px);
  transition: filter 0.5s ease;
}

.progressive-image.blur-up.loaded {
  filter: blur(0);
}

.showSongs {
  animation: showSongs 0.6s ease-out both;
}

.hideSongs {
  animation: hideSongs 0.5s ease-in both;
}

.page {
  opacity: 0;
  transform: translateY(10px);
  transition: opacity 0.45s ease, transform 0.45s ease;
  animation: pageEnter 0.4s cubic-bezier(0.21, 1.02, 0.73, 1) forwards;
}

.search-dialog-opening .search-dialog-content {
  animation: slideInDown 0.4s ease-out;
}

.search-dialog-closing .search-dialog-content {
  animation: slideOutUp 0.3s ease-in;
}

.search-dialog {
  animation: fade-in 0.2s ease;
}

.search-dialog-content {
  animation: scale-in 0.3s ease;
}

.fade-out-breadcrumb {
  animation: fadeOutBreadcrumb 0.4s ease forwards;
}

.fade-in-breadcrumb {
  animation: fadeInBreadcrumb 0.4s ease forwards;
}



.image-error {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--background-700);
  border: 2px dashed var(--border-100);
  opacity: 0.6;
}

.image-error:after {
  content: "🖼️";
  font-size: 2rem;
  opacity: 0.5;
}

.image-fallback {
  opacity: 0.8;
  filter: grayscale(20%);
}

.artist-avatar {
  transition: all var(--transition-base);
}

.artist-avatar, .artist-avatar.image-loading {
  border-radius: 50%;
}

.artist-avatar.image-error {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-purple));
  color: #fff;
  font-weight: 700;
  text-align: center;
  border-radius: inherit;
}

.artist-avatar.image-error:after {
  content: attr(alt);
  font-size: 0.75rem;
  margin-top: 0.5rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  max-width: 80%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.artist-avatar-large.image-loading:before {
  width: 32px;
  height: 32px;
  margin: -16px 0 0 -16px;
  border-width: 3px;
}

.queue-item-cover {
  transition: all var(--transition-fast);
}

.queue-item-cover.image-loading {
  border-radius: 0.25rem;
}

.queue-item-cover.image-error {
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--background-700);
  color: var(--text-300);
  font-size: 0.75rem;
  border-radius: 0.25rem;
}

.queue-item-cover.image-error:after {
  content: "♪";
}

#albumArtwork {
  transition: all var(--transition-base);
}

#albumArtwork.image-loading {
  border-radius: 0.5rem;
}

#albumArtwork.image-error {
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary));
  color: #fff;
  font-size: 0.75rem;
  border-radius: 0.5rem;
}

#albumArtwork.image-error:after {
  content: "🎵";
}

#now-playing-cover {
  box-shadow: var(--shadow-lg);
  transition: all var(--transition-slow);
}

#now-playing-cover.image-loading {
  border-radius: 1rem;
}

#now-playing-cover.image-error {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-purple), var(--accent-pink));
  color: #fff;
  border-radius: 1rem;
}

#now-playing-cover.image-error:after {
  content: "🎼";
  font-size: 4rem;
  margin-bottom: 1rem;
}

.artist-card:hover .artist-avatar.image-loaded {
  box-shadow: var(--shadow-lg);
  filter: brightness(1.1) saturate(1.2);
}

.album-card:hover .album-cover.image-loaded {
  box-shadow: var(--shadow-xl);
  filter: brightness(1.1) contrast(1.1);
  transform: scale(1.05) rotateY(5deg);
}

.queue-item:hover .queue-item-cover.image-loaded {
  border-radius: 0.5rem;
  box-shadow: var(--shadow-sm);
  transform: scale(1.1);
}

#albumArtwork:hover.image-loaded {
  box-shadow: var(--shadow-md);
  transform: scale(1.15) rotate(-2deg);
}

.image-error-glitch {
  position: relative;
  overflow: hidden;
}

.image-error-glitch:before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 1;
  background: linear-gradient(90deg, transparent, rgba(255, 0, 0, 0.1) 25%, transparent 50%, rgba(0, 255, 0, 0.1) 75%, transparent);
  animation: glitch-sweep 3s ease-in-out infinite;
}

.artist-context .image-error:after {
  content: "Artist\A Image\A Missing";
  white-space: pre;
  text-align: center;
  font-size: 0.7rem;
  line-height: 1.2;
}

.album-context .image-error:after {
  content: "Album\A Cover\A Missing";
  white-space: pre;
  text-align: center;
  font-size: 0.7rem;
  line-height: 1.s slideInDown {
  from {
    opacity: 0;
    -webkit-transform: translateY(-30px);
  }
  to {
    opacity: 1;
    -webkit-transform: translateY(0);
  }
}

@keyframes slideOutUp {
  from {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    transform: translateY(-30px);
  }
}

@-webkit-keyframes slideOutUp {
  from {
    opacity: 1;
    -webkit-transform: translateY(0);
  }
  to {
    opacity: 0;
    -webkit-transform: translateY(-30px);
  }
}

@keyframes fadeOutBreadcrumb {
  0% {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    transform: translateY(-6px);
  }
}

@-webkit-keyframes fadeOutBreadcrumb {
  0% {
    opacity: 1;
    -webkit-transform: translateY(0);
  }
  to {
    opacity: 0;
    -webkit-transform: translateY(-6px);
  }
}

@keyframes fadeInBreadcrumb {
  0% {
    opacity: 0;
    transform: translateY(6px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@-webkit-keyframes fadeInBreadcrumb {
  0% {
    opacity: 0;
    -webkit-transform: translateY(6px);
  }
  to {
    opacity: 1;
    -webkit-transform: translateY(0);
  }
}


@keyframes showSongs {
  0% {
    opacity: 0;
    filter: blur(40px);
  }
  60% {
    filter: blur(0px);
    opacity: 0.6;
  }
  100% {
    filter: blur(0px);
    opacity: 1;
  }
}

@-webkit-keyframes showSongs {
  0% {
    opacity: 0;
    -webkit-filter: blur(40px);
  }
  60% {
    -webkit-filter: blur(0px);
    opacity: 0.6;
  }
  100% {
    -webkit-filter: blur(0px);
    opacity: 1;
  }
}

@keyframes hideSongs {
  0% {
    opacity: 1;
    filter: blur(0px);
  }
  100% {
    opacity: 0;
    filter: blur(40px);
  }
}

@-webkit-keyframes hideSongs {
  0% {
    opacity: 1;
    -webkit-filter: blur(0px);
  }
  100% {
    opacity: 0;
    -webkit-filter: blur(40px);
  }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@-webkit-keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes pulse {
  0% { box-shadow: var(--glow-effect); }
  50% { box-shadow: 0 0 12px rgba(83, 155, 245, 0.6); }
  100% { box-shadow: var(--glow-effect); }
}

@-webkit-keyframes pulse {
  0% { box-shadow: var(--glow-effect); }
  50% { box-shadow: 0 0 12px rgba(83, 155, 245, 0.6); }
  100% { box-shadow: var(--glow-effect); }
}s slideInDown {
  from {
    opacity: 0;
    -webkit-transform: translateY(-30px);
  }
  to {
    opacity: 1;
    -webkit-transform: translateY(0);
  }
}

@keyframes slideOutUp {
  from {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    transform: translateY(-30px);
  }
}

@-webkit-keyframes slideOutUp {
  from {
    opacity: 1;
    -webkit-transform: translateY(0);
  }
  to {
    opacity: 0;
    -webkit-transform: translateY(-30px);
  }
}

@keyframes fadeOutBreadcrumb {
  0% {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    transform: translateY(-6px);
  }
}

@-webkit-keyframes fadeOutBreadcrumb {
  0% {
    opacity: 1;
    -webkit-transform: translateY(0);
  }
  to {
    opacity: 0;
    -webkit-transform: translateY(-6px);
  }
}

@keyframes fadeInBreadcrumb {
  0% {
    opacity: 0;
    transform: translateY(6px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@-webkit-keyframes fadeInBreadcrumb {
  0% {
    opacity: 0;
    -webkit-transform: translateY(6px);
  }
  to {
    opacity: 1;
    -webkit-transform: translateY(0);
  }
}

@keyframes dropdown-slide-in {
  0% {
    opacity: 0;
    transform: translateX(-50%) translateY(20px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0) scale(1);
  }
}

@-webkit-keyframes dropdown-slide-in {
  0% {
    opacity: 0;
    -webkit-transform: translateX(-50%) translateY(20px) scale(0.95);
  }
  to {
    opacity: 1;
    -webkit-transform: translateX(-50%) translateY(0) scale(1);
  }
}

@keyframes showSongs {
  0% {
    opacity: 0;
    filter: blur(40px);
  }
  60% {
    filter: blur(0px);
    opacity: 0.6;
  }
  100% {
    filter: blur(0px);
    opacity: 1;
  }
}

@-webkit-keyframes showSongs {
  0% {
    opacity: 0;
    -webkit-filter: blur(40px);
  }
  60% {
    -webkit-filter: blur(0px);
    opacity: 0.6;
  }
  100% {
    -webkit-filter: blur(0px);
    opacity: 1;
  }
}

@keyframes hideSongs {
  0% {
    opacity: 1;
    filter: blur(0px);
  }
  100% {
    opacity: 0;
    filter: blur(40px);
  }
}

@-webkit-keyframes hideSongs {
  0% {
    opacity: 1;
    -webkit-filter: blur(0px);
  }
  100% {
    opacity: 0;
    -webkit-filter: blur(40px);
  }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@-webkit-keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes pulse {
  0% { box-shadow: var(--glow-effect); }
  50% { box-shadow: 0 0 12px rgba(83, 155, 245, 0.6); }
  100% { box-shadow: var(--glow-effect); }
}

@-webkit-keyframes pulse {
  0% { box-shadow: var(--glow-effect); }
  50% { box-shadow: 0 0 12px rgba(83, 155, 245, 0.6); }
  100% { box-shadow: var(--glow-effect); }
} 1.35rem;
  transition: all 0.3s ease;
}

.breadcrumb-separator {
  color: var(--text-300);
  opacity: 0.35;
  margin: 0 0.25rem;
}

.breadcrumb-item {
  color: var(--text-300);
  opacity: 0.35;
  position: relative;
}

.breadcrumb-item:hover {
  opacity: 1;
  transform: translateY(-1px);
}

.breadcrumb-item[aria-current="page"] {
  opacity: 1;
  color: var(--text-100);
  font-weight: 400;
}

.breadcrumb-item[aria-current="page"]::after {
  content: '';
  position: absolute;
  bottom: -8px;
  left: 0;
  width: 100%;
  height: 2px;
  background: var(--text-100);
  border-radius: 2px;
}

.breadcrumb-navigation:hover .breadcrumb-separator,
.breadcrumb-navigation:hover .breadcrumb-item:not([aria-current="page"]) {
  opacity: 1;
}

.artistBottom {
  width: 100%;
  height: auto;
  padding: 2rem 0;
}

.artistBottom h3 {
  padding: 3px 8px;
  border-radius: 5px;
  color: whitesmoke;
  opacity: 0.35;
  backdrop-filter: blur(20px);
  transform: translate(-15px, -50px);
  transition: opacity 0.65s ease-in-out;
}

.artistBottom:hover h3 {
  opacity: 1;
}

.artistBottom > p {
  padding: 3px 8px;
  border-radius: 5px;
  color: whitesmoke;
  opacity: 0.35;
  backdrop-filter: blur(20px);
  transform: translate(-15px, -50px);
  transition: opacity 0.65s ease-in-out 1s;
}

.artistBottom:hover p {
  opacity: 1;
}

#dropdown-menu {
  position: fixed;
  bottom: 6.5rem;
  left: 50%;
  z-index: 999999 !important;
  width: 92vw;
  max-width: 500px;
  max-height: 70vh;
  padding: 1.5rem;
  background: var(--background-600);
  border: 1px solid var(--text-300);
  border-radius: 15px;
  box-shadow: var(--shadow-md);
  backdrop-filter: var(--blur-lg);
  opacity: 0;
  visibility: hidden;
  overflow-y: auto;
  transform: translateX(-50%) translateY(20px) scale(0.95);
  transition: all var(--transition-smooth);
}

#dropdown-menu.show {
  opacity: 1;
  visibility: visible;
  transform: translateX(-50%) translateY(0) scale(1);
}

.dropdown-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--border-100);
}

.dropdown-title {
  margin: 0;
  color: var(--text-100);
  font-size: 1.25rem;
  font-weight: 700;
}

.dropdown-close {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2rem;
  height: 2rem;
  background: transparent;
  border: none;
  border-radius: 50%;
  color: var(--text-300);
  cursor: pointer;
  transition: all var(--transition-fast);
}

.dropdown-close:hover {
  background: var(--background-500);
  color: var(--text-100);
}

.dropdown-section {
  margin-bottom: 2rem;
}

.dropdown-section:last-child {
  margin-bottom: 0;
}

.section-title {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin: 0 0 1rem;
  color: var(--accent-primary);
  font-size: 1rem;
  font-weight: 600;
}

.dropdown-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 0.5rem;
  padding: 1rem;
  border: 1px solid transparent;
  border-radius: 12px;
  cursor: pointer;
  transition: all var(--transition-fast);
}

.dropdown-item:hover {
  background: var(--background-overlay);
  border-color: var(--border-accent);
  transform: translateX(4px);
}

.dropdown-item:last-child {
  margin-bottom: 0;
}

.dropdown-item-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2.25rem;
  height: 2.25rem;
  background: var(--background-600);
  border-radius: 8px;
  color: var(--text-300);
  flex-shrink: 0;
  transition: all var(--transition-fast);
}

.dropdown-item:hover .dropdown-item-icon {
  background: var(--accent-primary);
  color: var(--text-on-accent);
}

.dropdown-item-content {
  flex: 1;
  min-width: 0;
}

.dropdown-item-title {
  margin: 0 0 0.25rem;
  color: var(--text-100);
  font-size: 0.95rem;
  font-weight: 600;
  line-height: 1.2;
}

.dropdown-item-subtitle {
  margin: 0;
  color: var(--text-300);
  font-size: 0.8rem;
  line-height: 1.2;
}

.dropdown-item-badge {
  min-width: 1.5rem;
  padding: 0.25rem 0.5rem;
  background: var(--accent-primary);
  border-radius: 12px;
  color: var(--text-on-accent);
  font-size: 0.75rem;
  font-weight: 600;
  text-align: center;
  flex-shrink: 0;
}

.empty-state {
  padding: 2rem 1rem;
  color: var(--text-300);
  text-align: center;
}

.empty-state-icon {
  width: 3rem;
  height: 3rem;
  margin: 0 auto 1rem;
  opacity: 0.5;
}

.empty-state-text {
  font-size: 0.9rem;
  line-height: 1.4;
}

.search-dialog {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: var(--z-search);
  padding-top: 10vh;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(8px);
  display: flex;
  align-items: flex-start;
  justify-content: center;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.search-dialog:not(.hidden) {
  opacity: 1;
}

.search-dialog-content {
  width: 100%;
  max-width: 600px;
  margin: 0 1rem;
  background: var(--background-600);
  border: 1px solid var(--border-200);
}

.search-tab {
  position: relative;
  cursor: pointer;
  font-size: 0.875rem;
  font-weight: 500;
  transition: color 0.3s ease;
}

.search-tab.active,
.search-tab:hover {
  color: var(--accent-primary);
}

.search-tab.active {
  font-weight: 600;
}

.search-tab-content {
  transition: opacity 0.3s ease;
}

.genre-filters {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.genre-tag {
  padding: 0.5rem 0.75rem;
  background: var(--background-500);
  border: 1px solid var(--border-100);
  border-radius: 9999px;
  color: var(--text-300);
  font-size: 0.75rem;
  cursor: pointer;
  transition: all 0.2s ease;
}

.genre-tag:hover {
  background: var(--background-600);
  color: var(--text-100);
}

.genre-tag.active {
  background: var(--accent-primary);
  border-color: var(--accent-primary);
  color: var(--text-on-accent);
}

.empty-results {
  padding: 4rem 1rem;
  color: var(--text-300);
  text-align: center;
}

.popup-song-list {
  max-height: 300px;
  margin: 0;
  padding: 0;
  list-style: none;
  overflow-y: auto;
  scrollbar-width: none;
  -ms-overflow-style: none;
}

.popup-song-list::-webkit-scrollbar {
  display: none;
}

.popup-song-item {
  margin-bottom: 1rem;
  border-radius: 10px;
  height: 30px;
  background: var(--background-overlay);
  display: flex;
  padding: 8px 10px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.12);
  cursor: pointer;
  transition: background-color 0.35s ease;
}

.popup-song-item:hover {
  background-color: rgba(255, 255, 255, 0.08);
}

.popup-song-item:active {
  background-color: rgba(255, 255, 255, 0.12);
}

.popup-song-item.playing {
  background-color: rgba(83, 155, 245, 0.1);
}

.popup-song-cover {
  width: 25px;
  height: 25px;
  margin-right: 12px;
  background-color: var(--background-600);
  border-radius: 6px;
  flex-shrink: 0;
  object-fit: cover;
  box-shadow: 0 0 4px rgba(0,0,0,0.5);
}

.popup-song-info {
  flex: 1;
  min-width: 0;
  margin-right: 12px;
}

.popup-song-title {
  margin: 0 0 2px;
  color: var(--text-100);
  font-size: 14px;
  font-weight: 500;
  line-height: 1.3;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.popup-song-item.playing .popup-song-title {
  color: var(--accent-primary);
}

.popup-song-artist {
  margin: 0;
  color: var(--text-300);
  font-size: 12px;
  font-weight: 400;
  line-height: 1.3;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.popup-song-duration {
  min-width: 40px;
  color: var(--text-300);
  font-size: 12px;
  text-align: right;
  flex-shrink: 0;
}

.popup-song-item.playing .popup-song-duration {
  color: var(--accent-primary);
}

.popup-song-play {
  background: none;
  border: none;
  padding: 0.3rem;
  color: var(--text-300);
  border-radius: 50%;
  cursor: pointer;
  flex-shrink: 0;
  opacity: 0;
  transition: opacity 0.2s ease, background 0.2s ease, color 0.2s ease;
}

.popup-song-play:hover,
.popup-song-play:focus {
  color: var(--accent-primary);
  background: rgba(83, 155, 245, 0.1);
}

.popup-song-item:hover .popup-song-play {
  opacity: 1;
  transition: opacity 0.45s ease-in-out;
}

.popup-song-item:hover .popup-song-duration {
  opacity: 0;
  transition: opacity 0.15s ease-in-out;
}

.popup-song-play svg {
  width: 20px;
  height: 20px;
}

.similar-artists-carousel {
  --gradient-width: 100px;
  --carousel-gap: 16px;
  --item-width: 120px;
  --border-radius: 15px;
  --arrow-size: 40px;
  --arrow-offset: 8px;
  --popover-width: 240px;
  
  position: relative;
  width: 100%;
  margin: 25px 0;
}

.similar-artists-container {
  display: flex;
  gap: var(--carousel-gap);
  margin-bottom: 10rem;
  overflow: hidden;
  overflow-x: auto;
  scroll-behavior: smooth;
  scrollbar-width: none;
  -ms-overflow-style: none;
}

.similar-artists-container::-webkit-scrollbar {
  display: none;
}

.similar-artists-carousel::before,
.similar-artists-carousel::after {
  content: "";
  position: absolute;
  top: 0;
  bottom: 0;
  width: var(--gradient-width);
  z-index: var(--z-base);
  pointer-events: none;
}

.similar-artists-carousel::before {
  left: 0;
  background: linear-gradient(90deg, var(--background-200), transparent);
}

.similar-artists-carousel::after {
  right: 0;
  background: linear-gradient(270deg, var(--background-200), transparent);
}

.carousel-arrow {
  position: absolute;
  top: 50%;
  width: var(--arrow-size);
  height: var(--arrow-size);
  border-radius: 50%;
  background: var(--background-700);
  border: 1px solid var(--border-200);
  color: var(--text-100);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 15;
  backdrop-filter: var(--blur-sm);
  box-shadow: var(--shadow-md);
  opacity: 0;
  pointer-events: none;
  transform: translateY(-50%);
  transition: all 0.3s ease-out;
}

.carousel-arrow.left {
  left: var(--arrow-offset);
}

.carousel-arrow.right {
  right: var(--arrow-offset);
}

.carousel-arrow:hover:not(.disabled) {
  background: var(--accent-primary);
  color: var(--text-on-accent);
  box-shadow: var(--shadow-lg);
}

.carousel-arrow.disabled {
  opacity: 0.3;
  background: var(--background-600);
  cursor: not-allowed;
}

.similar-artists-carousel:hover .carousel-arrow {
  opacity: 0.85;
  pointer-events: auto;
}

.similar-artists-carousel:hover .carousel-arrow:hover {
  opacity: 1;
}

.similar-artist-card {
  --scale-factor: 1.02;
  --lift-distance: -4px;
  
  position: relative;
  z-index: 2;
  width: var(--item-width);
  text-align: center;
  cursor: pointer;
  flex: 0 0 auto;
  transition: transform var(--transition-base);
}

.similar-artist-card:hover {
  transform: translateY(var(--lift-distance)) scale(var(--scale-factor));
  z-index: 15;
}

.similar-artist-image img {
  width: 100%;
  aspect-ratio: 1;
  margin: 0 auto 8px;
  object-fit: cover;
  border-radius: 25%;
  box-shadow: var(--shadow-sm);
  transition: all var(--transition-base);
}

.similar-artist-card:hover .similar-artist-image img {
  box-shadow: var(--shadow-lg);
  transform: scale(1.05);
}

.similar-artist-name {
  margin-bottom: 4px;
  color: var(--text-100);
  font-size: 0.75rem;
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.artist-popover {
  position: absolute;
  left: 50%;
  min-width: 240px;
  padding: 0;
  background: var(--background-overlay-solid);
  border: 1px solid var(--border-100);
  border-radius: 10px;
  box-shadow: var(--shadow-md);
  backdrop-filter: var(--blur-lg);
  opacity: 0;
  pointer-events: none;
  overflow: hidden;
  transform: translateX(-50%) translateY(-8px);
  transition: all var(--transition-bounce);
  will-change: transform, opacity;
}

.artist-popover:after {
  content: "";
  position: absolute;
  top: 100%;
  left: 50%;
  border: 6px solid transparent;
  border-top: 6px solid var(--border-accent);
  transform: translateX(-50%);
  filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.2));
}

.artist-popover.visible {
  opacity: 1;
  pointer-events: all;
  transform: translateX(-50%) translateY(-12px);
}

.similar-artist-card:first-child .artist-popover,
.similar-artist-card:nth-child(2) .artist-popover {
  left: 0;
  transform: translateX(0) translateY(-8px);
}

.similar-artist-card:first-child .artist-popover.visible,
.similar-artist-card:nth-child(2) .artist-popover.visible {
  transform: translateX(0) translateY(-12px);
}

.similar-artist-card:last-child .artist-popover,
.similar-artist-card:nth-last-child(2) .artist-popover {
  left: auto;
  right: 0;
  transform: translateX(0) translateY(-8px);
}

.similar-artist-card:last-child .artist-popover.visible,
.similar-artist-card:nth-last-child(2) .artist-popover.visible {
  transform: translateX(0) translateY(-12px);
}

.similar-artist-card:first-child .artist-popover:after,
.similar-artist-card:nth-child(2) .artist-popover:after {
  left: 40px;
  transform: translateX(0);
}

.similar-artist-card:last-child .artist-popover:after,
.similar-artist-card:nth-last-child(2) .artist-popover:after {
  left: auto;
  right: 40px;
  transform: translateX(0);
}

.popover-header {
  position: relative;
  background: linear-gradient(180deg, var(--artistTopBg), transparent);
  border-bottom: 1px solid var(--border-100);
}

.popover-artist-name {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
  color: var(--text-100);
  font-size: 1rem;
  font-weight: 600;
}

.popover-stats {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  padding: 12px 16px;
}

.stat-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 8px;
  border-radius: 8px;
  transition: all var(--transition-fast);
}

.stat-item:hover {
  background: var(--background-600);
  transform: translateY(-2px);
}

.stat-value {
  margin-bottom: 2px;
  color: var(--accent-primary);
  font-size: 1.1rem;
  font-weight: 700;
}

.stat-label {
  color: var(--text-300);
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.popover-footer {
  padding: 12px 16px 16px;
}

.popover-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  gap: 6px;
  padding: 8px;
  background: var(--accent-primary);
  border: 1px solid var(--border-200);
  border-radius: 8px;
  color: var(--text-on-accent);
  font-size: 0.8rem;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--transition-bounce);
}

.popover-button:hover {
  background: var(--gradPrimary);
  box-shadow: var(--shadow-md);
  transform: translateY(-2px) scale(1.02);
}

.popover-button:active {
  transform: translateY(0) scale(0.98);
}

.popover-button:after {
  content: "→";
  opacity: 0;
  transition: all var(--transition-fast);
}

.popover-button:hover:after {
  opacity: 1;
  transform: translateX(4px);
}

.popover-portal {
  position: fixed;
  top: 0;
  left: 0;
  z-index: var(--z-overlay);
  width: 150px;
  height: 200px;
  pointer-events: none;
}

.popover-portal .artist-popover {
  position: absolute;
  pointer-events: all;
}

.glass-effect {
  background-color: rgba(30, 38, 47, 0.75);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.content-offset {
  min-height: 100vh;
  padding: 0;
}

.artist-body {
  margin-top: 3rem;
}

.albums-section .section-title {
  margin-bottom: 2rem;
}

.albums-container {
  padding: 2rem;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md);
}

.error-state {
  padding: 4rem 2rem;
  background: var(--background-500);
  border: 1px solid var(--border-200);
  border-radius: var(--radius-lg);
  color: var(--text-300);
  font-size: 1.2rem;
  text-align: center;
}

.single-album-display {
  max-width: 800px;
  margin: 0 auto;
}

.single-album-display .album-card {
  overflow: hidden;
  border-radius: 16px;
}

.single-album-display .album-info {
  padding: 24px;
}

.single-album-display .album-cover-container {
  position: relative;
  padding-top: 60%;
}

.single-album-display .album-cover {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.artists-grid.grid-view {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 1.5rem;
}

.artists-grid.list-view {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.artists-grid.list-view .artist-card {
  display: flex;
  align-items: center;
  padding: 0.75rem;
}

.artists-grid.list-view .artist-card .text-center {
  display: flex;
  align-items: center;
  width: 100%;
  text-align: left;
}

.artists-grid.list-view .artist-avatar {
  width: 3rem;
  height: 3rem;
  margin: 0 1rem 0 0;
}

.artists-grid.list-view .genre-tag {
  margin-left: auto;
}

#content-loading {
  position: fixed;
  left: 50%;
  bottom: 0;
  height: 100vh;
  width: 100vw;
  transform: translateX(-50%);
  justify-content: center;
  align-items: center;
  transition: opacity 0.45s ease-in-out;
  pointer-events: none;
}

#content-loading.hidden {
  transition: opacity 0.45s ease-in-out;
  pointer-events: none;
}

.loading-animation {
  text-align: center;
}

.spinner-container {
  position: relative;
  width: 60px;
  height: 60px;
  margin: 0 auto;
}

.spinner {
  width: 40px;
  height: 40px;
  margin: 0 auto;
  border: 3px solid rgba(83, 155, 245, 0.3);
  border-top: 3px solid var(--accent-primary);
  border-radius: 50%;
  animation: spinner 1s ease-in-out infinite;
}

.content-loading {
  position: absolute;
  inset: 0;
  z-index: 9999;
  background-color: rgba(13, 17, 23, 0.75);
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.3s ease;
  will-change: opacity;
}

.content-loading.opacity-100 {
  opacity: 1;
  pointer-events: all;
}

#dynamic-content {
  transition: opacity 0.3s ease, transform 0.3s ease;
}

#dynamic-content.fade-out {
  opacity: 0;
  transform: translateY(10px);
}

#dynamic-content.fade-in {
  animation: fade-in 0.3s ease forwards;
}

#theme-toggle:focus,
.dropdown-item:focus,
.menu-trigger:focus,
.nav-control-btn:focus,
.navbar-center:focus {
  outline: 2px solid var(--accent-primary);
  outline-offset: 2px;
}

@media (min-width: 768px) {
  .artist-card:hover {
    transform: translateY(-12px) scale(1.03);
  }
}

@media (min-width: 1024px) {
  html {
    font-size: 14px !important;
  }
  
  .musicPlayer {
    max-width: 500px;
  }
}

@media (max-width: 1024px) {
  .artists-grid {
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
  }
  
  .artist-info {
    gap: 0.5rem;
  }
  
  .artist-avatar-large .artist-avatar {
    width: 160px;
    height: 160px;
  }
  
  .artist-details .artist-name {
    font-size: 2.5rem;
  }
}

@media (max-width: 768px) {
  .view {
    padding: 1rem;
  }
  
  .hero-title {
    font-size: 2.5rem;
  }
  
  .hero-subtitle {
    font-size: 1rem;
  }
  
  .artists-grid {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }
  
  .artist-card {
    padding: 1.5rem;
  }
  
  .artist-avatar {
    width: 100px;
    height: 100px;
  }
  
  .artist-info {
    flex-direction: column;
    text-align: center;
    gap: 0.5rem;
  }
  
  .artist-avatar-large .artist-avatar {
    width: 140px;
    height: 140px;
  }
  
  .artist-details .artist-name {
    font-size: 2rem;
  }
  
  .artist-actions {
    justify-content: center;
    width: 100%;
  }
  
  .btn-primary,
  .btn-secondary {
    padding: 0.75rem 1.5rem;
    font-size: 0.9rem;
  }
  
  .albums-container {
    padding: 1rem;
  }
  
  #navbar.floating {
    top: 1rem;
    width: 95vw;
  }
  
  .control-button.play-pause,
  .floating-add-button {
    width: 56px;
    height: 56px;
  }
  
  .floating-add-button {
    bottom: 24px;
    right: 24px;
  }
  
  .similar-artists-container {
    padding: 2rem 0;
  }
  
  .carousel-arrow {
    width: 30px;
    height: 30px;
  }
  
  .carousel-arrow.left {
    left: 4px;
  }
  
  .carousel-arrow.right {
    right: 4px;
  }
  
  .similar-artist-card {
    width: 100px;
  }
  
  .similar-artist-image {
    width: 64px;
    height: 64px;
  }
  
  .artist-popover {
    min-width: 180px;
    padding: 12px;
  }
  
  .album-selector-tabs {
    gap: 1rem;
  }
  
  .album-tab {
    padding: 6px 12px;
    font-size: 0.8rem;
  }
  
  .album-cover.image-loading:before,
  .artist-avatar.image-loading:before {
    width: 20px;
    height: 20px;
    margin: -10px 0 0 -10px;
    border-width: 2px;
  }
  
  .image-error:after {
    font-size: 1.5rem;
  }
  
  .artist-card:hover .artist-avatar.image-loaded {
    transform: scale(1.05);
  }
  
  .musicPlayer {
    padding: 1rem;
  }
  
  .playerControls {
    gap: 0.75rem;
  }
  
  .playerControls > .button {
    width: 3.25rem;
    height: 3.25rem;
  }
  
  .playerControls > .button .play-pause {
    width: 5rem;
    height: 5rem;
  }
  
  .popup-tab-content {
    max-height: 200px;
  }
  
  .dropdown-menu,
  .musicPlayer {
    width: 95vw;
    padding: 0.25rem 1rem 0 1rem;
  }
  
  .dropdown-item {
    padding: 0.75rem;
  }
  
  #songName-NAVBar {
    font-size: 0.85rem;
  }
  
  #artistName-NAVBar {
    font-size: 0.75rem;
  }
  
  .popup-song-item {
    padding: 8px 12px;
    min-height: 52px;
  }
  
  .popup-song-cover {
    width: 36px;
    height: 36px;
    margin-right: 12px;
  }
  
  .popup-song-info {
    margin-right: 12px;
  }
  
  .popup-song-title {
    font-size: 13px;
  }
  
  .popup-song-artist {
    font-size: 11px;
  }
  
  .popup-song-duration {
    font-size: 11px;
    min-width: 28px;
  }
}

@media (max-width: 640px) {
  html {
    font-size: 12px !important;
  }
  
  .breadcrumb-navigation {
    padding: 1.5rem;
  }
  
  .artists-grid.grid-view {
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 1rem;
  }
  
  .genre-tag {
    padding: 0.35rem 0.6rem;
    font-size: 0.7rem;
  }
  
  .now-playing-info {
    max-width: calc(100% - 60px);
  }
  
  #albumArtwork,
  #navbar-logo {
    width: 32px;
    height: 32px;
  }
}

@media (max-width: 480px) {
  .hero-section {
    padding: 2rem 0;
  }
  
  .hero-title {
    font-size: 2rem;
  }
  
  .artists-grid {
    grid-template-columns: 1fr;
  }
  
  .artist-details .artist-name {
    font-size: 1.75rem;
  }
  
  .artist-actions {
    flex-direction: column;
  }
  
  .btn-primary,
  .btn-secondary {
    width: 100%;
    justify-content: center;
  }
  
  .navbar-content {
    grid-template-columns: auto 1fr;
    gap: 0.75rem;
  }
  
  .navbar-right .nav-controls {
    display: none;
  }
  
  .navbar-center {
    padding: 0.5rem;
  }
}

@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
  
  .gradient-text {
    animation: none;
    background: var(--accent-primary);
    -webkit-background-clip: text;
    background-clip: text;
  }
}

@keyframes marquee-scroll {
  0% {
    transform: translateX(100%);
  }
  to {
    transform: translateX(-100%);
  }
}

@-webkit-keyframes marquee-scroll {
  0% {
    -webkit-transform: translateX(100%);
  }
  to {
    -webkit-transform: translateX(-100%);
  }
}

@keyframes gradient-flow {
  0%,
  to {
    background-position: 0 50%;
  }
  25% {
    background-position: 100% 50%;
  }
  50% {
    background-position: 100% 100%;
  }
  75% {
    background-position: 0 100%;
  }
}

@-webkit-keyframes gradient-flow {
  0%,
  to {
    background-position: 0 50%;
  }
  25% {
    background-position: 100% 50%;
  }
  50% {
    background-position: 100% 100%;
  }
  75% {
    background-position: 0 100%;
  }
}

@keyframes loading-progress {
  0% {
    transform: scaleX(0);
  }
  50% {
    transform: scaleX(0.8);
  }
  to {
    transform: scaleX(0) translateX(100%);
  }
}

@-webkit-keyframes loading-progress {
  0% {
    -webkit-transform: scaleX(0);
  }
  50% {
    -webkit-transform: scaleX(0.8);
  }
  to {
    -webkit-transform: scaleX(0) translateX(100%);
  }
}

@keyframes loading-complete {
  0% {
    transform: scaleX(1);
    opacity: 1;
  }
  to {
    transform: scaleX(1);
    opacity: 0;
  }
}

@-webkit-keyframes loading-complete {
  0% {
    -webkit-transform: scaleX(1);
    opacity: 1;
  }
  to {
    -webkit-transform: scaleX(1);
    opacity: 0;
  }
}

@keyframes content-enter {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@-webkit-keyframes content-enter {
  to {
    opacity: 1;
    -webkit-transform: translateY(0);
  }
}

@keyframes pulse-glow {
  0%,
  to {
    opacity: 1;
  }
  50% {
    opacity: 0.6;
  }
}

@-webkit-keyframes pulse-glow {
  0%,
  to {
    opacity: 1;
  }
  50% {
    opacity: 0.6;
  }
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(1turn);
  }
}

@-webkit-keyframes spin {
  0% {
    -webkit-transform: rotate(0deg);
  }
  to {
    -webkit-transform: rotate(1turn);
  }
}

@keyframes image-shimmer {
  0% {
    background-position: 100% 50%;
  }
  to {
    background-position: 0 50%;
  }
}

@-webkit-keyframes image-shimmer {
  0% {
    background-position: 100% 50%;
  }
  to {
    background-position: 0 50%;
  }
}

@keyframes image-fade-in {
  0% {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@-webkit-keyframes image-fade-in {
  0% {
    opacity: 0;
    -webkit-transform: scale(0.95);
  }
  to {
    opacity: 1;
    -webkit-transform: scale(1);
  }
}

@keyframes loading-pulse {
  0%,
  to {
    opacity: 0.6;
    transform: scale(1);
  }
  50% {
    opacity: 0.8;
    transform: scale(1.02);
  }
}

@-webkit-keyframes loading-pulse {
  0%,
  to {
    opacity: 0.6;
    -webkit-transform: scale(1);
  }
  50% {
    opacity: 0.8;
    -webkit-transform: scale(1.02);
  }
}

@keyframes glitch-sweep {
  0%,
  to {
    transform: translateX(-100%);
  }
  50% {
    transform: translateX(100%);
  }
}

@-webkit-keyframes glitch-sweep {
  0%,
  to {
    -webkit-transform: translateX(-100%);
  }
  50% {
    -webkit-transform: translateX(100%);
  }
}

@keyframes navbar-float-in {
  0% {
    transform: translateX(-50%) translateY(-20px) scale(0.95);
    opacity: 0;
  }
  to {
    transform: translateX(-50%) translateY(0) scale(1);
    opacity: 1;
  }
}

@-webkit-keyframes navbar-float-in {
  0% {
    -webkit-transform: translateX(-50%) translateY(-20px) scale(0.95);
    opacity: 0;
  }
  to {
    -webkit-transform: translateX(-50%) translateY(0) scale(1);
    opacity: 1;
  }
}

@keyframes spinner {
  to {
    transform: rotate(1turn);
  }
}

@-webkit-keyframes spinner {
  to {
    -webkit-transform: rotate(1turn);
  }
}

@keyframes fade-in {
  0% {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@-webkit-keyframes fade-in {
  0% {
    opacity: 0;
    -webkit-transform: translateY(10px);
  }
  to {
    opacity: 1;
    -webkit-transform: translateY(0);
  }
}

@keyframes scale-in {
  0% {
    transform: scale(0.95);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

@-webkit-keyframes scale-in {
  0% {
    -webkit-transform: scale(0.95);
    opacity: 0;
  }
  to {
    -webkit-transform: scale(1);
    opacity: 1;
  }
}

@keyframes pageEnter {
  0% {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@-webkit-keyframes pageEnter {
  0% {
    opacity: 0;
    -webkit-transform: translateY(10px);
  }
  to {
    opacity: 1;
    -webkit-transform: translateY(0);
  }
}

@keyframes slideInDown {
  from {
    opacity: 0;
    transform: translateY(-30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@-webkit-keyframes slideInDown {
  from {
    opacity: 0;
    -webkit-transform: translateY(-30px);
  }
  to {
    opacity: 1;
    -webkit-transform: translateY(0);
  }
}

@keyframes slideOutUp {
  from {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    transform: translateY(-30px);
  }
}

@-webkit-keyframes slideOutUp {
  from {
    opacity: 1;
    -webkit-transform: translateY(0);
  }
  to {
    opacity: 0;
    -webkit-transform: translateY(-30px);
  }
}

@keyframes fadeOutBreadcrumb {
  0% {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    transform: translateY(-6px);
  }
}

@-webkit-keyframes fadeOutBreadcrumb {
  0% {
    opacity: 1;
    -webkit-transform: translateY(0);
  }
  to {
    opacity: 0;
    -webkit-transform: translateY(-6px);
  }
}

@keyframes fadeInBreadcrumb {
  0% {
    opacity: 0;
    transform: translateY(6px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@-webkit-keyframes fadeInBreadcrumb {
  0% {
    opacity: 0;
    -webkit-transform: translateY(6px);
  }
  to {
    opacity: 1;
    -webkit-transform: translateY(0);
  }
}


@keyframes showSongs {
  0% {
    opacity: 0;
    filter: blur(40px);
  }
  60% {
    filter: blur(0px);
    opacity: 0.6;
  }
  100% {
    filter: blur(0px);
    opacity: 1;
  }
}

@-webkit-keyframes showSongs {
  0% {
    opacity: 0;
    -webkit-filter: blur(40px);
  }
  60% {
    -webkit-filter: blur(0px);
    opacity: 0.6;
  }
  100% {
    -webkit-filter: blur(0px);
    opacity: 1;
  }
}

@keyframes hideSongs {
  0% {
    opacity: 1;
    filter: blur(0px);
  }
  100% {
    opacity: 0;
    filter: blur(40px);
  }
}

@-webkit-keyframes hideSongs {
  0% {
    opacity: 1;
    -webkit-filter: blur(0px);
  }
  100% {
    opacity: 0;
    -webkit-filter: blur(40px);
  }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@-webkit-keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes pulse {
  0% { box-shadow: var(--glow-effect); }
  50% { box-shadow: 0 0 12px rgba(83, 155, 245, 0.6); }
  100% { box-shadow: var(--glow-effect); }
}

@-webkit-keyframes pulse {
  0% { box-shadow: var(--glow-effect); }
  50% { box-shadow: 0 0 12px rgba(83, 155, 245, 0.6); }
  100% { box-shadow: var(--glow-effect); }
}






/* Dropdown Menu Styles *
.dropdown-menu {
  position: fixed;
  top: 0;
  right: 0;
  width: 320px;
  height: 100vh;
  background: rgba(23, 23, 33, 0.98);
  backdrop-filter: blur(10px);
  border-left: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: -5px 0 25px rgba(0, 0, 0, 0.2);
  z-index: 1000;
  overflow-y: auto;
  transform: translateX(100%);
  transition: transform 0.3s ease;
}

.dropdown-menu.active {
  transform: translateX(0);
}
**/
.dropdown-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.dropdown-title {
  font-size: 18px;
  font-weight: 600;
  color: #fff;
}

.dropdown-close {
  background: rgba(255, 255, 255, 0.1);
  border: none;
  border-radius: 8px;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: #fff;
  transition: background 0.2s;
}

.dropdown-close:hover {
  background: rgba(255, 255, 255, 0.2);
}

.dropdown-section {
  padding: 16px 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.dropdown-section:last-child {
  border-bottom: none;
}

.section-title {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 0 20px 12px;
  font-size: 14px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.7);
}

.dropdown-item {
  display: flex;
  align-items: center;
  padding: 12px 20px;
  gap: 12px;
  cursor: pointer;
  transition: background 0.2s;
}

.dropdown-item:hover {
  background: rgba(255, 255, 255, 0.05);
}

.dropdown-item-icon {
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: rgba(255, 255, 255, 0.7);
  flex-shrink: 0;
}

.dropdown-item-content {
  flex: 1;
  min-width: 0;
}

.dropdown-item-title {
  font-size: 14px;
  font-weight: 500;
  margin-bottom: 2px;
  color: #fff;
}

.dropdown-item-subtitle {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.6);
}

.dropdown-item-badge {
  background: rgba(79, 70, 229, 0.2);
  color: #8b9dff;
  font-size: 12px;
  font-weight: 600;
  padding: 2px 8px;
  border-radius: 10px;
}

.empty-state {
  text-align: center;
  padding: 30px 20px;
}

.empty-state-icon {
  width: 48px;
  height: 48px;
  margin: 0 auto 12px;
  color: rgba(255, 255, 255, 0.3);
}

.empty-state-text {
  font-size: 14px;
  color: rgba(255, 255, 255, 0.5);
  line-height: 1.4;
}

</style>
   

</head>

<body>
  
  
  
  
  
<!-- === Eruda DevTools: Drop-in Loader =================================== -->
<style>
  /* Minimal, tasteful toggle pill */
  .eruda-toggle {
    position: fixed;
    right: 14px;
    bottom: 14px;
    z-index: 2147483647; /* above everything */
    padding: 8px 10px;
    border-radius: 999px;
    font: 600 12px/1 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    background: rgba(31, 35, 40, 0.85);
    color: #e6edf3;
    border: 1px solid rgba(110, 118, 129, 0.4);
    box-shadow: 0 6px 20px rgba(0,0,0,.35);
    opacity: 0;
    transform: translateY(6px) scale(0.98);
    pointer-events: none;
    transition: opacity .25s ease, transform .25s ease, background .2s ease, border-color .2s ease;
    -webkit-tap-highlight-color: transparent;
  }
  .eruda-toggle:hover { background: rgba(45, 51, 56, 0.95); border-color: rgba(110,118,129,0.55); }
  .eruda-toggle--show { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
  .eruda-toggle[data-active="1"] { background: rgba(10, 132, 255, 0.92); border-color: rgba(10,132,255,.6); color: #fff; }
  .eruda-toggle:focus-visible { outline: 2px solid #3b82f6; outline-offset: 2px; }

  /* Optional: subtle “long-press” hint ripple */
  .eruda-toggle[data-pressing="1"] { filter: brightness(1.08); transform: translateY(0) scale(0.985); }
</style>

<button id="erudaToggle"
style="pointer-events: all; z-index: 999999999999999999999999;"
        class="eruda-toggle"
        type="button"
        aria-label="Toggle DevTools"
        title="Toggle DevTools (Ctrl+Alt+E)"
        hidden>
  DEV
</button>

<script>
;(() => {
  // -------------------- Configuration --------------------
  const CFG = {
    // Enable DevTools when any of these are true:
    urlParams: ['eruda', 'debug'],          // e.g. ?eruda=true or ?debug=1
    hashFlags: ['eruda', 'debug'],          // e.g. #eruda
    localStorageKeys: ['active-eruda', 'devtools:enabled'], // "true" or "1"
    showTogglePillWhenEnabled: true,

    // Eruda + plugin CDNs (order = priority; first that loads wins)
    cdnEruda: [
      'https://cdn.jsdelivr.net/npm/eruda',
      'https://unpkg.com/eruda'
    ],
    plugins: [
      { name: 'code',     globals: 'erudaCode',     urls: ['https://cdn.jsdelivr.net/npm/eruda-code'] },
      { name: 'timing',   globals: 'erudaTiming',   urls: ['https://cdn.jsdelivr.net/npm/eruda-timing'] },
      { name: 'features', globals: 'erudaFeatures', urls: ['https://cdn.jsdelivr.net/npm/eruda-features'] },
      { name: 'monitor',  globals: 'erudaMonitor',  urls: ['https://cdn.jsdelivr.net/npm/eruda-monitor'] }
      // You can add more official plugins later (e.g., touches, orientation, geolocation, benchmark, vue)
    ],

    // UX / gestures
    longPressMs: 700,     // hold the pill to toggle when disabled
    keyboardToggle: { ctrl: true, alt: true, key: 'e' }, // Ctrl+Alt+E
  };

  // -------------------- Utilities --------------------
  const qs = new URLSearchParams(location.search);
  const hasUrlFlag   = CFG.urlParams.some(k => /^(1|true|yes|on)$/i.test(qs.get(k) || ''));
  const hasHashFlag  = CFG.hashFlags.some(k => location.hash.replace('#','').toLowerCase().includes(k));
  const lsEnabled    = (k => k && (k === 'true' || k === '1'))(
                        CFG.localStorageKeys.map(k => localStorage.getItem(k)).find(Boolean)
                      );
  const initialShouldEnable = hasUrlFlag || hasHashFlag || lsEnabled;

  const $ = sel => document.querySelector(sel);
  const on = (el, ev, fn, opts) => el && el.addEventListener(ev, fn, opts);
  const setLS = (v) => CFG.localStorageKeys.forEach(k => localStorage.setItem(k, v));
  const rmLS  = () => CFG.localStorageKeys.forEach(k => localStorage.removeItem(k));

  const loadScript = (src) => new Promise((resolve, reject) => {
    const s = document.createElement('script');
    s.src = src;
    s.async = true;
    s.crossOrigin = 'anonymous';
    s.referrerPolicy = 'no-referrer';
    s.onload = () => resolve(src);
    s.onerror = () => reject(new Error('Failed to load ' + src));
    document.head.appendChild(s);
  });

  const loadFirstWorking = async (urls) => {
    let lastErr;
    for (const u of urls) {
      try { await loadScript(u); return u; }
      catch (e) { lastErr = e; }
    }
    throw lastErr || new Error('No URL succeeded.');
  };

  // -------------------- Eruda Controller --------------------
  const ErudaCtl = {
    installed: false,
    installing: null,

    async install() {
      if (this.installed) return;
      if (this.installing) return this.installing;

      this.installing = (async () => {
        // 1) Load Eruda core
        await loadFirstWorking(CFG.cdnEruda);
        if (!window.eruda) throw new Error('eruda global missing after load');

        // 2) Init and show the core
        window.eruda.init();
        window.eruda.show();

        // 3) Load desired plugins (best-effort; ignore failures)
        for (const p of CFG.plugins) {
          const already = window[p.globals];
          try {
            if (!already) await loadFirstWorking(p.urls);
            if (window[p.globals]) window.eruda.add(window[p.globals]);
          } catch (_) { /* plugin optional; ignore */ }
        }

        this.installed = true;
      })();

      return this.installing;
    },

    async uninstall() {
      if (!window.eruda) return;
      try { window.eruda.destroy(); } catch (_) {}
      // leave scripts in place; DevTools re-enable will work without reload
      this.installed = false;
      this.installing = null;
    }
  };

  // -------------------- Public API (window.DebugSuite) --------------------
  window.DebugSuite = {
    async enableEruda()  { setLS('true'); await ErudaCtl.install(); updatePill(true); },
    async disableEruda() { rmLS(); await ErudaCtl.uninstall(); updatePill(false); },
    async toggleEruda()  { if (window.eruda) { await this.disableEruda(); } else { await this.enableEruda(); } },
    isEnabled()          { return !!window.eruda; },

    // For convenience if you want a single “do it all” entry point:
    async runAll() { return this.enableEruda(); }
  };

  // -------------------- UI: Toggle Pill & Gestures --------------------
  const pill = document.getElementById('erudaToggle');
  let pressTimer = 0, pressing = false;

  function showPill() {
    if (!CFG.showTogglePillWhenEnabled) return;
    pill.hidden = false;
    requestAnimationFrame(() => pill.classList.add('eruda-toggle--show'));
  }
  function hidePill() {
    pill.classList.remove('eruda-toggle--show');
    setTimeout(() => { pill.hidden = true; }, 250);
  }
  function updatePill(active) {
    pill.dataset.active = active ? '1' : '0';
    if (active) showPill(); else showPill(); // keep visible so you can disable again
  }

  // Click toggles when already enabled; long-press enables from scratch
  on(pill, 'click', async () => {
    if (window.eruda) {
      await window.DebugSuite.toggleEruda();
    } else {
      // If not yet loaded, single click = enable and open
      await window.DebugSuite.enableEruda();
    }
  });

  const startPress = () => {
    if (pressing) return;
    pressing = true;
    pill.dataset.pressing = '1';
    pressTimer = setTimeout(async () => {
      await window.DebugSuite.enableEruda();
      pill.dataset.pressing = '0';
      pressing = false;
    }, CFG.longPressMs);
  };
  const endPress = () => {
    pill.dataset.pressing = '0';
    pressing = false;
    clearTimeout(pressTimer);
  };
  on(pill, 'pointerdown', startPress);
  on(pill, 'pointerup', endPress);
  on(pill, 'pointerleave', endPress);
  on(pill, 'pointercancel', endPress);

  // Keyboard: Ctrl+Alt+E toggles
  on(window, 'keydown', async (e) => {
    const wants = CFG.keyboardToggle;
    const hit = (!!wants.ctrl === e.ctrlKey) && (!!wants.alt === e.altKey) && (e.key.toLowerCase() === wants.key);
    if (hit) {
      e.preventDefault();
      await window.DebugSuite.toggleEruda();
    }
  });

  // -------------------- Boot --------------------
  (async function boot() {
    // Decide visibility of pill
    if (initialShouldEnable) showPill();
    else {
      // Still show a small entry point; holding the pill enables tools
      showPill();
    }

    // Auto-enable if flags are present
    if (initialShouldEnable) await window.DebugSuite.enableEruda();
    else updatePill(false);
  })();
})();
</script>
<!-- === /Eruda DevTools ================================================ -->  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <!-- Hidden YouTube Player -->
    <div id="youtube-audio-wrapper" style="position: absolute; left: -9999px;">
      <div id="youtube-player"></div>
    </div>

<!-- Remove Later -->  
    <button id="theme-toggle" style="opacity: 0; pointer-events: none; z-index: -9999999999999;">
    </button>
<!------------>  
    
    
    
    
    <!-- Main Page Wrapper -->
    <div id="pageWrapper">
      <!-- Theme Toggle Component -->
      <div class="theme-toggle-container">
        <div class="theme-trigger">
          <svg width="24" height="24" viewBox="0 0 24 24">
            <path fill="currentColor" d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121z"/>
          </svg>
        </div>
        <div class="theme-options">
          <button data-theme="light" aria-label="Light theme">
            <svg width="20" height="20" viewBox="0 0 24 24">
              <path fill="currentColor" d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121z"/>
            </svg>
          </button>
          <button data-theme="dim" aria-label="Dim theme">
            <svg width="20" height="20" viewBox="0 0 24 24">
              <path fill="currentColor" d="M9.822 2.238a9 9 0 0 0 11.94 11.94C20.768 18.654 16.775 22 12 22 6.477 22 2 17.523 2 12c0-4.775 3.346-8.768 7.822-9.762zm8.342.053L19 2.5v1l-.836.209a2 2 0 0 0-1.455 1.455L16.5 6h-1l-.209-.836a2 2 0 0 0-1.455-1.455L13 3.5v-1l.836-.209A2 2 0 0 0 15.291.836L15.5 0h1l.209.836a2 2 0 0 0 1.455 1.455zm5 5L24 7.5v1l-.836.209a2 2 0 0 0-1.455 1.455L21.5 11h-1l-.209-.836a2 2 0 0 0-1.455-1.455L18 8.5v-1l.836-.209a2 2 0 0 0 1.455-1.455L20.5 5h1l.209.836a2 2 0 0 0 1.455 1.455z"/>
            </svg>
          </button>
          <button data-theme="dark" aria-label="Dark theme">
            <svg width="20" height="20" viewBox="0 0 24 24">
              <path fill="currentColor" d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1-8.313-12.454z"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Navigation Bar -->
      <nav id="navbar" class="glass-effect">
        <div class="navbar-content">
          <div class="navbar-left">
            <button class="menu-trigger" id="menu-trigger" title="Menu">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>

<div class="navbar-center" id="now-playing-area" title="Click to open Now Playing">
  <div class="now-playing-display">

    <div id="albumArtwork" class="flex items-center justify-center relative">
      <svg class="w-6 h-6 text-white transition-opacity duration-500 ease-in-out" fill="currentColor" viewBox="0 0 20 20">
        <path d="M18 3a1 1 0 00-1.196-.98l-10 2A1 1 0 006 5v9.114A4.369 4.369 0 005 14c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V7.82l8-1.6v5.894A4.369 4.369 0 0015 12c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V3z" />
      </svg>
      
      <img src="" alt="Album Cover" class="absolute inset-0 w-full h-full object-cover opacity-0 transition-opacity duration-500 ease-in-out" />
    </div>

    <div class="now-playing-info">
      <div id="songName-NAVBar" class="truncate">No song playing</div>
      <div id="artistName-NAVBar" class="truncate">Select a song to get started</div>
    </div>

    <div class="play-indicator" id="play-indicator"></div>
  </div>
</div>

          <div class="navbar-right">
            <div class="nav-controls">
              <button class="nav-control-btn" id="prev-btn-navbar" title="Previous Track">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M8.445 14.832A1 1 0 0010 14v-2.798l5.445 3.63A1 1 0 0017 14V6a1 1 0 00-1.555-.832L10 8.798V6a1 1 0 00-1.555-.832l-6 4a1 1 0 000 1.664l6 4z" />
                </svg>
              </button>

              <button class="nav-control-btn play-pause" id="play-pause-navbar" title="Play/Pause">
                <svg id="play-icon-navbar" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                </svg>
                <svg id="pause-icon-navbar" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
              </button>

              <button class="nav-control-btn" id="next-btn-navbar" title="Next Track">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M4.555 5.168A1 1 0 003 6v8a1 1 0 001.555.832L10 11.202V14a1 1 0 001.555.832l6-4a1 1 0 000-1.664l-6-4A1 1 0 0010 6v2.798L4.555 5.168z" />
                </svg>
              </button>
            </div>

          </div>
        </div>
      </nav>

      <!-- Dropdown Menu -->
      <div class="dropdown-menu" id="dropdown-menu">
        <div class="dropdown-header">
          <h3 class="dropdown-title">Music Library</h3>
          <button class="dropdown-close" id="dropdown-close">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
          </button>
        </div>

        <div class="dropdown-section">
          <h4 class="section-title">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" />
            </svg>
            Favorites
          </h4>

          <div class="dropdown-item" id="favorite-songs">
            <div class="dropdown-item-icon">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <div class="dropdown-item-content">
              <div class="dropdown-item-title">Favorite Songs</div>
              <div class="dropdown-item-subtitle">Your liked tracks</div>
            </div>
            <div class="dropdown-item-badge" id="favorite-songs-count">0</div>
          </div>

          <div class="dropdown-item" id="favorite-artists">
            <div class="dropdown-item-icon">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9 12a3 3 0 00-3-3H2a1 1 0 100 2h4a1 1 0 011 1v.5a1 1 0 102 0V12zm3-8a3 3 0 100 6 3 3 0 000-6zm-1 4a1 1 0 11-2 0 1 1 0 012 0z" />
              </svg>
            </div>
            <div class="dropdown-item-content">
              <div class="dropdown-item-title">Favorite Artists</div>
              <div class="dropdown-item-subtitle">Artists you follow</div>
            </div>
            <div class="dropdown-item-badge" id="favorite-artists-count">0</div>
          </div>
        </div>

        <div class="dropdown-section">
          <h4 class="section-title">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
            </svg>
            Library
          </h4>

          <div class="dropdown-item" id="recently-played">
            <div class="dropdown-item-icon">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
              </svg>
            </div>
            <div class="dropdown-item-content">
              <div class="dropdown-item-title">Recent Plays</div>
              <div class="dropdown-item-subtitle">Recently played songs</div>
            </div>
            <div class="dropdown-item-badge" id="recent-count">0</div>
          </div>

          <div class="dropdown-item" id="queue-view">
            <div class="dropdown-item-icon">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" />
              </svg>
            </div>
            <div class="dropdown-item-content">
              <div class="dropdown-item-title">Up Next</div>
              <div class="dropdown-item-subtitle">Songs in queue</div>
            </div>
            <div class="dropdown-item-badge" id="queue-count">0</div>
          </div>
        </div>

        <div class="dropdown-section">
          <h4 class="section-title">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
            </svg>
            Playlists
          </h4>

          <div class="dropdown-item" id="create-playlist">
            <div class="dropdown-item-icon">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
              </svg>
            </div>
            <div class="dropdown-item-content">
              <div class="dropdown-item-title">Create Playlist</div>
              <div class="dropdown-item-subtitle">Make a new playlist</div>
            </div>
          </div>

          <div id="playlists-list">
            <div class="empty-state" id="playlists-empty">
              <div class="empty-state-icon">
                <svg class="w-full h-full" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
                </svg>
              </div>
              <div class="empty-state-text">
                No playlists yet.<br />
                Create your first playlist!
              </div>
            </div>
          </div>
        </div>

        <div class="dropdown-section">
          <h4 class="section-title">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z" />
            </svg>
            Actions
          </h4>

          <div class="dropdown-item" id="shuffle-all">
            <div class="dropdown-item-icon">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
              </svg>
            </div>
            <div class="dropdown-item-content">
              <div class="dropdown-item-title">Shuffle All</div>
              <div class="dropdown-item-subtitle">Play all songs randomly</div>
            </div>
          </div>
        </div>

        <div class="dropdown-section">
          <h4 class="section-title">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
            </svg>
            Settings
          </h4>

          <div class="dropdown-item" id="app-settings">
            <div class="dropdown-item-icon">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
              </svg>
            </div>
            <div class="dropdown-item-content">
              <div class="dropdown-item-title">Preferences</div>
              <div class="dropdown-item-subtitle">App settings & options</div>
            </div>
          </div>

          <div class="dropdown-item" id="about-app">
            <div class="dropdown-item-icon">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
              </svg>
            </div>
            <div class="dropdown-item-content">
              <div class="dropdown-item-title">About</div>
              <div class="dropdown-item-subtitle">Version & information</div>
            </div>
          </div>
        </div>
      </div>

<!-- Music Player -->
<style>
.musicPlayer {
  position: fixed;
  bottom: 6rem;
  left: 50%;
  transform: translateX(-50%);
  width: 90vw;
  height: 70vh;
  background: var(--background-400);
  backdrop-filter: var(--blur-lg);
  border-radius: 10px;
  border: 1px solid var(--border-200);
  color: var (--text-200);
  box-shadow: var(--shadow-2xl);
  z-index: var(--z-player);
  transition: var(--transition-smooth);
  overflow: hidden;
}

.musicPlayer.hidden {
  transform: translateX(-50%) translateY(100%);
  opacity: 0;
  pointer-events: none;
}




.musicPlayer > .handle {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-sm) 0;
  cursor: grab;
  transition: var(--transition-fast);
}

.musicPlayer > .handle:active {
  cursor: grabbing;
  background: var(--background-400);
}

.musicPlayer > .handle .grip {
  width: 40px;
  height: 4px;
  background: var(--text-400);
  border-radius: var(--radius-full);
  transition: var(--transition-fast);
}

.musicPlayer > .handle:hover .grip {
  background: var(--text-300);
  width: 50px;
}




.musicPlayer > .header {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  padding: var(--space-md) var(--space-lg) var(--space-sm);
  /**
  background: var(--background-200);
  border-bottom: 1px solid var(--border-200);
  **/
}

.musicPlayer > .header .close {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--background-400);
  border: none;
  border-radius: var(--radius-md);
  color: var(--text-300);
  cursor: pointer;
  transition: var(--transition-fast);
}

.musicPlayer > .header .close:hover {
  background: var(--accent-danger);
  color: var(--text-on-accent);
  transform: scale(1.05);
}

.musicPlayer > .header .close .icon {
  width: 16px;
  height: 16px;
}




.musicPlayer > .body {
  position: relative;
  padding: var(--space-lg);
  /**
  background: var(--background-300);
  **/
  max-height: 60vh;
  overflow-y: auto;
}

.musicPlayer > .body .content {
  display: none;
  animation: fadeIn 0.3s ease-out;
}

.musicPlayer > .body .content.active {
  display: block;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}




.musicPlayer > .body .cover {
  width: 100%;
  max-width: 280px;
  aspect-ratio: 1;
  object-fit: cover;
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-xl);
  margin: 0 auto var(--space-xl);
  display: block;
  background: var(--background-500);
  border: 1px solid var(--border-300);
}

.musicPlayer > .body .info {
  text-align: center;
  margin-bottom: var(--space-xl);
}

.musicPlayer > .body .info .title {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--text-100);
  margin-bottom: var(--space-xs);
  line-height: 1.3;
}

.musicPlayer > .body .info .artist {
  font-size: 1rem;
  color: var(--accent-primary);
  font-weight: 600;
  margin-bottom: var(--space-xs);
}

.musicPlayer > .body .info .album {
  font-size: 0.875rem;
  color: var(--text-300);
  font-weight: 500;
}




.musicPlayer > .body .progress {
  margin-bottom: var(--space-xl);
}

.musicPlayer > .body .progress .time {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-sm);
  font-size: 0.875rem;
  color: var(--text-300);
  font-weight: 500;
}

.musicPlayer > .body .progress .bar {
  height: 6px;
  background: var(--background-600);
  border-radius: var(--radius-full);
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

.musicPlayer > .body .progress .fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent-primary), var(--accent-purple));
  border-radius: var(--radius-full);
  position: relative;
  transition: width 0.1s ease-out;
}

.musicPlayer > .body .progress .thumb {
  position: absolute;
  right: -6px;
  top: 50%;
  transform: translateY(-50%);
  width: 12px;
  height: 12px;
  background: var(--text-100);
  border-radius: 50%;
  box-shadow: var(--shadow-md);
  opacity: 0;
  transition: var(--transition-fast);
}

.musicPlayer > .body .progress .bar:hover .thumb {
  opacity: 1;
}




.musicPlayer > .body .controls {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-md);
  margin-bottom: var(--space-xl);
}

.musicPlayer > .body .controls .btn {
  width: 38px;
  height: 38px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--background-400);
  border: none;
  border-radius: var(--radius-full);
  color: var(--text-200);
  cursor: pointer;
  transition: var(--transition-fast);
  border: 1px solid var(--border-200);
}

.musicPlayer > .body .controls .btn:hover {
  background: var(--background-500);
  transform: scale(1.05);
  color: var(--text-100);
  border-color: var(--border-300);
}

.musicPlayer > .body .controls .btn.primary {
  width: 45px;
  height: 45px;
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-purple));
  color: var(--text-on-accent);
  border-color: transparent;
  box-shadow: var(--shadow-lg);
}

.musicPlayer > .body .controls .btn.primary:hover {
  transform: scale(1.08);
  box-shadow: var(--shadow-xl);
}

.musicPlayer > .body .controls .btn .icon {
  width: 20px;
  height: 20px;
  fill: currentColor;
}

.musicPlayer > .body .controls .btn.primary .icon {
  width: 24px;
  height: 24px;
}

.musicPlayer > .body .controls .btn .icon.pause {
  display: none;
}

.musicPlayer > .body .controls .btn.playing .icon.play {
  display: none;
}

.musicPlayer > .body .controls .btn.playing .icon.pause {
  display: block;
}




.musicPlayer > .body .actions {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-md);
}

.musicPlayer > .body .actions .action {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  border-radius: var(--radius-md);
  color: var(--text-300);
  cursor: pointer;
  transition: var(--transition-fast);
}

.musicPlayer > .body .actions .action:hover {
  background: var(--background-400);
  color: var(--text-100);
  transform: scale(1.05);
}

.musicPlayer > .body .actions .action.active {
  background: var(--accent-primary);
  color: var(--text-on-accent);
}

.musicPlayer > .body .actions .action .icon {
  width: 16px;
  height: 16px;
  fill: currentColor;
}




.musicPlayer > .body .list {
  list-style: none;
  padding: 0;
  margin: 0;
  max-height: 300px;
  overflow-y: auto;
}

.musicPlayer > .body .list::-webkit-scrollbar {
  width: 6px;
}

.musicPlayer > .body .list::-webkit-scrollbar-track {
  background: var(--background-400);
  border-radius: var(--radius-full);
}

.musicPlayer > .body .list::-webkit-scrollbar-thumb {
  background: var(--background-600);
  border-radius: var(--radius-full);
}

.musicPlayer > .body .list::-webkit-scrollbar-thumb:hover {
  background: var(--background-700);
}

.musicPlayer > .body .empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--space-2xl);
  text-align: center;
}

.musicPlayer > .body .emptyIcon {
  width: 48px;
  height: 48px;
  color: var(--text-400);
  margin-bottom: var(--space-md);
  opacity: 0.7;
}

.musicPlayer > .body .emptyIcon .icon {
  width: 100%;
  height: 100%;
}

.musicPlayer > .body .emptyText {
  color: var(--text-300);
  font-size: 0.95rem;
  font-weight: 500;
}




.musicPlayer > .footer {
  /**
  background: var(--background-200);
  border-top: 1px solid var(--border-200);
  **/
  padding: var(--space-sm);
}

.musicPlayer > .footer .tabs {
  display: flex;
  /**
  background: var(--background-300);
  border-radius: var(--radius-lg);
  **/
  padding: var(--space-xs);
  gap: var(--space-xs);
}

.musicPlayer > .footer .tab {
  flex: 1;
  padding: var(--space-sm) var(--space-md);
  background: transparent;
  border-bottom: 2px solid transparent;
  
  color: var(--text-300);
  font-size: 0.875rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition-fast);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.musicPlayer > .footer .tab:hover {
  border-bottom: 2px solid var(--background-400);
  color: var(--text-200);
}

.musicPlayer > .footer .tab.active {
  border-bottom: 2px solid var(--accent-primary);
  color: var(--text-on-accent);

}




@media (max-width: 480px) {
  .musicPlayer {
    width: 90vw;
    border-radius: 0;
    border-left: none;
    border-right: none;
  }
  
  .musicPlayer > .body {
    padding: var(--space-md);
  }
  
  .musicPlayer > .body .controls {
    gap: var(--space-md);
  }
  
  .musicPlayer > .body .controls .btn {
    width: 30px;
    height: 30px;
  }
  
  .musicPlayer > .body .controls .btn.primary {
    width: 40px;
    height: 40px;
  }
  
  .musicPlayer > .body .actions {
    gap: var(--space-sm);
  }
  
  .musicPlayer > .body .actions .action {
    width: 25px;
    height: 25px;
  }
  
  .musicPlayer > .footer .tab {
    font-size: 0.8rem;
    padding: var(--space-xs) var(--space-sm);
  }
}

@media (max-width: 360px) {
  .musicPlayer > .body .controls .btn .icon {
    width: 18px;
    height: 18px;
  }
  
  .musicPlayer > .body .controls .btn.primary .icon {
    width: 20px;
    height: 20px;
  }
  
  .musicPlayer > .body .actions .action .icon {
    width: 14px;
    height: 14px;
  }
}




button:focus-visible {
  outline: 2px solid var(--accent-primary);
  outline-offset: 2px;
}

button:focus {
  outline: none;
}

.musicPlayer::-webkit-scrollbar {
  width: 6px;
}

.musicPlayer::-webkit-scrollbar-track {
  background: var(--background-400);
}

.musicPlayer::-webkit-scrollbar-thumb {
  background: var(--background-600);
  border-radius: var(--radius-full);
}

.musicPlayer::-webkit-scrollbar-thumb:hover {
  background: var(--background-700);
}

@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
</style>
<div class="musicPlayer" id="musicPlayer">
  <div class="handle" id="handle">
    <div class="grip"></div>
  </div>

  <div class="header">
    <button class="close" id="closeBtn">
      <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
      </svg>
    </button>
  </div>

  <div class="body">
    <!-- Now Playing -->
    <div class="content active" data-tab="playing">
      <img id="cover" src="" alt="Album Cover" class="cover" />

      <div class="info">
        <h4 id="title" class="title"></h4>
        <p id="artist" class="artist"></p>
        <p id="album" class="album"></p>
      </div>

      <div class="progress">
        <div class="time">
          <span id="current">0:00</span>
          <span id="total">0:00</span>
        </div>
        <div class="bar" id="progressBar">
          <div class="fill" id="progressFill" style="width: 0%;">
            <div class="thumb" id="progressThumb"></div>
          </div>
        </div>
      </div>

      <div class="controls">
        <button class="btn" id="prevBtn">
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
            <path d="M267.5 440.6c9.5 7.9 22.8 9.7 34.1 4.4s18.4-16.6 18.4-29V96c0-12.4-7.2-23.7-18.4-29s-24.5-3.6-34.1 4.4L75.5 231l0 49 192 160z" />
          </svg>
        </button>

        <button class="btn" id="rewindBtn">
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
            <path d="M459.5 440.6c9.5 7.9 22.8 9.7 34.1 4.4s18.4-16.6 18.4-29V96c0-12.4-7.2-23.7-18.4-29s-24.5-3.6-34.1 4.4L288 214.3V296l171.5 144.6zM256 352V96c0-12.4-7.2-23.7-18.4-29s-24.5-3.6-34.1 4.4L11.5 231C4.2 237.5 0 246.5 0 256s4.2 18.5 11.5 24.6l192 160c9.5 7.9 22.8 9.7 34.1 4.4s18.4-16.6 18.4-29V352z" />
          </svg>
        </button>

        <button class="btn primary" id="playBtn">
          <svg class="icon play" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
            <path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z" />
          </svg>
          
          <svg class="icon pause" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
            <path d="M48 64C21.5 64 0 85.5 0 112L0 400c0 26.5 21.5 48 48 48l32 0c26.5 0 48-21.5 48-48l0-288c0-26.5-21.5-48-48-48L48 64zm192 0c-26.5 0-48 21.5-48 48l0 288c0 26.5 21.5 48 48 48l32 0c26.5 0 48-21.5 48-48l0-288c0-26.5-21.5-48-48-48l-32 0z" />
          </svg>
        </button>

        <button class="btn" id="forwardBtn">
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
            <path d="M52.5 440.6c-9.5 7.9-22.8 9.7-34.1 4.4S0 428.4 0 416V96c0-12.4 7.2-23.7 18.4-29s24.5-3.6 34.1 4.4L224 214.3V296L52.5 440.6zM256 352V96c0-12.4 7.2-23.7 18.4-29s24.5-3.6 34.1 4.4l192 160c7.3 6.1 11.5 15.1 11.5 24.6s-4.2 18.5-11.5 24.6L308.5 440.6c-9.5 7.9-22.8 9.7-34.1 4.4S256 428.4 256 416V352z" />
          </svg>
        </button>

        <button class="btn" id="nextBtn">
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
            <path d="M52.5 440.6c-9.5 7.9-22.8 9.7-34.1 4.4S0 428.4 0 416V96c0-12.4 7.2-23.7 18.4-29s24.5-3.6 34.1 4.4l192 160V96c0-17.7 14.3-32 32-32s32 14.3 32 32v320c0 17.7-14.3 32-32 32s-32-14.3-32-32V271.4L52.5 440.6z" />
          </svg>
        </button>
      </div>

      <div class="actions">
        <button class="action" id="favoriteBtn" title="Add to Favorites">
          <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
            <path d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" />
          </svg>
        </button>

        <button class="action" id="queueBtn" title="View Queue">
          <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
            <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
          </svg>
        </button>

        <button class="action" id="shareBtn" title="Share">
          <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
            <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z" />
          </svg>
        </button>

        <button class="action" id="moreBtn" title="More Options">
          <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Queue -->
    <div class="content" data-tab="queue">
      <ul id="queueList" class="list">
        <div class="empty">
          <div class="emptyIcon">
            <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
              <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
            </svg>
          </div>
          <div class="emptyText">Queue is empty.</div>
        </div>
      </ul>
    </div>

    <!-- Recent -->
    <div class="content" data-tab="recent">
      <ul id="recentList" class="list">
        <div class="empty">
          <div class="emptyIcon">
            <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
              <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
            </svg>
          </div>
          <div class="emptyText">No recently played songs.</div>
        </div>
      </ul>
    </div>
  </div>
  
  <!-- Tabs -->
  <div class="footer">
    <div class="tabs">
      <button class="tab active" data-tab="playing">Now Playing</button>
      <button class="tab" data-tab="recent">Recent Plays</button>
      <button class="tab" data-tab="queue">Up Next</button>
    </div>
  </div>
</div>

      <!-- Main Content Area -->
      <div id="mainArea">
        <main id="main-container" class="content-container max-w-6xl mx-auto pb-24">
          <div id="contentWrapper" class="relative">
            <nav id="breadcrumb-nav" class="breadcrumb-navigation flex items-center text-fg-muted">
              <ol class="breadcrumb-list flex items-center flex-wrap"></ol>
            </nav>

            <div id="dynamic-content" class="mx-auto max-w-2xl px-6 lg:max-w-7xl lg:px-8">
              <div class="text-center py-8 md:py-12">
                <h1 class="text-4xl md:text-5xl font-bold mb-6 gradient-text">Discover Amazing Music</h1>
                <p class="text-lg md:text-xl text-gray-400 mb-8 md:mb-12 max-w-2xl mx-auto">Explore artists, albums, and songs from your personal library with an immersive listening experience</p>
              </div>
              
              <h4 class="text-2xl md:text-3xl font-bold mb-6 md:mb-8 px-4 font-semibold text-indigo-600">Featured Artists</h4>
              
              <div id="featured-artists" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-8 px-4"></div>
            </div>

            <div id="content-loading" class="absolute inset-0 bg-bg-default bg-opacity-80 backdrop-blur-sm flex items-center justify-center hidden">
              <div class="loading-animation">
                <div class="spinner-container">
                  <div class="spinner"></div>
                </div>
                <p class="mt-4 text-fg-muted">Loading content...</p>
              </div>
            </div>
          </div>
        </main>
      </div>

      <!-- Floating Action Button -->
      <button class="floating-add-button" id="floating-add-button" title="Create Playlist">
        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
        </svg>
      </button>

      <!-- Popover Portal -->
      <div id="popover-portal" class="popover-portal"></div>

      <!-- PWA Install Banner -->
      <div id="pwa-install-banner" class="fixed bottom-0 end-0 z-60 sm:max-w-sm w-full mx-auto p-6 opacity-0 pointer-events-none transition-all duration-300">
        <div class="p-4 bg-white border border-gray-200 rounded-xl shadow-2xs dark:bg-neutral-900 dark:border-neutral-800 flex gap-x-4">
          <svg class="shrink-0 w-8 h-auto" width="72" height="63" viewBox="0 0 72 63" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15.5174 56.1528C16.2903 57.6825 16.929 61.4559 14.8118 60.9459C13.5013 60.5381 11.4445 57.6213 12.493 56.1528C12.661 55.8468 13.2189 55.2757 14.106 55.4389" stroke="currentColor" class="dark:stroke-neutral-200" stroke-width="2" stroke-linecap="round"/>
            <path d="M15.5173 49.6263L14.0262 48.5579C13.5346 48.2056 12.8477 48.3707 12.658 48.945C12.3456 49.8907 12.1258 51.1463 12.462 52.2324C12.5336 52.4636 12.7127 52.6466 12.9449 52.7146C13.8342 52.9751 15.2568 52.9048 15.8197 51.054" stroke="currentColor" class="dark:stroke-neutral-200" stroke-width="2" stroke-linecap="round"/>
            <ellipse cx="51.2061" cy="22.3973" rx="3.02446" ry="3.05945" fill="currentColor" class="text-gray-800 dark:fill-neutral-200"/>
          </svg>
          <div class="grow">
            <p class="text-sm text-gray-800 dark:text-neutral-200">
              Open in the app, or 
              <a id="pwa-download-link" class="inline-flex items-center gap-x-1.5 text-blue-600 decoration-2 hover:underline font-medium dark:text-blue-500" href="#">
                Install App
              </a>
            </p>
          </div>
          <div>
            <button id="pwa-dismiss" type="button" class="p-2 inline-flex items-center gap-x-2 text-sm font-semibold rounded-full border border-transparent text-gray-500 hover:bg-gray-50 focus:outline-hidden focus:bg-gray-50 dark:text-neutral-400 dark:hover:bg-neutral-700 dark:focus:bg-neutral-700">
              <span class="sr-only">Dismiss</span>
              <svg class="shrink-0 size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- External Scripts -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/preline@2.0.3/dist/preline.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tippy.js@6.3.7/dist/tippy.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>


    <script src="./dynamicOverlays.js"></script>

    <!-- Inline Scripts -->
    <script>
      // Theme Toggle Functionality
      document.addEventListener('DOMContentLoaded', () => {
        const container = document.querySelector('.theme-toggle-container');
        const trigger = document.querySelector('.theme-trigger');
        const themeButtons = document.querySelectorAll('.theme-options button');
        const html = document.documentElement;
        
        // Set initial theme from localStorage or default
        const savedTheme = localStorage.getItem('theme') || 'dark';
        html.setAttribute('data-theme', savedTheme);
        
        // Set active button
        themeButtons.forEach(btn => {
          btn.classList.toggle('active', btn.dataset.theme === savedTheme);
          
          btn.addEventListener('click', () => {
            const theme = btn.dataset.theme;
            html.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            
            // Update button states
            themeButtons.forEach(b => b.classList.toggle('active', b === btn));
            
            // Close the menu after selection
            container.classList.remove('active');
          });
        });
        
        // Toggle menu
        trigger.addEventListener('click', (e) => {
          e.stopPropagation();
          container.classList.toggle('active');
        });
        
        // Close when clicking outside
        document.addEventListener('click', () => {
          container.classList.remove('active');
        });
      });

      // Breadcrumb Navigation Intersection Observer
      document.addEventListener("DOMContentLoaded", function () {
        let nav = document.querySelector(".breadcrumb-navigation");
        let artistTop = document.querySelector(".artistTop");

        if (nav && artistTop) {
          let observer = new IntersectionObserver(
            function (entries) {
              entries.forEach(function (entry) {
                nav.classList.toggle("stuck", !entry.isIntersecting);
                artistTop.classList.toggle("stuck", !entry.isIntersecting);
              });
            },
            {
              threshold: 0,
              rootMargin: "-1px 0px 0px 0px",
            }
          );

          observer.observe(artistTop);
        }
      });

      // Music Player Toggle
      const triggerEl = document.getElementById("now-playing-area");
      const closePlayerEl = document.getElementById("closePlayer");
      const musicPlayer = document.querySelector(".musicPlayer");

      triggerEl.addEventListener("click", () => {
        musicPlayer.classList.toggle("show");
      });

      closePlayerEl.addEventListener("click", () => {
        musicPlayer.classList.remove("show");
      });

      // PWA Installation Banner
      let deferredPrompt;
      const banner = document.getElementById("pwa-install-banner");
      const installLink = document.getElementById("pwa-download-link");
      const dismissBtn = document.getElementById("pwa-dismiss");

      window.addEventListener("beforeinstallprompt", e => {
        e.preventDefault();
        deferredPrompt = e;
        showPWABanner();
      });

      function showPWABanner() {
        banner.style.opacity = "1";
        banner.style.pointerEvents = "auto";
        banner.classList.remove("translate-y-5");
      }

      function hidePWABanner() {
        banner.style.opacity = "0";
        banner.style.pointerEvents = "none";
      }

      installLink.addEventListener("click", async e => {
        e.preventDefault();
        hidePWABanner();
        if (deferredPrompt) {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          console.log(`User response to the install prompt: ${outcome}`);
          deferredPrompt = null;
        }
      });

      dismissBtn.addEventListener("click", hidePWABanner);

      window.addEventListener("DOMContentLoaded", () => {
        if (window.matchMedia("(display-mode: standalone)").matches) {
          console.log("App running in standalone mode.");
        } else if ("getInstalledRelatedApps" in navigator) {
          navigator.getInstalledRelatedApps().then(relatedApps => {
            if (relatedApps.length > 0) {
              console.log("PWA installed.");
              showPWABanner();
            } else {
              console.log("PWA not installed.");
            }
          });
        }
      });

      // Service Worker Registration
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("./system/serviceWorker.js")
            .then(registration => {
              console.log("Service Worker registered:", registration.scope);
            })
            .catch(err => {
              console.error("Service Worker registration failed:", err);
            });
        });
      }

      // Eruda Dev Tools Initialization
      eruda.init();

      // Create a custom Eruda tool for live CSS editing
      eruda.add({
        name: "Live CSS",
        init($el) {
          $el.html(`
            <textarea id="liveCssArea" style="width:100%;height:200px;"></textarea>
            <button id="applyCssBtn">Apply CSS</button>
          `);

          let styleTag = document.createElement("style");
          document.head.appendChild(styleTag);

          $el.on("click", "#applyCssBtn", () => {
            styleTag.innerHTML = document.getElementById("liveCssArea").value;
          });
        },
        show() {},
        hide() {},
      });

      // Floating UI Components (Tooltips, Popovers, Dropdowns)
      (function () {
        // Hide / then Kill Component
        function killAllFloating() {
          document.querySelectorAll(".gh-floating").forEach((el) => el.remove());
        }

        window.GHUI = window.GHUI || {}; // Global use
        window.GHUI.killAllFloating = killAllFloating;

        // Create the element
        function createFloating(content, type = "tooltip") {
          const el = document.createElement("div");
          el.classList.add("gh-floating");
          if (type === "dropdown") el.classList.add("gh-dropdown");
          el.innerHTML = content;
          document.body.appendChild(el);
          return el;
        }
        
        // Determine when & where to render it
        function placeFloating(trigger, floating) {
          const rect = trigger.getBoundingClientRect();
          const floatRect = floating.getBoundingClientRect();
          let top, left, placement = "top";

          if (rect.top > floatRect.height + 10) {
            top = window.scrollY + rect.top - floatRect.height - 12;
            left = window.scrollX + rect.left + rect.width / 2 - floatRect.width / 2;
            placement = "top";
          } else if (window.innerHeight - rect.bottom > floatRect.height + 10) {
            top = window.scrollY + rect.bottom + 12;
            left = window.scrollX + rect.left + rect.width / 2 - floatRect.width / 2;
            placement = "bottom";
          } else if (rect.left > floatRect.width + 10) {
            top = window.scrollY + rect.top + rect.height / 2 - floatRect.height / 2;
            left = window.scrollX + rect.left - floatRect.width - 12;
            placement = "left";
          } else {
            top = window.scrollY + rect.top + rect.height / 2 - floatRect.height / 2;
            left = window.scrollX + rect.right + 12;
            placement = "right";
          }

          floating.style.top = `${Math.max(4, top)}px`;
          floating.style.left = `${Math.max(4, left)}px`;
          floating.setAttribute("data-placement", placement);
        }

        // ToolTip Functionality
        document.addEventListener(
          "mouseenter",
          function (e) {
            const el = e.target.closest("[data-tooltip]");
            if (!el) return;
            let floating = null;
            const content = el.getAttribute("data-tooltip");
            floating = createFloating(content, "tooltip");
            placeFloating(el, floating);
            requestAnimationFrame(() => floating.setAttribute("data-show", "true"));

            // Click inside tooltip on "More options…" to expand
            floating.addEventListener("click", (ev) => {
              const expandTrigger = ev.target.closest("[data-expand]");
              if (expandTrigger) {
                ev.stopPropagation();
                floating.classList.add("gh-expanded");
                // Replace content or append extra options
                floating.innerHTML = `
                  <div style="padding:4px 0;">
                    <div style="font-weight:bold;margin-bottom:4px;">${el.dataset.album || "Album"}</div>
                    <div class="gh-separator"></div>
                    <div style="padding:6px;">Option A</div>
                    <div style="padding:6px;">Option B</div>
                    <div style="padding:6px;">Option C</div>
                  </div>
                `;
                placeFloating(el, floating); // re-position after size change
              }
            });

            el.addEventListener(
              "mouseleave",
              () => {
                if (floating && !floating.classList.contains("gh-expanded")) {
                  floating.remove();
                  floating = null;
                }
              },
              { once: true }
            );

            window.addEventListener("scroll", () => {
              if (floating) placeFloating(el, floating);
            });
            window.addEventListener("resize", () => {
              if (floating) placeFloating(el, floating);
            });
          },
          true
        );

        // DropDown Menus Functionality
        document.addEventListener(
          "click",
          function (e) {
            const el = e.target.closest("[data-dropdown]");
            if (!el) return;
            e.stopPropagation();
            killAllFloating(); // CLOSE ANY EXISTING FLOATERS FIRST
            const html = el.querySelector("template")?.innerHTML || "";
            const floating = createFloating(html, "dropdown");
            placeFloating(el, floating);
            requestAnimationFrame(() => floating.setAttribute("data-show", "true"));

            floating.addEventListener("mouseenter", () => {
              clearTimeout(floating._hideTimer);
            });
            floating.addEventListener("mouseleave", () => {
              floating._hideTimer = setTimeout(() => {
                floating.remove();
              }, 200);
            });
          },
          true
        );

        // When to hide / then kill the components
        document.addEventListener("click", () => killAllFloating());
      })();
    </script>
    
    
    
    
    <script>
document.addEventListener("DOMContentLoaded", function() {
  const trigger = document.getElementById("menu-trigger");
  const dropdown = document.getElementById("dropdown-menu");

  if (trigger && dropdown) {
    trigger.addEventListener("click", function() {
      dropdown.classList.toggle("show");
    });
  }
});
</script>

<script type="module" src="./modules/library.js"></script>

<!--------- siteMap.js ----------------------->
<script type="module">
// Export all constants properly
export const IDS = Object.freeze({
  nowPlayingArea: 'now-playing-area',
  themeToggle: 'theme-toggle',
  globalSearchTrigger: 'global-search-trigger',
  searchDialog: 'search-dialog',
  globalSearchForm: 'global-search-form',
  globalSearchInput: 'global-search-input',
  recentSearchesList: 'recent-searches-list',
  popoverPortal: 'popover-portal',
  willHideMenu: 'will-hide-menu',
  menuTrigger: 'menu-trigger',
  dropdownMenu: 'dropdown-menu',
  dropdownClose: 'dropdown-close',
  playIndicator: 'play-indicator',
  prevBtnNavbar: 'prev-btn-navbar',
  nextBtnNavbar: 'next-btn-navbar',
  playPauseNavbar: 'play-pause-navbar',
  playIconNavbar: 'play-icon-navbar',
  pauseIconNavbar: 'pause-icon-navbar',
  favoriteSongs: 'favorite-songs',
  favoriteArtists: 'favorite-artists',
  createPlaylist: 'create-playlist',
  recentlyPlayed: 'recently-played',
  queueView: 'queue-view',
  searchMusic: 'search-music',
  shuffleAll: 'shuffle-all',
  appSettings: 'app-settings',
  aboutApp: 'about-app',
  favoriteSongsCount: 'favorite-songs-count',
  favoriteArtistsCount: 'favorite-artists-count',
  recentCount: 'recent-count',
  queueCount: 'queue-count',
  
  // Music Player Container & Structure
  musicPlayer: 'musicPlayer',
  playerHandle: 'handle',
  playerCloseBtn: 'closeBtn',
  
  // Music Player - Now Playing Content (updated from popup- prefix)
  albumCover: 'cover',
  songTitle: 'title',
  artistName: 'artist',
  albumName: 'album',
  currentTime: 'current',
  totalTime: 'total',
  progressBar: 'progressBar',
  progressFill: 'progressFill',
  progressThumb: 'progressThumb',
  
  // Music Player - Controls (updated from popup- prefix)
  playBtn: 'playBtn',
  prevBtn: 'prevBtn',
  nextBtn: 'nextBtn',
  rewindBtn: 'rewindBtn',
  forwardBtn: 'forwardBtn',
  
  // Music Player - Actions (updated from popup- prefix)
  favoriteBtn: 'favoriteBtn',
  queueBtn: 'queueBtn',
  shareBtn: 'shareBtn',
  moreBtn: 'moreBtn',
  
  // Music Player - Lists (updated from popup- prefix)
  queueList: 'queueList',
  recentList: 'recentList',
  
  // Main Content Areas
  dynamicContent: 'dynamic-content',
  contentLoading: 'content-loading',
  recentlyPlayedSection: 'recently-played-section',
  randomAlbumsSection: 'random-albums-section',
  favoriteArtistsSection: 'favorite-artists-section',
  playlistsSection: 'playlists-section',
  favoriteSongsSection: 'favorite-songs-section',
  albumsContainer: 'albums-container',
  artistsGrid: 'artists-grid',
  artistSearch: 'artist-search',
  genreFilters: 'genre-filters',
  seekTooltip: 'seek-tooltip'
});

export const CLASSES = Object.freeze({
  hidden: 'hidden',
  searchDialogOpening: 'search-dialog-opening',
  searchDialogClosing: 'search-dialog-closing',
  hasSong: 'has-song',
  light: 'light',
  medium: 'medium',
  show: 'show',
  active: 'active',
  marquee: 'marquee',
  repeatOne: 'repeat-one',
  animateRotate: 'animate__animated animate__rotateIn',
  animateFadeIn: 'animate__animated animate__fadeIn',
  animateZoomIn: 'animate__animated animate__zoomIn',
  animatePulse: 'animate__animated animate__pulse',
  imageFallback: 'image-fallback',
  imageLoaded: 'image-loaded',
  imageError: 'image-error',
  imageLoading: 'image-loading',

  playing: 'playing'
});




///////////////  S E L E C T O R S   ///////
////////////////////////////////////////////
export const MUSIC_PLAYER = Object.freeze({
  musicPlayerClose: '#musicPlayer .close',
  musicPlayerTabs: '#musicPlayer .tab',
  musicPlayerActiveTab: '#musicPlayer .tab.active',
  musicPlayerContent: '#musicPlayer .content',
  musicPlayerActiveContent: '#musicPlayer .content.active',
  musicPlayerControls: '#musicPlayer .controls .btn',
  musicPlayerActions: '#musicPlayer .actions .action',
  playingButton: '.btn.playing',
  playIcon: '.icon.play',
  pauseIcon: '.icon.pause',
  closeButtons: '.close',
  activeElements: '.active',
  hiddenElements: '.hidden'
});
////////////////////////////////////////////

export const NAVBAR = Object.freeze ({
  albumArtwork: '#NAVBar .albumArtwork',
  artistName: '#artistName-NAVBar',
  songName: '#songName-NAVBar',
})





export const MODALS = Object.freeze({
  modalClose: '.modal .close',
  dialogClose: '#searchDialog .close',
  dropdownClose: '#dropdownMenu .close',
})









export const ROUTES = Object.freeze({
  HOME: 'home',
  ARTIST: 'artist',
  ALL_ARTISTS: 'allArtists',
  SEARCH: 'search',
  ALBUM: 'album'
});

export const THEMES = Object.freeze({
  DARK: 'dark',
  MEDIUM: 'medium',
  LIGHT: 'light'
});

export const STORAGE_KEYS = Object.freeze({
  THEME_PREFERENCE: 'theme-preference',
  RECENT_SEARCHES: 'recentSearches',
  FAVORITE_SONGS: 'favoriteSongs',
  FAVORITE_ARTISTS: 'favoriteArtists',
  FAVORITE_ALBUMS: 'favoriteAlbums',
  RECENTLY_PLAYED: 'recentlyPlayed',
  PLAYLISTS: 'playlists',
  QUEUE: 'queue'
});

export const ICONS = Object.freeze({
  dark: '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 116.707 2.707a8.001 8.001 0 1010.586 10.586z"/></svg>',
  medium: '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2L13 9h7l-5.5 4 2 7L10 16l-6.5 4 2-7L1 9h7l2-7z"/></svg>',
  light: '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"/></svg>',
  play: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>',
  pause: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>',
  next: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>',
  prev: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg>',
  shuffle: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/></svg>',
  repeat: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg>',
  heart: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>',
  close: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>'
});

export const AUDIO_FORMATS = Object.freeze(['mp3', 'ogg', 'm4a']);

export const REPEAT_MODES = Object.freeze({
  OFF: 'off',
  ALL: 'all',
  ONE: 'one'
});

export const NOTIFICATION_TYPES = Object.freeze({
  INFO: 'info',
  SUCCESS: 'success',
  WARNING: 'warning',
  ERROR: 'error'
});

// Enhanced helper functions
export const getElement = (id) => {
  const element = document.getElementById(id);
  if (!element) {
    console.warn(`Element with ID '${id}' not found`);
  }
  return element;
};

export const getElements = (selector) => {
  return document.querySelectorAll(selector);
};

export const getElementInContext = (contextSelector, elementSelector) => {
  const context = document.querySelector(contextSelector);
  return context ? context.querySelector(elementSelector) : null;
};

// Create and export the $ function
export const $ = new Proxy({}, {
  get(_, key) {
    const id = IDS[key];
    return () => (id ? document.getElementById(id) : null);
  }
});

export function $byId(id) {
  return document.getElementById(id);
}

export function $bySelector(selector) {
  return document.querySelector(selector);
}

export function $allBySelector(selector) {
  return document.querySelectorAll(selector);
}

// Context-specific helper for close buttons and other reusable components
export function $inContext(contextId, elementClass) {
  const context = document.getElementById(contextId);
  return context ? context.querySelector(`.${elementClass}`) : null;
}

// Usage examples:
// $inContext('musicPlayer', 'close') // Gets the close button in music player
// $inContext('searchDialog', 'close') // Gets the close button in search dialog

// Also attach to window for global access if needed
window.IDS = IDS;
window.CLASSES = CLASSES;
window.SELECTORS = SELECTORS;
window.ROUTES = ROUTES;
window.THEMES = THEMES;
window.STORAGE_KEYS = STORAGE_KEYS;
window.ICONS = ICONS;
window.AUDIO_FORMATS = AUDIO_FORMATS;
window.REPEAT_MODES = REPEAT_MODES;
window.NOTIFICATION_TYPES = NOTIFICATION_TYPES;
window.$ = $;
window.$byId = $byId;
window.$bySelector = $bySelector;
window.$allBySelector = $allBySelector;
window.$inContext = $inContext;
window.getElement = getElement;
window.getElements = getElements;
window.getElementInContext = getElementInContext;
</script>


<!--------- newScript.js ----------------------->
<script type="module">
import {
  IDS,
  CLASSES,
  ROUTES,
  THEMES,
  STORAGE_KEYS,
  ICONS,
  AUDIO_FORMATS,
  REPEAT_MODES,
  NOTIFICATION_TYPES,
  $,
  $byId
} from "./siteMap.js";
import {
  music
} from "./modules/library.js";
import {
  render,
  create
} from "./pageModules/blocks.js";

// Core application state management - contains all player and UI state
class AppState {
  constructor() {
    // HTML5 Audio instance for playback
    this.audio = null;

    // Current song metadata - CRITICAL for album cover and song info updates
    this.currentSong = null;
    this.currentArtist = null;
    this.currentAlbum = null;

    // Playback state management - drives play/pause button updates
    this.isPlaying = false;
    this.duration = 0;

    // Music queue and playback history
    this.queue = [];
    this.recentlyPlayed = [];
    this.isDragging = false;

    // Player control modes
    this.shuffleMode = false;
    this.repeatMode = REPEAT_MODES.OFF;

    // UI progress tracking
    this.seekTooltip = null;
    this.currentIndex = 0;

    // User data collections
    this.playlists = [];

    // UI state tracking
    this.isPopupVisible = false;
    this.currentTab = "now-playing";
    this.inactivityTimer = null;

    // Notification system state
    this.notificationContainer = null;
    this.notifications = [];
    this.currentNotificationTimeout = null;

    // Core application instances
    this.siteMapInstance = null;
    this.homePageManagerInstance = null;
  }

  // Comprehensive favorites management system - handles songs, artists, albums
  favorites = {
    songs: new Set(),
    artists: new Set(),
    albums: new Set(),

    // Add item to favorites with UI feedback
    add: (type, id) => {
      this.favorites[type].add(id);
      this.favorites.save(type);
      this.favorites.updateIcon(type, id, true);
      const itemName = type === "songs" ? "song" : type.slice(0, -1);
      notifications.show(`Added ${itemName} to favorites`, NOTIFICATION_TYPES.SUCCESS);
    },

    // Remove item from favorites with UI feedback
    remove: (type, id) => {
      this.favorites[type].delete(id);
      this.favorites.save(type);
      this.favorites.updateIcon(type, id, false);
      const itemName = type === "songs" ? "song" : type.slice(0, -1);
      notifications.show(`Removed ${itemName} from favorites`, NOTIFICATION_TYPES.INFO);
    },

    // Toggle favorite status - returns new state
    toggle: (type, id) => {
      if (this.favorites[type].has(id)) {
        this.favorites.remove(type, id);
        return false;
      } else {
        this.favorites.add(type, id);
        return true;
      }
    },

    // Check if item is in favorites
    has: (type, id) => this.favorites[type].has(id),

    // Persist favorites to localStorage
    save: (type) => {
      const key = type === "songs" ? STORAGE_KEYS.FAVORITE_SONGS : type === "artists" ? STORAGE_KEYS.FAVORITE_ARTISTS : STORAGE_KEYS.FAVORITE_ALBUMS;
      storage.save(key, Array.from(this.favorites[type]));
    },

    // Update all favorite heart icons across the interface
    updateIcon: (type, id, isFavorite) => {
      const icons = document.querySelectorAll(`[data-favorite-${type}="${id}"]`);
      icons.forEach((icon) => {
        icon.classList.toggle(CLASSES.active, isFavorite);
        icon.setAttribute("aria-pressed", isFavorite);

        // Update heart icon visual styling for songs
        if (type === "songs") {
          const heartIcon = icon.querySelector("svg");
          if (heartIcon) {
            heartIcon.style.color = isFavorite ? "#ef4444" : "";
            heartIcon.style.fill = isFavorite ? "currentColor" : "none";
          }
        }
      });

      // Update current song favorite button in popup
      if (type === "songs" && appState.currentSong && appState.currentSong.id === id) {
        ui.updateFavoriteButton();
      }
    },
  };

  // Advanced queue management system
  queue = {
    items: [],

    // Add song to queue at specific position or end
    add: (song, position = null) => {
      if (position !== null) {
        this.queue.items.splice(position, 0, song);
      } else {
        this.queue.items.push(song);
      }
      storage.save(STORAGE_KEYS.QUEUE, this.queue.items);
      ui.updateCounts();
      notifications.show(`Added "${song.title}" to queue`);
    },

    // Remove song from queue by index
    remove: (index) => {
      if (index >= 0 && index < this.queue.items.length) {
        const removed = this.queue.items.splice(index, 1)[0];
        storage.save(STORAGE_KEYS.QUEUE, this.queue.items);
        ui.updateCounts();
        return removed;
      }
      return null;
    },

    // Clear entire queue
    clear: () => {
      this.queue.items = [];
      storage.save(STORAGE_KEYS.QUEUE, this.queue.items);
      ui.updateCounts();
    },

    // Get next song from queue
    getNext: () => {
      return this.queue.items.length > 0 ? this.queue.remove(0) : null;
    },

    // Get all queue items
    get: () => this.queue.items,

    // Play song at specific queue position
    playAt: (index) => {
      const song = this.queue.remove(index);
      if (song) {
        player.playSong(song);
      }
    },
  };
}

// Global application state instance
const appState = new AppState();

// Local storage management with error handling
const storage = {
  // Save data to localStorage with JSON serialization
  save: (key, data) => {
    try {
      localStorage.setItem(key, JSON.stringify(data));
      return true;
    } catch (error) {
      console.error(`Error saving to localStorage (${key}):`, error);
      return false;
    }
  },

  // Load data from localStorage with JSON parsing
  load: (key) => {
    try {
      const data = localStorage.getItem(key);
      return data ? JSON.parse(data) : null;
    } catch (error) {
      console.error(`Error loading from localStorage (${key}):`, error);
      return null;
    }
  },

  // Initialize all stored user data on app startup
  initialize: () => {
    // Load favorites for all types (songs, artists, albums)
    const favoriteTypes = [{
        type: "songs",
        key: STORAGE_KEYS.FAVORITE_SONGS
      },
      {
        type: "artists",
        key: STORAGE_KEYS.FAVORITE_ARTISTS
      },
      {
        type: "albums",
        key: STORAGE_KEYS.FAVORITE_ALBUMS
      },
    ];

    favoriteTypes.forEach(({
      type,
      key
    }) => {
      const data = storage.load(key);
      if (data) {
        appState.favorites[type] = new Set(data);
      }
    });

    // Load other persistent data
    const dataLoaders = {
      [STORAGE_KEYS.RECENTLY_PLAYED]: (data) => (appState.recentlyPlayed = data || []),
      [STORAGE_KEYS.PLAYLISTS]: (data) => (appState.playlists = data || []),
      [STORAGE_KEYS.QUEUE]: (data) => (appState.queue.items = data || []),
    };

    Object.entries(dataLoaders).forEach(([key, loader]) => {
      const data = storage.load(key);
      if (data) loader(data);
    });
  },
};

// Media Session API integration for system-level media controls
const mediaSession = {
  // Initialize media session with action handlers
  setup: () => {
    if (!("mediaSession" in navigator)) return;

    navigator.mediaSession.metadata = null;

    // Define all supported media session actions
    const actions = {
      play: () => controls.play(),
      pause: () => controls.pause(),
      previoustrack: () => controls.previous(),
      nexttrack: () => controls.next(),
      seekto: (details) => controls.seekTo(details.seekTime),
      seekbackward: (details) => controls.skip(-(details.seekOffset || 10)),
      seekforward: (details) => controls.skip(details.seekOffset || 10),
    };

    // Register each action handler
    Object.entries(actions).forEach(([action, handler]) => {
      try {
        navigator.mediaSession.setActionHandler(action, handler);
      } catch (error) {
        console.warn(`MediaSession action ${action} not supported:`, error);
      }
    });
  },

  // Update system media session with current song metadata
  updateMetadata: (songData) => {
    if (!("mediaSession" in navigator) || !songData) return;

    try {
      navigator.mediaSession.metadata = new MediaMetadata({
        title: songData.title || "Unknown Song",
        artist: songData.artist || "Unknown Artist",
        album: songData.album || "Unknown Album",
        artwork: [{
          src: songData.artwork || utils.getAlbumImageUrl(songData.album),
          sizes: "512x512",
          type: "image/jpeg",
        }, ],
      });
    } catch (error) {
      console.error("Failed to update MediaSession metadata:", error);
    }
  },

  // Update system playback state indicator
  updatePlaybackState: (playing) => {
    if (!("mediaSession" in navigator)) return;

    navigator.mediaSession.playbackState = playing ? "playing" : "paused";

    try {
      if (appState.audio && appState.duration > 0) {
        navigator.mediaSession.setPositionState({
          duration: appState.duration,
          playbackRate: 1.0,
          position: appState.audio.currentTime || 0,
        });
      }
    } catch (error) {
      console.warn("Failed to update position state:", error);
    }
  },
};

// Core audio player functionality - handles all playback operations
const player = {
  // Initialize HTML5 audio element with event listeners
  initialize: () => {
    if (appState.audio) return;

    // Create new Audio instance
    appState.audio = new Audio();

    // Bind all audio event handlers
    const events = {
      timeupdate: player.updateProgress,
      ended: player.onEnded,
      loadedmetadata: player.onMetadataLoaded,
      play: player.onPlay,
      pause: player.onPause,
      error: player.onError,
    };

    Object.entries(events).forEach(([event, handler]) => {
      appState.audio.addEventListener(event, handler);
    });

    // Set up system media controls
    mediaSession.setup();
  },

  // Load and attempt playback of audio file with format fallbacks
  loadAudioFile: async (songData) => {
    for (const format of AUDIO_FORMATS) {
      try {
        // Generate normalized filename for audio URL
        const songFileName = songData.title.toLowerCase().replace(/\s+/g, "").replace(/[^\w]/g, "");
        const audioUrl = `https://koders.cloud/global/content/audio/${songFileName}.${format}`;

        appState.audio.src = audioUrl;

        // Wait for audio to be ready for playback
        await new Promise((resolve, reject) => {
          const loadHandler = () => {
            appState.audio.removeEventListener("canplaythrough", loadHandler);
            appState.audio.removeEventListener("error", errorHandler);
            resolve();
          };

          const errorHandler = (e) => {
            appState.audio.removeEventListener("canplaythrough", loadHandler);
            appState.audio.removeEventListener("error", errorHandler);
            reject(e);
          };

          appState.audio.addEventListener("canplaythrough", loadHandler, {
            once: true
          });
          appState.audio.addEventListener("error", errorHandler, {
            once: true
          });

          if (appState.audio.readyState >= 3) {
            loadHandler();
          }
        });

        // Start playback
        await appState.audio.play();
        return true;
      } catch (error) {
        console.error(`Audio playback failed (${format}):`, error);
      }
    }
    return false;
  },

  // Main function to play a new song - CRITICAL FOR FIXING ALBUM COVER AND SONG INFO UPDATES
  playSong: async (songData) => {
    if (!songData) return;

    // Initialize audio if not already done
    player.initialize();
    ui.setLoadingState(true);

    // Add current song to recently played history
    if (appState.currentSong) {
      player.addToRecentlyPlayed(appState.currentSong);
    }

    // Update current song state - CRITICAL for UI updates
    appState.currentSong = songData;
    appState.currentArtist = songData.artist;
    appState.currentAlbum = songData.album;

    // IMMEDIATE UI UPDATES - fixes album cover and song info display issues
    ui.updateNowPlaying(); // Updates popup song info
    ui.updateNavbar(); // Updates navbar song info and album cover
    ui.updateMusicPlayer(); // Updates music player card
    ui.updateCounts(); // Updates counters
    mediaSession.updateMetadata(songData); // Updates system media session

    // Load and play the audio file
    const success = await player.loadAudioFile(songData);

    if (success) {
      // Re-bind control events after song change to ensure functionality
      setTimeout(() => {
        eventHandlers.bindControlEvents();
      }, 100);
    } else {
      // Show error but keep UI updated
      notifications.show("Could not load audio file", NOTIFICATION_TYPES.ERROR);
      appState.isPlaying = false;
      ui.updatePlayPauseButtons();
      mediaSession.updatePlaybackState(false);
    }

    ui.setLoadingState(false);
  },

  // Toggle play/pause state - main control for play/pause buttons
  toggle: () => {
    if (appState.isPlaying) {
      controls.pause();
    } else {
      controls.play();
    }
  },
  // Audio event handler - when playback starts
  onPlay: () => {
    appState.isPlaying = true;
    ui.updatePlayPauseButtons(); // CRITICAL - updates all play/pause buttons
    mediaSession.updatePlaybackState(true);
  },

  // Audio event handler - when playback pauses
  onPause: () => {
    appState.isPlaying = false;
    ui.updatePlayPauseButtons(); // CRITICAL - updates all play/pause buttons
    mediaSession.updatePlaybackState(false);
  },

  // Audio event handler - when metadata loads
  onMetadataLoaded: () => {
    appState.duration = appState.audio.duration;
    const totalTimeElement = $byId(IDS.popupTotalTime);
    if (totalTimeElement) {
      totalTimeElement.textContent = utils.formatTime(appState.duration);
    }
  },

  // Audio event handler - when error occurs
  onError: (error) => {
    console.error("Audio error:", error);
    notifications.show("Audio playback error", NOTIFICATION_TYPES.ERROR);
  },

  // Audio event handler - when song ends
  onEnded: () => {
    if (appState.repeatMode === REPEAT_MODES.ONE) {
      appState.audio.currentTime = 0;
      appState.audio.play();
      return;
    }
    controls.next();
  },

  // Update progress bar and time displays during playback
  updateProgress: () => {
    if (!appState.audio) return;

    const currentTime = appState.audio.currentTime;
    const percent = appState.duration > 0 ? (currentTime / appState.duration) * 100 : 0;

    // Update progress bar elements
    const progressFill = $byId(IDS.popupProgressFill);
    const progressThumb = $byId(IDS.popupProgressThumb);
    const currentTimeElement = $byId(IDS.popupCurrentTime);

    if (progressFill) progressFill.style.width = `${percent}%`;
    if (progressThumb) progressThumb.style.left = `${percent}%`;
    if (currentTimeElement) currentTimeElement.textContent = utils.formatTime(currentTime);

    mediaSession.updatePlaybackState(appState.isPlaying);
  },

  // Add song to recently played history
  addToRecentlyPlayed: (song) => {
    appState.recentlyPlayed.unshift(song);
    if (appState.recentlyPlayed.length > 50) {
      appState.recentlyPlayed = appState.recentlyPlayed.slice(0, 50);
    }
    storage.save(STORAGE_KEYS.RECENTLY_PLAYED, appState.recentlyPlayed.slice(0, 20));
  },

  // Get next song in current album for sequential playback
  getNextInAlbum: () => {
    if (!appState.currentSong || !window.music) return null;

    const artist = window.music.find((a) => a.artist === appState.currentArtist);
    const album = artist?.albums.find((al) => al.album === appState.currentAlbum);

    if (!album) return null;

    const currentIndex = album.songs.findIndex((s) => s.title === appState.currentSong.title);
    const nextIndex = appState.shuffleMode ? Math.floor(Math.random() * album.songs.length) : (currentIndex + 1) % album.songs.length;

    if (nextIndex !== currentIndex || appState.repeatMode === REPEAT_MODES.ALL) {
      return {
        ...album.songs[nextIndex],
        artist: artist.artist,
        album: album.album,
        cover: utils.getAlbumImageUrl(album.album),
      };
    }

    return null;
  },

  // Get previous song in current album
  getPreviousInAlbum: () => {
    if (!appState.currentSong || !window.music) return null;

    const artist = window.music.find((a) => a.artist === appState.currentArtist);
    const album = artist?.albums.find((al) => al.album === appState.currentAlbum);

    if (!album) return null;

    const currentIndex = album.songs.findIndex((s) => s.title === appState.currentSong.title);
    const prevIndex = (currentIndex - 1 + album.songs.length) % album.songs.length;

    return {
      ...album.songs[prevIndex],
      artist: artist.artist,
      album: album.album,
      cover: utils.getAlbumImageUrl(album.album),
    };
  },
};


const controls = {
  play: () => {
    if (!appState.currentSong || !appState.audio) return;
    appState.audio.play().catch((err) => console.error("Play error:", err));
  },
  pause: () => {
    if (!appState.audio) return;
    appState.audio.pause();
  },
  next: () => {
    const nextSong = appState.queue.getNext();
    if (nextSong) {
      player.playSong(nextSong);
      return;
    }

    // Play next song from current album
    const nextInAlbum = player.getNextInAlbum();
    if (nextInAlbum) {
      player.playSong(nextInAlbum);
    }
  },
  previous: () => {
    if (appState.audio && appState.audio.currentTime > 3) {
      appState.audio.currentTime = 0;
      return;
    }

    if (appState.recentlyPlayed.length > 0) {
      const prevSong = appState.recentlyPlayed.shift();
      player.playSong(prevSong);
      return;
    }

    const prevInAlbum = player.getPreviousInAlbum();
    if (prevInAlbum) {
      player.playSong(prevInAlbum);
    }
  },
  seekTo: (time) => {
    if (!appState.audio) return;
    appState.audio.currentTime = Math.max(0, Math.min(appState.duration, time));
    player.updateProgress();
  },
  skip: (seconds) => {
    if (!appState.audio) return;
    const newTime = appState.audio.currentTime + seconds;
    controls.seekTo(newTime);
  },

  shuffle: {
    // Toggle shuffle mode on/off
    toggle: () => {
      appState.shuffleMode = !appState.shuffleMode;
      ui.updateShuffleButton();
      notifications.show(`Shuffle ${appState.shuffleMode ? "enabled" : "disabled"}`);
    },

    // Shuffle all songs in library and start playback
    all: () => {
      if (!window.music || window.music.length === 0) {
        notifications.show("No music library found", NOTIFICATION_TYPES.WARNING);
        return;
      }

      // Collect all songs from all artists/albums
      const allSongs = [];
      window.music.forEach((artist) => {
        artist.albums.forEach((album) => {
          album.songs.forEach((song) => {
            allSongs.push({
              ...song,
              artist: artist.artist,
              album: album.album,
              cover: utils.getAlbumImageUrl(album.album),
            });
          });
        });
      });

      if (allSongs.length === 0) {
        notifications.show("No songs found", NOTIFICATION_TYPES.WARNING);
        return;
      }

      // Shuffle the array using Fisher-Yates algorithm
      for (let i = allSongs.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [allSongs[i], allSongs[j]] = [allSongs[j], allSongs[i]];
      }

      // Set up queue and start playback
      appState.queue.clear();
      allSongs.slice(1).forEach((song) => appState.queue.add(song));
      player.playSong(allSongs[0]);
      appState.shuffleMode = true;
      ui.updateShuffleButton();
      notifications.show("Playing all songs shuffled");
    },
  },

  repeat: {
    // Cycle through repeat modes: off -> all -> one -> off
    toggle: () => {
      if (appState.repeatMode === REPEAT_MODES.OFF) {
        appState.repeatMode = REPEAT_MODES.ALL;
      } else if (appState.repeatMode === REPEAT_MODES.ALL) {
        appState.repeatMode = REPEAT_MODES.ONE;
      } else {
        appState.repeatMode = REPEAT_MODES.OFF;
      }

      ui.updateRepeatButton();

      const modeText = appState.repeatMode === REPEAT_MODES.OFF ? "disabled" : appState.repeatMode === REPEAT_MODES.ALL ? "all songs" : "current song";
      notifications.show(`Repeat ${modeText}`);
    },
  },
};

// UI update management - CRITICAL for fixing all display issues
const ui = {
  // Set loading state for UI elements
  setLoadingState: (loading) => {
    const nowPlayingArea = $byId(IDS.nowPlayingArea);
    const songTitle = $byId(NAVBAR.songName);

    if (nowPlayingArea) nowPlayingArea.style.opacity = loading ? "0.5" : "1";
    if (songTitle) songTitle.textContent = loading ? "Loading..." : appState.currentSong?.title || "";
  },

  // Update now playing popup with current song info - FIXES SONG INFO DISPLAY
  updateNowPlaying: () => {
    if (!appState.currentSong) return;

    // Get all popup elements
    const elements = {
      albumCover: $byId(IDS.popupAlbumCover),
      songTitle: $byId(IDS.popupSongTitle),
      artistName: $byId(IDS.popupArtistName),
      albumName: $byId(IDS.popupAlbumName),
    };

    // Update album cover with fallback - FIXES ALBUM COVER UPDATE ISSUE
    if (elements.albumCover) {
      utils.loadImageWithFallback(elements.albumCover, utils.getAlbumImageUrl(appState.currentSong.album), utils.getDefaultAlbumImage(), "album");
    }

    // Update song information text - FIXES SONG INFO DISPLAY
    if (elements.songTitle) elements.songTitle.textContent = appState.currentSong.title;
    if (elements.artistName) elements.artistName.textContent = appState.currentSong.artist;
    if (elements.albumName) elements.albumName.textContent = appState.currentSong.album;

    // Update control button states
    ui.updatePlayPauseButtons();
    ui.updateFavoriteButton();
  },

  updateNavbar: () => {
    if (!appState.currentSong) return;

    const container = $byId(NAVBAR.albumArtwork);
    const artist = $byId(NAVBAR.artistName);
    const songTitle = $byId(NAVBAR.songName);
    const playIndicator = $byId(IDS.playIndicator);
    const nowPlayingArea = $byId(IDS.nowPlayingArea);

    if (container) {
      const svg = container.querySelector("svg");
      const img = container.querySelector("img");

      if (img) {
        const albumUrl = utils.getAlbumImageUrl(appState.currentSong.album);
        utils.loadImageWithFallback(img, albumUrl, utils.getDefaultAlbumImage(), "album");
        img.classList.remove("opacity-0");
        img.classList.add("opacity-100");
      }

      if (svg) {
        svg.classList.add(CLASSES.hidden);
      }
    }

    if (artist) artist.textContent = appState.currentSong.artist;

    if (songTitle) {
      const title = appState.currentSong.title;
      songTitle.classList.toggle(CLASSES.marquee, title.length > 25);
      songTitle.textContent = title;
    }

    if (playIndicator) {
      playIndicator.classList.toggle(CLASSES.active, appState.isPlaying);
    }

    if (nowPlayingArea) {
      nowPlayingArea.classList.add(CLASSES.hasSong);
    }
  },

  // Update all play/pause button states - FIXES PLAY/PAUSE BUTTON ISSUES
  updatePlayPauseButtons: () => {
    // Update navbar play/pause icons
    const navbarElements = {
      playIcon: $byId(IDS.playIconNavbar),
      pauseIcon: $byId(IDS.pauseIconNavbar),
    };

    // Update popup play/pause icons
    const popupElements = {
      playIcon: $byId(IDS.popupPlayIcon),
      pauseIcon: $byId(IDS.popupPauseIcon),
    };

    // Toggle navbar icons based on playing state
    if (navbarElements.playIcon && navbarElements.pauseIcon) {
      navbarElements.playIcon.style.display = appState.isPlaying ? "none" : "block";
      navbarElements.pauseIcon.style.display = appState.isPlaying ? "block" : "none";
    }

    // Toggle popup icons based on playing state
    if (popupElements.playIcon && popupElements.pauseIcon) {
      popupElements.playIcon.classList.toggle(CLASSES.hidden, appState.isPlaying);
      popupElements.pauseIcon.classList.toggle(CLASSES.hidden, !appState.isPlaying);
    }
  },

  // Update shuffle button active state
  updateShuffleButton: () => {
    const shuffleBtn = $byId(IDS.popupShuffleBtn);
    if (shuffleBtn) {
      shuffleBtn.classList.toggle(CLASSES.active, appState.shuffleMode);
    }
  },

  // Update repeat button state and visual indicator
  updateRepeatButton: () => {
    const repeatBtn = $byId(IDS.popupRepeatBtn);
    if (repeatBtn) {
      repeatBtn.classList.toggle(CLASSES.active, appState.repeatMode !== REPEAT_MODES.OFF);
      repeatBtn.classList.toggle(CLASSES.repeatOne, appState.repeatMode === REPEAT_MODES.ONE);
    }
  },

  // Update favorite heart button state
  updateFavoriteButton: () => {
    if (!appState.currentSong) return;

    const favoriteBtn = $byId(IDS.popupFavoriteBtn);
    if (favoriteBtn) {
      const isFavorite = appState.favorites.has("songs", appState.currentSong.id);
      favoriteBtn.classList.toggle(CLASSES.active, isFavorite);
      favoriteBtn.setAttribute("data-favorite-songs", appState.currentSong.id);

      // Update heart icon color
      const heartIcon = favoriteBtn.querySelector("svg");
      if (heartIcon) {
        heartIcon.style.color = isFavorite ? "#ef4444" : "";
        heartIcon.style.fill = isFavorite ? "currentColor" : "none";
      }
    }
  },

  // Update various counters in the UI
  updateCounts: () => {
    const counts = {
      [IDS.favoriteSongsCount]: appState.favorites.songs.size,
      [IDS.favoriteArtistsCount]: appState.favorites.artists.size,
      [IDS.recentCount]: appState.recentlyPlayed.length,
      [IDS.queueCount]: appState.queue.items.length,
    };

    Object.entries(counts).forEach(([id, value]) => {
      const element = $byId(id);
      if (element) element.textContent = value;
    });
  },

  // Update music player card - FIXES MUSIC PLAYER CARD DISPLAY
  updateMusicPlayer: () => {
    ui.updateNowPlaying();
    ui.updateShuffleButton();
    ui.updateRepeatButton();
  },
};

// Music player popup controls
const popup = {
  // Open the main music player popup
  open: () => {
    const musicPlayer = $byId(IDS.musicPlayer);
    if (!musicPlayer) return;
    musicPlayer.classList.add(CLASSES.show);
    appState.isPopupVisible = true;
    popup.startInactivityTimer();
  },

  // Close the main music player popup
  close: () => {
    const musicPlayer = $byId(IDS.musicPlayer);
    if (!musicPlayer) return;
    musicPlayer.classList.remove(CLASSES.show);
    appState.isPopupVisible = false;
    popup.clearInactivityTimer();
  },

  // Toggle popup open/closed state
  toggle: () => {
    const musicPlayer = $byId(IDS.musicPlayer);
    if (!musicPlayer) return;
    if (musicPlayer.classList.contains(CLASSES.show)) {
      popup.close();
    } else {
      popup.open();
    }
  },

  // Switch between popup tabs (now-playing, queue, recent)
  switchTab: (tabName) => {
    appState.currentTab = tabName;
  },

  // Update queue tab content
  updateQueueTab: () => {
    const queueList = $byId(IDS.queueList);
    if (!queueList) return;
  },

  // Update recent tab content
  updateRecentTab: () => {
    const recentList = $byId(IDS.recentList);
    if (!recentList) return;
  },

  // Start inactivity timer for auto-tab switching
  startInactivityTimer: () => {
    popup.clearInactivityTimer();
    if (appState.currentTab !== "now-playing") {
      appState.inactivityTimer = setTimeout(() => {
        popup.switchTab("now-playing");
      }, 10000);
    }
  },

  // Clear inactivity timer
  clearInactivityTimer: () => {
    if (appState.inactivityTimer) {
      clearTimeout(appState.inactivityTimer);
      appState.inactivityTimer = null;
    }
  },
};

// Dropdown menu controls - handles main navigation menu
const dropdown = {
  // Toggle dropdown menu visibility - main menu trigger
  toggle: (e) => {
    e?.preventDefault();
    e?.stopPropagation();
    const menu = $byId(IDS.dropdownMenu);
    const trigger = $byId(IDS.menuTrigger);

    if (!menu || !trigger) return;

    const isVisible = menu.classList.contains(CLASSES.show);

    if (isVisible) {
      dropdown.close();
    } else {
      dropdown.open();
    }
  },

  // Open dropdown menu with counts update
  open: (e) => {
    e?.preventDefault();
    e?.stopPropagation();
    const menu = $byId(IDS.dropdownMenu);
    const trigger = $byId(IDS.menuTrigger);

    if (!menu || !trigger) return;

    ui.updateCounts();
    menu.classList.add(CLASSES.show);
    trigger.classList.add(CLASSES.active);
    popup.close();
  },

  // Close dropdown menu
  close: (e) => {
    e?.preventDefault();
    e?.stopPropagation();
    const menu = $byId(IDS.dropdownMenu);
    const trigger = $byId(IDS.menuTrigger);

    if (!menu || !trigger) return;

    menu.classList.remove(CLASSES.show);
    trigger.classList.remove(CLASSES.active);
  },
};

// Simple modal manager using the HTML dialog element
const modals = {
  open: (id, content) => {
    let dialog = document.getElementById(id);
    if (!dialog) {
      dialog = document.createElement("dialog");
      dialog.id = id;
      dialog.classList.add('modal', 'mainCard');
      document.body.appendChild(dialog);
    }

    dialog.innerHTML = `<button class="modal-close" data-close>&times;</button><div class="modal-content">${content}</div>`;
    dialog.querySelector("[data-close]").addEventListener(
      "click",
      () => modals.close(id), {
        once: true
      }
    );
    dialog.showModal();
  },

  close: (id) => {
    const dialog = document.getElementById(id);
    if (dialog) {
      dialog.close();
    }
  },
};

const uiDialog = {
  confirm(message, {
    okText = 'OK',
    cancelText = 'Cancel',
    danger = false
  } = {}) {
    return new Promise((resolve) => {
      const id = 'confirm-dialog';
      modals.open(id, `
        <div class="modal-popover">
          <div class="modal-popover-body">${message}</div>
          <div class="modal-popover-actions">
            <button class="btn btn-muted" data-cancel>${cancelText}</button>
            <button class="btn ${danger ? 'btn-danger' : 'btn-primary'}" data-ok>${okText}</button>
          </div>
        </div>
      `);
      const dlg = document.getElementById(id);
      dlg.classList.add('modal--popover', 'modal--sm', 'mainCard');
      dlg.querySelector('[data-cancel]').addEventListener('click', () => {
        dlg.close();
        resolve(false);
      }, {
        once: true
      });
      dlg.querySelector('[data-ok]').addEventListener('click', () => {
        dlg.close();
        resolve(true);
      }, {
        once: true
      });
    });
  },
  prompt(message, {
    okText = 'Create',
    cancelText = 'Cancel',
    placeholder = '',
    value = ''
  } = {}) {
    return new Promise((resolve) => {
      const id = 'prompt-dialog';
      modals.open(id, `
        <div class="modal-popover">
          <div class="modal-popover-header">${message}</div>
          <input class="modal-input" type="text" placeholder="${placeholder}" value="${value}">
          <div class="modal-popover-actions">
            <button class="btn btn-muted" data-cancel>${cancelText}</button>
            <button class="btn btn-primary" data-ok>${okText}</button>
          </div>
        </div>
      `);
      const dlg = document.getElementById(id);
      dlg.classList.add('modal--popover', 'modal--sm', 'mainCard');
      const input = dlg.querySelector('.modal-input');
      input.focus();
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          dlg.close();
          resolve(input.value.trim() || null);
        }
        if (e.key === 'Escape') {
          dlg.close();
          resolve(null);
        }
      }, {
        once: true
      });
      dlg.querySelector('[data-cancel]').addEventListener('click', () => {
        dlg.close();
        resolve(null);
      }, {
        once: true
      });
      dlg.querySelector('[data-ok]').addEventListener('click', () => {
        dlg.close();
        resolve(input.value.trim() || null);
      }, {
        once: true
      });
    });
  }
};

// Comprehensive playlist management system
const playlists = {
  // Add new playlist with validation
  add: (name) => {
    if (!name || !name.trim()) {
      notifications.show("Please enter a playlist name", NOTIFICATION_TYPES.WARNING);
      return null;
    }

    const playlist = {
      id: Date.now().toString(),
      name: name.trim(),
      songs: [],
      created: new Date().toISOString(),
      description: "",
      cover: null,
    };

    appState.playlists.push(playlist);
    storage.save(STORAGE_KEYS.PLAYLISTS, appState.playlists);

    notifications.show(`Created playlist "${playlist.name}"`, NOTIFICATION_TYPES.SUCCESS);
    return playlist;
  },

  // Add song to specific playlist
  addSong: (playlistId, song) => {
    const playlist = appState.playlists.find((p) => p.id === playlistId);
    if (!playlist) {
      notifications.show("Playlist not found", NOTIFICATION_TYPES.ERROR);
      return false;
    }

    const exists = playlist.songs.some((s) => s.id === song.id);
    if (exists) {
      notifications.show("Song already in playlist", NOTIFICATION_TYPES.WARNING);
      return false;
    }

    playlist.songs.push(song);
    storage.save(STORAGE_KEYS.PLAYLISTS, appState.playlists);

    notifications.show(`Added "${song.title}" to "${playlist.name}"`, NOTIFICATION_TYPES.SUCCESS);
    return true;
  },

  // Remove song from playlist
  removeSong: (playlistId, songId) => {
    const playlist = appState.playlists.find((p) => p.id === playlistId);
    if (!playlist) return false;

    const initialLength = playlist.songs.length;
    playlist.songs = playlist.songs.filter((s) => s.id !== songId);

    if (playlist.songs.length < initialLength) {
      storage.save(STORAGE_KEYS.PLAYLISTS, appState.playlists);
      notifications.show("Song removed from playlist", NOTIFICATION_TYPES.INFO);
      return true;
    }

    return false;
  },


  // Play entire playlist
  play: (playlistId) => {
    const playlist = appState.playlists.find((p) => p.id === playlistId);
    if (!playlist || playlist.songs.length === 0) {
      notifications.show("Playlist is empty", NOTIFICATION_TYPES.WARNING);
      return;
    }

    appState.queue.clear();
    playlist.songs.slice(1).forEach((song) => appState.queue.add(song));
    player.playSong(playlist.songs[0]);

    notifications.show(`Playing playlist "${playlist.name}"`, NOTIFICATION_TYPES.SUCCESS);
  },

  remove: async (playlistId) => {
    const playlist = appState.playlists.find((p) => p.id === playlistId);
    if (!playlist) return false;
    const confirmed = await uiDialog.confirm(`Delete the playlist "${playlist.name}"? This cannot be undone.`, {
      okText: 'Delete',
      danger: true
    });
    if (!confirmed) return false;
    const playlistName = playlist.name;
    appState.playlists = appState.playlists.filter((p) => p.id !== playlistId);
    storage.save(STORAGE_KEYS.PLAYLISTS, appState.playlists);
    notifications.show(`Deleted playlist "${playlistName}"`, NOTIFICATION_TYPES.INFO);
    return true;
  },

  create: async () => {
    const name = await uiDialog.prompt('Enter playlist name:', {
      okText: 'Create',
      placeholder: 'My playlist'
    });
    if (name) return playlists.add(name);
    return null;
  },


  // Show all playlists in a modal
  showAll: () => {
    if (appState.playlists.length === 0) {
      modals.open(
        "playlists-modal",
        views.renderEmptyState("No Playlists", "You haven't created any playlists yet.", "Create your first playlist to organize your music.")
      );
      return;
    }

    const content = `
        <div class="playlists-page animate__animated animate__fadeIn mainCard">
          <div class="page-header mb-8 flex justify-between items-center">
            <div>
              <h1 class="text-3xl font-bold mb-2">Your Playlists</h1>
              <p class="text-gray-400">${appState.playlists.length} playlist${appState.playlists.length !== 1 ? "s" : ""}</p>
            </div>
            <button class="create-playlist-btn bg-accent-primary text-white px-6 py-3 rounded-full hover:bg-accent-secondary transition-colors flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
              </svg>
              Create Playlist
            </button>
          </div>

          <div class="playlists-grid grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            ${appState.playlists
              .map(
                (playlist, index) => `
              <div class="playlist-card bg-gray-800 rounded-lg overflow-hidden hover:bg-gray-700 transition-colors cursor-pointer" style="animation-delay: ${index * 100}ms;" data-playlist-id="${playlist.id}">
                <div class="playlist-cover aspect-square bg-gradient-to-br from-purple-500 to-blue-600 relative">
                  <div class="absolute inset-0 bg-black/20 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" class="w-16 h-16">
                      <path d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v2H3v-2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"/>
                    </svg>
                  </div>
                  <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity">
                    <button class="play-playlist-btn w-10 h-10 bg-accent-primary rounded-full flex items-center justify-center hover:scale-110 transition-transform" data-playlist-id="${playlist.id}">
                      ${ICONS.play}
                    </button>
                  </div>
                </div>
                <div class="p-4">
                  <h3 class="font-bold text-lg mb-1 truncate">${playlist.name}</h3>
                  <p class="text-gray-400 text-sm mb-3">${playlist.songs.length} song${playlist.songs.length !== 1 ? "s" : ""}</p>
                  <div class="flex gap-2">
                    <button class="view-playlist-btn flex-1 bg-gray-600 text-white px-3 py-2 rounded hover:bg-gray-500 transition-colors text-sm" data-playlist-id="${playlist.id}">
                      View
                    </button>
                    <button class="delete-playlist-btn px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors" data-playlist-id="${playlist.id}">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4">
                        <path fill-rule="evenodd" d="M16.5 4.478v.227a48.816 48.816 0 013.878.512.75.75 0 11-.256 1.478l-.209-.035-1.005 13.07a3 3 0 01-2.991 2.77H8.084a3 3 0 01-2.991-2.77L4.087 6.66l-.209.035a.75.75 0 01-.256-1.478A48.567 48.567 0 017.5 4.705v-.227c0-1.564 1.213-2.9 2.816-2.951a52.662 52.662 0 013.369 0c1.603.051 2.815 1.387 2.815 2.951zm-6.136-1.452a51.196 51.196 0 013.273 0C14.39 3.05 15 3.684 15 4.478v.113a49.488 49.488 0 00-6 0v-.113c0-.794.609-1.428 1.364-1.452zm-.355 5.945a.75.75 0 10-1.5.058l.347 9a.75.75 0 101.499-.058l-.346-9zm5.48.058a.75.75 0 10-1.498-.058l-.347 9a.75.75 0 001.5.058l.345-9z" clip-rule="evenodd" />
                      </svg>
                    </button>
                  </div>
                </div>
              </div>
            `
              )
              .join("")}
          </div>
        </div>
      `;

    modals.open("playlists-modal", content);
    const modalEl = document.getElementById("playlists-modal");
    playlists.bindEvents(modalEl);
  },

  // Show individual playlist detail page
  show: (playlistId) => {
    const playlist = appState.playlists.find((p) => p.id === playlistId);
    if (!playlist) {
      notifications.show("Playlist not found", NOTIFICATION_TYPES.ERROR);
      return;
    }

    views.showLoading();

    setTimeout(() => {
      const dynamicContent = $byId(IDS.dynamicContent);
      if (!dynamicContent) return;

      dynamicContent.innerHTML = `
        <div class="playlist-page animate__animated animate__fadeIn">
          <div class="playlist-header mb-8 flex items-start gap-6">
            <div class="playlist-cover w-48 h-48 bg-gradient-to-br from-purple-500 to-blue-600 rounded-lg flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" class="w-24 h-24">
                <path d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v2H3v-2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"/>
              </svg>
            </div>
            <div class="playlist-info flex-1">
              <p class="text-sm text-gray-400 mb-2">PLAYLIST</p>
              <h1 class="text-4xl font-bold mb-4">${playlist.name}</h1>
              <p class="text-gray-400 mb-6">${playlist.songs.length} song${playlist.songs.length !== 1 ? "s" : ""} • Created ${new Date(playlist.created).toLocaleDateString()}</p>
              <div class="flex gap-4">
                <button class="play-playlist-btn bg-accent-primary text-white px-8 py-3 rounded-full hover:bg-accent-secondary transition-colors flex items-center gap-2" data-playlist-id="${playlist.id}" ${
        playlist.songs.length === 0 ? "disabled" : ""
      }>
                  ${ICONS.play}
                  Play
                </button>
                <button class="edit-playlist-btn bg-gray-600 text-white px-6 py-3 rounded-full hover:bg-gray-500 transition-colors" data-playlist-id="${playlist.id}">
                  Edit
                </button>
                <button class="delete-playlist-btn bg-red-600 text-white px-6 py-3 rounded-full hover:bg-red-700 transition-colors" data-playlist-id="${playlist.id}">
                  Delete
                </button>
              </div>
            </div>
          </div>
          
          ${
            playlist.songs.length === 0
              ? `
            <div class="empty-playlist text-center py-12">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-16 h-16 mx-auto mb-4 text-gray-600">
                <path d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v2H3v-2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"/>
              </svg>
              <h3 class="text-xl font-bold mb-2">This playlist is empty</h3>
              <p class="text-gray-400 mb-4">Add songs to start building your playlist</p>
              <button class="browse-music-btn bg-accent-primary text-white px-6 py-2 rounded-full hover:bg-accent-secondary transition-colors">
                Browse Music
              </button>
            </div>
          `
              : `
            <div class="songs-list">
              <div class="songs-header grid grid-cols-12 gap-4 px-4 py-2 text-sm text-gray-400 border-b border-gray-700 mb-2">
                <div class="col-span-1">#</div>
                <div class="col-span-5">Title</div>
                <div class="col-span-3 hidden md:block">Album</div>
                <div class="col-span-2 hidden md:block">Date Added</div>
                <div class="col-span-1">Duration</div>
              </div>
              ${playlist.songs
                .map(
                  (song, index) => `
                <div class="song-row grid grid-cols-12 gap-4 items-center px-4 py-3 rounded-lg hover:bg-white/5 transition-colors cursor-pointer group" data-song='${JSON.stringify(song).replace(/"/g, "&quot;")}' data-playlist-id="${
                    playlist.id
                  }" data-song-index="${index}">
                  <div class="col-span-1 text-gray-400 group-hover:hidden">${index + 1}</div>
                  <div class="col-span-1 hidden group-hover:block">
                    <button class="play-song-btn w-8 h-8 bg-accent-primary rounded-full flex items-center justify-center hover:scale-110 transition-transform">
                      ${ICONS.play}
                    </button>
                  </div>
                  <div class="col-span-5 flex items-center gap-3">
                    <img src="${utils.getAlbumImageUrl(song.album)}" alt="${song.title}" class="w-10 h-10 rounded object-cover">
                    <div>
                      <div class="font-medium">${song.title}</div>
                      <div class="text-sm text-gray-400 cursor-pointer hover:text-white transition-colors" data-artist="${song.artist}">${song.artist}</div>
                    </div>
                  </div>
                  <div class="col-span-3 hidden md:block text-gray-400 text-sm">${song.album}</div>
                  <div class="col-span-2 hidden md:block text-gray-400 text-sm">${new Date().toLocaleDateString()}</div>
                  <div class="col-span-1 flex items-center justify-between">
                    <span class="text-gray-400 text-sm">${song.duration || "0:00"}</span>
                    <div class="opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1">
                      <button class="action-btn p-1 hover:bg-white/10 rounded transition-colors" data-action="favorite" data-song-id="${song.id}" title="Add to favorites">
                        <svg class="w-4 h-4 ${appState.favorites.has("songs", song.id) ? "text-red-500" : ""}" fill="${appState.favorites.has("songs", song.id) ? "currentColor" : "none"}" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                      </button>
                      <button class="action-btn p-1 hover:bg-white/10 rounded transition-colors" data-action="add-queue" title="Add to queue">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                        </svg>
                      </button>
                      <button class="action-btn p-1 hover:bg-white/10 rounded transition-colors" data-action="remove-from-playlist" title="Remove from playlist">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>
              `
                )
                .join("")}
            </div>
          `
          }
        </div>
      `;

      playlists.bindViewEvents(playlist);
    }, 300);
  },

  // Bind events for playlist overview page
  bindEvents: (root = $byId(IDS.dynamicContent)) => {
    const dynamicContent = root;
    if (!dynamicContent) return;

    // Create playlist button
    const createBtn = dynamicContent.querySelector(".create-playlist-btn");
    if (createBtn) {
      createBtn.addEventListener("click", () => {
        const newPlaylist = playlists.create();
        if (newPlaylist) {
          setTimeout(() => playlists.showAll(), 100);
        }
      });
    }

    // View playlist buttons
    dynamicContent.querySelectorAll(".view-playlist-btn").forEach((btn) => {
      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        const playlistId = btn.dataset.playlistId;
        playlists.show(playlistId);
      });
    });

    // Play playlist buttons
    dynamicContent.querySelectorAll(".play-playlist-btn").forEach((btn) => {
      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        const playlistId = btn.dataset.playlistId;
        playlists.play(playlistId);
      });
    });

    // Delete playlist buttons
    dynamicContent.querySelectorAll(".delete-playlist-btn").forEach((btn) => {
      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        const playlistId = btn.dataset.playlistId;
        if (playlists.remove(playlistId)) {
          setTimeout(() => playlists.showAll(), 100);
        }
      });
    });

    // Playlist card clicks
    dynamicContent.querySelectorAll(".playlist-card").forEach((card) => {
      card.addEventListener("click", () => {
        const playlistId = card.dataset.playlistId;
        playlists.show(playlistId);
      });
    });
  },

  // Bind events for individual playlist view
  bindViewEvents: (playlist) => {
    const dynamicContent = $byId(IDS.dynamicContent);
    if (!dynamicContent) return;

    // Play playlist button
    const playBtn = dynamicContent.querySelector(".play-playlist-btn");
    if (playBtn) {
      playBtn.addEventListener("click", () => {
        playlists.play(playlist.id);
      });
    }

    // Edit playlist button
    const editBtn = dynamicContent.querySelector(".edit-playlist-btn");
    if (editBtn) {
      editBtn.addEventListener("click", () => {
        const newName = prompt("Enter new playlist name:", playlist.name);
        if (newName && newName.trim() && newName.trim() !== playlist.name) {
          playlist.name = newName.trim();
          storage.save(STORAGE_KEYS.PLAYLISTS, appState.playlists);
          playlists.show(playlist.id);
          notifications.show("Playlist renamed successfully", NOTIFICATION_TYPES.SUCCESS);
        }
      });
    }

    // Delete playlist button
    const deleteBtn = dynamicContent.querySelector(".delete-playlist-btn");
    if (deleteBtn) {
      deleteBtn.addEventListener("click", () => {
        if (playlists.remove(playlist.id)) {
          if (appState.siteMapInstance) {
            appState.siteMapInstance.navigateTo(ROUTES.HOME);
          }
        }
      });
    }

    // Browse music button (for empty playlists)
    const browseBtn = dynamicContent.querySelector(".browse-music-btn");
    if (browseBtn) {
      browseBtn.addEventListener("click", () => {
        if (appState.siteMapInstance) {
          appState.siteMapInstance.navigateTo(ROUTES.HOME);
        }
      });
    }

    // Song rows
    dynamicContent.querySelectorAll(".song-row").forEach((row) => {
      row.addEventListener("click", (e) => {
        if (e.target.closest(".action-btn") || e.target.closest(".play-song-btn")) return;

        try {
          const songData = JSON.parse(row.dataset.song);
          player.playSong(songData);
        } catch (error) {
          console.error("Error playing song:", error);
        }
      });
    });

    // Play song buttons
    dynamicContent.querySelectorAll(".play-song-btn").forEach((btn) => {
      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        const songRow = btn.closest(".song-row");
        try {
          const songData = JSON.parse(songRow.dataset.song);
          player.playSong(songData);
        } catch (error) {
          console.error("Error playing song:", error);
        }
      });
    });

    // Artist names
    dynamicContent.querySelectorAll("[data-artist]").forEach((artistEl) => {
      artistEl.addEventListener("click", (e) => {
        e.stopPropagation();
        const artistName = artistEl.dataset.artist;
        if (appState.siteMapInstance) {
          appState.siteMapInstance.navigateTo(ROUTES.ARTIST, {
            artist: artistName
          });
        }
      });
    });

    // Action buttons
    dynamicContent.querySelectorAll(".action-btn").forEach((btn) => {
      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        const action = btn.dataset.action;
        const songRow = btn.closest(".song-row");
        const songData = JSON.parse(songRow.dataset.song);

        switch (action) {
          case "favorite":
            appState.favorites.toggle("songs", songData.id);
            const heartIcon = btn.querySelector("svg");
            const isFavorite = appState.favorites.has("songs", songData.id);
            heartIcon.style.color = isFavorite ? "#ef4444" : "";
            heartIcon.style.fill = isFavorite ? "currentColor" : "none";
            break;
          case "add-queue":
            appState.queue.add(songData);
            break;
          case "remove-from-playlist":
            const playlistId = songRow.dataset.playlistId;
            const songIndex = parseInt(songRow.dataset.songIndex);
            if (playlists.removeSong(playlistId, songData.id)) {
              playlists.show(playlistId);
            }
            break;
        }
      });
    });
  },
};



// Theme management system
const theme = {
  // Toggle between dark/medium/light themes
  toggle: () => {
    const html = document.documentElement;

    if (html.classList.contains(CLASSES.light)) {
      html.classList.remove(CLASSES.light, CLASSES.medium);
      theme.updateIcon(THEMES.DARK);
      storage.save(STORAGE_KEYS.THEME_PREFERENCE, THEMES.DARK);
    } else if (html.classList.contains(CLASSES.medium)) {
      html.classList.remove(CLASSES.medium);
      html.classList.add(CLASSES.light);
      theme.updateIcon(THEMES.LIGHT);
      storage.save(STORAGE_KEYS.THEME_PREFERENCE, THEMES.LIGHT);
    } else {
      html.classList.add(CLASSES.medium);
      theme.updateIcon(THEMES.MEDIUM);
      storage.save(STORAGE_KEYS.THEME_PREFERENCE, THEMES.MEDIUM);
    }
  },

  // Update theme toggle icon based on current theme
  updateIcon: (currentTheme) => {
    const themeToggle = $byId(IDS.themeToggle);
    if (themeToggle) {
      themeToggle.innerHTML = ICONS[currentTheme];
    }
  },

  // Initialize theme from saved preference
  initialize: () => {
    const savedTheme = storage.load(STORAGE_KEYS.THEME_PREFERENCE);
    if (savedTheme) {
      const html = document.documentElement;
      html.classList.remove(CLASSES.light, CLASSES.medium);

      if (savedTheme === THEMES.LIGHT) {
        html.classList.add(CLASSES.light);
      } else if (savedTheme === THEMES.MEDIUM) {
        html.classList.add(CLASSES.medium);
      }

      theme.updateIcon(savedTheme);
    }
  },
};

// Comprehensive notification system
const notifications = {
  container: null,
  items: [],
  currentTimeout: null,

  // Initialize notification container
  initialize: () => {
    if (notifications.container) return;

    notifications.container = document.createElement("div");
    notifications.container.className = "fixed z-50 right-4 bottom-4 space-y-2 max-w-sm";
    document.body.appendChild(notifications.container);
  },

  // Show notification with auto-dismiss and optional undo functionality
  show: (message, type = NOTIFICATION_TYPES.INFO, undoCallback = null) => {
    notifications.initialize();

    const typeStyles = {
      [NOTIFICATION_TYPES.INFO]: "bg-blue-600 border-blue-500 text-white",
      [NOTIFICATION_TYPES.SUCCESS]: "bg-green-600 border-green-500 text-white",
      [NOTIFICATION_TYPES.WARNING]: "bg-yellow-600 border-yellow-500 text-white",
      [NOTIFICATION_TYPES.ERROR]: "bg-red-600 border-red-500 text-white",
    };

    const notification = document.createElement("div");
    notification.className = `relative border px-4 py-3 rounded-md shadow-lg flex items-center justify-between gap-3 ${typeStyles[type] || typeStyles[NOTIFICATION_TYPES.INFO]}`;

    const messageSpan = document.createElement("span");
    messageSpan.className = "flex-1 text-sm";
    messageSpan.textContent = message;
    notification.appendChild(messageSpan);

    const actions = document.createElement("div");
    actions.className = "flex items-center space-x-1";

    if (undoCallback) {
      const undoBtn = document.createElement("button");
      undoBtn.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path></svg>';
      undoBtn.className = "p-1 hover:bg-white/20 rounded";
      undoBtn.addEventListener("click", () => {
        undoCallback();
        notifications.remove(notification);
      });
      actions.appendChild(undoBtn);
    }

    const closeBtn = document.createElement("button");
    closeBtn.innerHTML = ICONS.close;
    closeBtn.className = "p-1 hover:bg-white/20 rounded w-4 h-4";
    closeBtn.addEventListener("click", () => notifications.remove(notification));
    actions.appendChild(closeBtn);

    notification.appendChild(actions);
    notifications.container.appendChild(notification);

    if (notifications.currentTimeout) clearTimeout(notifications.currentTimeout);
    notifications.currentTimeout = setTimeout(() => {
      notifications.remove(notification);
    }, 5000);

    return notification;
  },

  // Remove notification with animation
  remove: (element) => {
    element.style.transition = "all 0.3s ease";
    element.style.opacity = "0";
    element.style.transform = "translateY(-10px)";

    setTimeout(() => {
      if (element.parentNode) {
        element.parentNode.removeChild(element);
      }
    }, 300);
  },
};

// Utility functions for formatting, image handling, etc.
const utils = {
  // Format seconds to MM:SS time format
  formatTime: (seconds) => {
    if (isNaN(seconds) || seconds < 0) return "0:00";
    const minutes = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${minutes}:${secs.toString().padStart(2, "0")}`;
  },

  // Normalize text for URL/filename use
  normalizeForUrl: (text) => {
    return text
      .toString()
      .toLowerCase()
      .trim()
      .replace(/[^\w\s]/g, "")
      .replace(/\s+/g, "");
  },

  // Get album cover image URL with normalization
  getAlbumImageUrl: (albumName) => {
    if (!albumName) return utils.getDefaultAlbumImage();
    const normalized = utils.normalizeForUrl(albumName);
    return `https://koders.cloud/global/content/images/albumCovers/${normalized}.png`;
  },

  // Get artist portrait image URL
  getArtistImageUrl: (artistName) => {
    if (!artistName) return utils.getDefaultArtistImage();
    const normalized = utils.normalizeForUrl(artistName);
    return `https://koders.cloud/global/content/images/artistPortraits/${normalized}.png`;
  },

  // Get default album cover image
  getDefaultAlbumImage: () => {
    return "https://koders.cloud/global/content/images/albumCovers/default-album.png";
  },

  // Get default artist portrait image
  getDefaultArtistImage: () => {
    return "https://koders.cloud/global/content/images/artistPortraits/default-artist.png";
  },

  // Get total songs count for an artist
  getTotalSongs: (artist) => {
    return artist.albums.reduce((total, album) => total + album.songs.length, 0);
  },

  // Load image with fallback handling - CRITICAL for album cover updates
  loadImageWithFallback: (imgElement, primaryUrl, fallbackUrl, type = "image") => {
    if (!imgElement) return;

    imgElement.classList.add(CLASSES.imageLoading);

    const testImage = new Image();

    testImage.onload = () => {
      imgElement.src = primaryUrl;
      imgElement.classList.remove(CLASSES.imageLoading, CLASSES.imageError);
      imgElement.classList.add(CLASSES.imageLoaded);
    };

    testImage.onerror = () => {
      const fallbackImage = new Image();

      fallbackImage.onload = () => {
        imgElement.src = fallbackUrl;
        imgElement.classList.remove(CLASSES.imageLoading);
        imgElement.classList.add(CLASSES.imageLoaded);
      };

      fallbackImage.onerror = () => {
        imgElement.src = utils.generatePlaceholder(type);
        imgElement.classList.remove(CLASSES.imageLoading);
        imgElement.classList.add(CLASSES.imageFallback);
      };

      fallbackImage.src = fallbackUrl;
    };

    testImage.src = primaryUrl;
  },

  // Generate SVG placeholder for failed image loads
  generatePlaceholder: (type) => {
    const isArtist = type === "artist";
    const bgColor = isArtist ? "#4F46E5" : "#059669";
    const icon = isArtist ?
      '<path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>' :
      '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"/>';

    const svg = `<svg width="200" height="200" xmlns="http://www.w3.org/2000/svg">
      <rect width="200" height="200" fill="${bgColor}"/>
      <svg x="75" y="75" width="50" height="50" viewBox="0 0 24 24" fill="white">
        ${icon}
      </svg>
    </svg>`;

    return "data:image/svg+xml;base64," + btoa(svg);
  },
};

// Comprehensive event handling system - CRITICAL for fixing control issues
const eventHandlers = {
  // Initialize all event handlers
  init: () => {
    console.log("Initializing event handlers...");
    eventHandlers.bindMenus();
    eventHandlers.bindControls();
    eventHandlers.bindPopups();
    eventHandlers.bindProgress();
    eventHandlers.bindKeyboard();
    eventHandlers.bindDocument();
    console.log("Event handlers initialized");
  },

  bindControls: () => {
    console.log("Binding control events...");

    // Main control elements mapping
    const controlElements = {
      [IDS.playPauseNavbar]: player.toggle, // Play/pause button in navbar
      [IDS.prevBtnNavbar]: player.previous, // Previous track button in navbar
      [IDS.nextBtnNavbar]: player.next, // Next track button in navbar
      [IDS.nowPlayingArea]: popup.toggle, // Now playing area click to open popup
    };

    Object.entries(controlElements).forEach(([id, handler]) => {
      const element = $byId(id);
      console.log(`Binding ${id}:`, !!element);

      if (element) {
        // Remove existing listeners to prevent duplicates
        element.removeEventListener("click", handler);
        element.addEventListener("click", (e) => {
          console.log(`${id} clicked!`);
          e.stopPropagation();

          try {
            handler();
          } catch (error) {
            console.error(`Error in ${id} handler:`, error);
          }
        });

        console.log(`Successfully bound ${id}`);
      } else {
        console.warn(`Element not found: ${id}`);
      }
    });

    // Bind navbar album cover click to open popup - FIXES popup opening issue
    const albumArtwork = $byId(NAVBAR.albumArtwork);
    if (albumArtwork) {
      albumArtwork.removeEventListener("click", popup.toggle);
      albumArtwork.addEventListener("click", (e) => {
        console.log("Navbar album cover clicked!");
        e.stopPropagation();
        popup.toggle();
      });
      console.log("Navbar album cover event bound");
    }
  },

  bindMenus: () => {
    const menuElements = {
      [IDS.menuTrigger]: dropdown.toggle, // Main menu trigger (hamburger icon)
      [IDS.dropdownClose]: dropdown.close, // Close menu button
      [IDS.willHideMenu]: dropdown.close, // Alternative close trigger
    };

    Object.entries(menuElements).forEach(([id, handler]) => {
      const element = $byId(id);
      if (element) {
        element.removeEventListener("click", handler);
        element.addEventListener("click", handler);
      }
    });

    // Menu action items
    const menuActions = {
      [IDS.favoriteSongs]: () => { // Favorite songs menu item
        dropdown.close();
        views.showFavoriteSongs();
      },
      [IDS.favoriteArtists]: () => { // Favorite artists menu item
        dropdown.close();
        views.showFavoriteArtists();
      },
      [IDS.recentlyPlayed]: () => { // Recently played menu item
        dropdown.close();
        popup.open();
        setTimeout(() => popup.switchTab("recent"), 50);
      },
      [IDS.queueView]: () => { // Queue view menu item
        dropdown.close();
        popup.open();
        setTimeout(() => popup.switchTab("queue"), 50);
      },
      [IDS.createPlaylist]: () => { // Create playlist menu item
        dropdown.close();
        playlists.create();
      },
      [IDS.shuffleAll]: controls.shuffle.all, // Shuffle all songs menu item
      [IDS.themeToggle]: theme.toggle, // Theme toggle menu item
    };

    if (IDS.favoriteAlbums) {
      menuActions[IDS.favoriteAlbums] = () => {
        dropdown.close();
        views.showFavoriteAlbums();
      };
    }

    Object.entries(menuActions).forEach(([id, handler]) => {
      const element = $byId(id);
      if (element) {
        element.removeEventListener("click", handler);
        element.addEventListener("click", handler);
      }
    });
  },

  bindPopups: () => {
    const playerControls = {
      [MUSIC_PLAYER.close]: popup.close,
      [MUSIC_PLAYER.playPause]: controls.toggle,
      [MUSIC_PLAYER.previous]: controls.previous,
      [MUSIC_PLAYER.next]: controls.next,
      [MUSIC_PLAYER.shuffle]: controls.shuffle.toggle,
      [MUSIC_PLAYER.repeat]: controls.repeat.toggle,
      [MUSIC_PLAYER.favorite]: () => {
        if (appState.currentSong) {
          const isFavorite = appState.favorites.toggle("songs", appState.currentSong.id);
          ui.updateFavoriteButton();
        }
      },
    };

    Object.entries(playerControls).forEach(([id, handler]) => {
      const element = $byId(id);
      if (element) {
        element.removeEventListener("click", handler);
        element.addEventListener("click", handler);
      }
    });

    // Tab switching in popup (now-playing, queue, recent)
    document.querySelectorAll(".popup-tab").forEach((tab) => {
      tab.addEventListener("click", () => {
        popup.switchTab(tab.dataset.tab);
        popup.startInactivityTimer();
      });
    });
  },

  // Bind progress bar interaction events - seek functionality
  bindProgress: () => {
    const progressBar = $byId(IDS.popupProgressBar);
    if (!progressBar) return;

    // Click to seek on progress bar
    progressBar.addEventListener("click", (e) => {
      if (!appState.currentSong || !appState.audio) return;

      const rect = progressBar.getBoundingClientRect();
      const percent = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
      const newTime = percent * appState.duration;

      controls.seekTo(newTime);
    });

    // Drag functionality for progress bar
    let isDragging = false;

    const startDrag = (e) => {
      if (!appState.currentSong) return;
      isDragging = true;
      document.body.style.userSelect = "none";
      e.preventDefault();
    };

    const onDrag = (e) => {
      if (!isDragging || !appState.currentSong || !appState.audio) return;

      const rect = progressBar.getBoundingClientRect();
      const percent = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
      const newTime = percent * appState.duration;

      controls.seekTo(newTime);
    };

    const endDrag = () => {
      isDragging = false;
      document.body.style.userSelect = "";
    };

    progressBar.addEventListener("mousedown", startDrag);
    document.addEventListener("mousemove", onDrag);
    document.addEventListener("mouseup", endDrag);
  },

  // Bind keyboard shortcuts for media controls
  bindKeyboard: () => {
    document.addEventListener("keydown", (e) => {
      // Don't trigger shortcuts when typing in inputs
      if (e.target.tagName === "INPUT" || e.target.tagName === "TEXTAREA") return;

      const shortcuts = {
        " ": (e) => { // Spacebar for play/pause
          e.preventDefault();
          player.toggle();
        },
        ArrowLeft: (e) => { // Ctrl/Cmd + Left for previous
          if (e.ctrlKey || e.metaKey) {
            e.preventDefault();
            controls.previous();
          }
        },
        ArrowRight: (e) => { // Ctrl/Cmd + Right for next
          if (e.ctrlKey || e.metaKey) {
            e.preventDefault();
            controls.next();
          }
        },
        KeyN: (e) => { // Ctrl/Cmd + N for now playing
          if (e.ctrlKey || e.metaKey) {
            e.preventDefault();
            popup.open();
          }
        },
        KeyM: (e) => { // Ctrl/Cmd + M for menu
          if (e.ctrlKey || e.metaKey) {
            e.preventDefault();
            dropdown.toggle();
          }
        },
        KeyS: (e) => { // Ctrl/Cmd + S for shuffle
          if (e.ctrlKey || e.metaKey) {
            e.preventDefault();
            controls.shuffle.toggle();
          }
        },
        KeyR: (e) => { // Ctrl/Cmd + R for repeat
          if (e.ctrlKey || e.metaKey) {
            e.preventDefault();
            controls.repeat.toggle();
          }
        },
        Escape: () => { // Escape to close overlays
          popup.close();
          dropdown.close();
        },
      };

      const handler = shortcuts[e.code] || shortcuts[e.key];
      if (handler) {
        handler(e);
      }
    });
  },

  // Bind document-level click events for overlay management
  bindDocument: () => {
    document.addEventListener("click", (e) => {
      // Close dropdown when clicking outside
      const dropdownMenu = $byId(IDS.dropdownMenu);
      const menuTrigger = $byId(IDS.menuTrigger);
      if (dropdownMenu && !dropdownMenu.contains(e.target) && !menuTrigger?.contains(e.target)) {
        dropdown.close();
      }

      // Close popup when clicking outside
      const musicPlayer = $byId(IDS.musicPlayer);
      const nowPlayingArea = $byId(IDS.nowPlayingArea);
      if (appState.isPopupVisible && musicPlayer && !musicPlayer.contains(e.target) && !nowPlayingArea?.contains(e.target)) {
        popup.close();
      }

      // Handle navigation clicks
      const navItem = e.target.closest("[data-nav]");
      if (navItem) {
        e.preventDefault();
        const navType = navItem.dataset.nav;
        dropdown.close();

        if (appState.siteMapInstance) {
          const navHandlers = {
            [ROUTES.HOME]: () => appState.siteMapInstance.navigateTo(ROUTES.HOME),
            [ROUTES.ALL_ARTISTS]: () => appState.siteMapInstance.navigateTo(ROUTES.ALL_ARTISTS),
            [ROUTES.ARTIST]: () => {
              const artistName = navItem.dataset.artist;
              if (artistName) appState.siteMapInstance.navigateTo(ROUTES.ARTIST, {
                artist: artistName
              });
            },
            [ROUTES.ALBUM]: () => {
              const artist = navItem.dataset.artist;
              const album = navItem.dataset.album;
              if (artist && album) appState.siteMapInstance.navigateTo(ROUTES.ALBUM, {
                artist,
                album
              });
            },
          };

          if (navHandlers[navType]) navHandlers[navType]();
        }
      }

      // Handle search trigger
      if (e.target.closest("#" + IDS.globalSearchTrigger)) {
        e.preventDefault();
        dropdown.close();
        if (appState.siteMapInstance) appState.siteMapInstance.openSearchDialog();
      }
    });
  },
};

// Views management system - handles different page views
const views = {
  // Show favorite songs page
  showFavoriteSongs: () => {
    const favoriteSongIds = Array.from(appState.favorites.songs);
    if (favoriteSongIds.length === 0) {
      modals.open(
        "favorite-songs-modal",
        views.renderEmptyState("No Favorite Songs", "You haven't added any songs to your favorites yet.", "Browse your music and click the heart icon to add favorites.")
      );
      return;
    }
    const favoriteSongs = views.getSongsByIds(favoriteSongIds);
    const content = `
        <div class="favorites-page animate__animated animate__fadeIn">
          <div class="page-header mb-8">
            <h1 class="text-3xl font-bold mb-2">Favorite Songs</h1>
            <p class="text-gray-400">${favoriteSongs.length} song${favoriteSongs.length !== 1 ? "s" : ""}</p>
            <div class="flex gap-4 mt-4">
              <button class="play-all-btn bg-accent-primary text-white px-6 py-2 rounded-full hover:bg-accent-secondary transition-colors flex items-center gap-2">
                ${ICONS.play}
                Play All
              </button>
              <button class="shuffle-all-btn bg-gray-600 text-white px-6 py-2 rounded-full hover:bg-gray-500 transition-colors flex items-center gap-2">
                ${ICONS.shuffle}
                Shuffle
              </button>
            </div>
          </div>
          <div class="songs-list">
            ${favoriteSongs
              .map(
                (song, index) => `
              <div class="song-row flex items-center gap-4 p-3 rounded-lg hover:bg-white/5 transition-colors cursor-pointer" data-song='${JSON.stringify(song).replace(/"/g, "&quot;")}'>
                <div class="track-number text-gray-400 w-8 text-center">${index + 1}</div>
                <img src="${utils.getAlbumImageUrl(song.album)}" alt="${song.title}" class="w-12 h-12 rounded object-cover">
                <div class="song-info flex-1">
                  <div class="song-title font-medium">${song.title}</div>
                  <div class="song-artist text-gray-400 text-sm cursor-pointer hover:text-white transition-colors" data-artist="${song.artist}">${song.artist}</div>
                </div>
                <div class="album-name text-gray-400 text-sm hidden md:block">${song.album}</div>
                <div class="song-duration text-gray-400 text-sm">${song.duration || "0:00"}</div>
                <div class="song-actions flex items-center gap-2">
                  <button class="action-btn p-2 hover:bg-white/10 rounded transition-colors" data-action="favorite" data-song-id="${song.id}" title="Remove from favorites">
                    <svg class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 24 24"><path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
                  </button>
                  <button class="action-btn p-2 hover:bg-white/10 rounded transition-colors" data-action="add-queue" title="Add to queue">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
                  </button>
                  <button class="action-btn p-2 hover:bg-white/10 rounded transition-colors" data-action="add-playlist" title="Add to playlist">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
                  </button>
                </div>
              </div>
            `
              )
              .join("")}
          </div>
        </div>
      `;
    modals.open("favorite-songs-modal", content);
    const modalEl = document.getElementById("favorite-songs-modal");
    views.bindFavoriteSongsEvents(modalEl);
  },

  // Show favorite artists page
  showFavoriteArtists: () => {
    const favoriteArtistNames = Array.from(appState.favorites.artists);
    if (favoriteArtistNames.length === 0) {
      modals.open(
        "favorite-artists-modal",
        views.renderEmptyState("No Favorite Artists", "You haven't added any artists to your favorites yet.", "Browse artists and click the heart icon to add favorites.")
      );
      return;
    }
    const favoriteArtists = favoriteArtistNames
      .map((artistName) => window.music?.find((a) => a.artist === artistName))
      .filter(Boolean);

    const content = `
        <div class="favorites-page animate__animated animate__fadeIn">
          <div class="page-header mb-8">
            <h1 class="text-3xl font-bold mb-2">Favorite Artists</h1>
            <p class="text-gray-400">${favoriteArtists.length} artist${favoriteArtists.length !== 1 ? "s" : ""}</p>
          </div>

          <div class="artists-grid grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
            ${favoriteArtists
              .map(
                (artist, index) => `
              <div class="artist-card animate__animated animate__fadeIn cursor-pointer" style="animation-delay: ${index * 100}ms;" data-artist="${artist.artist}">
                <div class="relative group">
                  <img src="${utils.getArtistImageUrl(artist.artist)}" alt="${artist.artist}" class="w-full aspect-square rounded-full object-cover mb-4">
                  <div class="absolute inset-0 bg-black/40 rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                    <button class="play-artist-btn w-12 h-12 bg-accent-primary rounded-full flex items-center justify-center text-white hover:scale-110 transition-transform" data-artist="${artist.artist}">
                      ${ICONS.play}
                    </button>
                  </div>
                </div>
                <h3 class="font-medium text-center mb-1">${artist.artist}</h3>
                <p class="text-gray-400 text-sm text-center">${artist.albums.length} album${artist.albums.length !== 1 ? "s" : ""}</p>
                <div class="flex justify-center mt-2">
                  <button class="unfavorite-artist-btn text-red-500 hover:text-red-400 text-sm transition-colors" data-artist="${artist.artist}">Remove from Favorites</button>
                </div>
              </div>
            `
              )
              .join("")}
          </div>
        </div>
      `;
    modals.open("favorite-artists-modal", content);
    const modalEl = document.getElementById("favorite-artists-modal");
    views.bindFavoriteArtistsEvents(modalEl);
  },

  showFavoriteAlbums: () => {
    const favoriteAlbumIds = Array.from(appState.favorites.albums);
    if (favoriteAlbumIds.length === 0) {
      modals.open(
        "favorite-albums-modal",
        views.renderEmptyState("No Favorite Albums", "You haven't added any albums to your favorites yet.", "Browse albums and click the heart icon to add favorites.")
      );
      return;
    }
    const favoriteAlbums = views.getAlbumsByIds(favoriteAlbumIds);
    const content = `
        <div class="favorites-page animate__animated animate__fadeIn">
          <div class="page-header mb-8">
            <h1 class="text-3xl font-bold mb-2">Favorite Albums</h1>
            <p class="text-gray-400">${favoriteAlbums.length} album${favoriteAlbums.length !== 1 ? "s" : ""}</p>
          </div>
          <div class="albums-grid grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            ${favoriteAlbums
              .map(
                (album, index) => `
              <div class="album-card cursor-pointer" style="animation-delay: ${index * 100}ms;" data-album-id="${album.id}">
                <img src="${utils.getAlbumImageUrl(album.album)}" alt="${album.album}" class="w-full aspect-square object-cover rounded mb-4">
                <h3 class="font-medium text-center mb-1">${album.album}</h3>
                <p class="text-gray-400 text-sm text-center">${album.artist}</p>
                <div class="flex justify-center mt-2">
                  <button class="unfavorite-album-btn text-red-500 hover:text-red-400 text-sm transition-colors" data-album-id="${album.id}">Remove from Favorites</button>
                </div>
              </div>
            `
              )
              .join("")}
          </div>
        </div>
      `;
    modals.open("favorite-albums-modal", content);
    const modalEl = document.getElementById("favorite-albums-modal");
    views.bindFavoriteAlbumsEvents(modalEl);
  },

  // Bind events for favorite songs page
  bindFavoriteSongsEvents: (root = $byId(IDS.dynamicContent)) => {
    const dynamicContent = root;
    if (!dynamicContent) return;

    // Play all favorite songs button
    const playAllBtn = dynamicContent.querySelector(".play-all-btn");
    if (playAllBtn) {
      playAllBtn.addEventListener("click", () => {
        const favoriteSongs = views.getSongsByIds(Array.from(appState.favorites.songs));
        if (favoriteSongs.length > 0) {
          appState.queue.clear();
          favoriteSongs.slice(1).forEach((song) => appState.queue.add(song));
          player.playSong(favoriteSongs[0]);
        }
      });
    }

    // Shuffle all favorite songs button
    const shuffleAllBtn = dynamicContent.querySelector(".shuffle-all-btn");
    if (shuffleAllBtn) {
      shuffleAllBtn.addEventListener("click", () => {
        const favoriteSongs = views.getSongsByIds(Array.from(appState.favorites.songs));
        if (favoriteSongs.length > 0) {
          for (let i = favoriteSongs.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [favoriteSongs[i], favoriteSongs[j]] = [favoriteSongs[j], favoriteSongs[i]];
          }

          appState.queue.clear();
          favoriteSongs.slice(1).forEach((song) => appState.queue.add(song));
          player.playSong(favoriteSongs[0]);
          appState.shuffleMode = true;
          ui.updateShuffleButton();
        }
      });
    }

    // Song row click events
    dynamicContent.querySelectorAll(".song-row").forEach((row) => {
      row.addEventListener("click", (e) => {
        if (e.target.closest(".song-actions") || e.target.closest(".song-artist")) return;

        try {
          const songData = JSON.parse(row.dataset.song);
          player.playSong(songData);
        } catch (error) {
          console.error("Error playing song:", error);
        }
      });
    });

    // Artist name click events for navigation
    dynamicContent.querySelectorAll(".song-artist").forEach((artistEl) => {
      artistEl.addEventListener("click", (e) => {
        e.stopPropagation();
        const artistName = artistEl.dataset.artist;
        if (appState.siteMapInstance) {
          appState.siteMapInstance.navigateTo(ROUTES.ARTIST, {
            artist: artistName
          });
        }
      });
    });

    // Action button events (favorite, queue, playlist)
    dynamicContent.querySelectorAll(".action-btn").forEach((btn) => {
      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        const action = btn.dataset.action;
        const songRow = btn.closest(".song-row");
        const songData = JSON.parse(songRow.dataset.song);

        if (action === "favorite") {
          appState.favorites.remove("songs", songData.id);
          songRow.style.transition = "all 0.3s ease";
          songRow.style.opacity = "0";
          songRow.style.transform = "translateX(-20px)";
          setTimeout(() => {
            songRow.remove();
            const remainingSongs = dynamicContent.querySelectorAll(".song-row");
            if (remainingSongs.length === 0) {
              modals.close("favorite-songs-modal");
            }
          }, 300);
        } else if (action === "add-queue") {
          appState.queue.add(songData);
        } else if (action === "add-playlist") {
          siteMap.showPlaylistSelector(songData);
        }
      });
    });
  },

  // Bind events for favorite artists page
  bindFavoriteArtistsEvents: (root = $byId(IDS.dynamicContent)) => {
    const dynamicContent = root;
    if (!dynamicContent) return;

    // Artist card click events for navigation
    dynamicContent.querySelectorAll(".artist-card").forEach((card) => {
      card.addEventListener("click", (e) => {
        if (e.target.closest(".play-artist-btn") || e.target.closest(".unfavorite-artist-btn")) return;

        const artistName = card.dataset.artist;
        if (appState.siteMapInstance) {
          appState.siteMapInstance.navigateTo(ROUTES.ARTIST, {
            artist: artistName
          });
        }
      });
    });

    // Play artist buttons
    dynamicContent.querySelectorAll(".play-artist-btn").forEach((btn) => {
      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        const artistName = btn.dataset.artist;
        const artistData = window.music?.find((a) => a.artist === artistName);

        if (artistData) {
          const allSongs = [];
          artistData.albums.forEach((album) => {
            album.songs.forEach((song) => {
              allSongs.push({
                ...song,
                artist: artistData.artist,
                album: album.album,
                cover: utils.getAlbumImageUrl(album.album),
              });
            });
          });

          if (allSongs.length > 0) {
            appState.queue.clear();
            allSongs.slice(1).forEach((song) => appState.queue.add(song));
            player.playSong(allSongs[0]);
          }
        }
      });
    });

    // Unfavorite artist buttons
    dynamicContent.querySelectorAll(".unfavorite-artist-btn").forEach((btn) => {
      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        const artistName = btn.dataset.artist;

        appState.favorites.remove("artists", artistName);

        const artistCard = btn.closest(".artist-card");
        artistCard.style.transition = "all 0.3s ease";
        artistCard.style.opacity = "0";
        artistCard.style.transform = "scale(0.8)";
        setTimeout(() => {
          artistCard.remove();
          const remainingArtists = dynamicContent.querySelectorAll(".artist-card");
          if (remainingArtists.length === 0) {
            modals.close("favorite-artists-modal");
          }
        }, 300);
      });
    });
  },

  bindFavoriteAlbumsEvents: (root = $byId(IDS.dynamicContent)) => {
    const container = root;
    if (!container) return;

    container.querySelectorAll(".unfavorite-album-btn").forEach((btn) => {
      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        const albumId = btn.dataset.albumId;
        appState.favorites.remove("albums", albumId);
        const card = btn.closest(".album-card");
        card?.remove();
        if (!container.querySelector(".album-card")) {
          modals.close("favorite-albums-modal");
        }
      });
    });

    container.querySelectorAll(".album-card").forEach((card) => {
      card.addEventListener("click", () => {
        const albumId = card.dataset.albumId;
        const album = views.getAlbumsByIds([albumId])[0];
        if (album) {
          appState.queue.clear();
          album.songs.slice(1).forEach((song) =>
            appState.queue.add({
              ...song,
              artist: album.artist,
              album: album.album,
              cover: utils.getAlbumImageUrl(album.album)
            })
          );
          player.playSong({
            ...album.songs[0],
            artist: album.artist,
            album: album.album,
            cover: utils.getAlbumImageUrl(album.album)
          });
        }
      });
    });
  },

  // Get songs by their IDs from the music library
  getSongsByIds: (ids) => {
    if (!window.music || !ids.length) return [];

    const songs = [];

    window.music.forEach((artist) => {
      artist.albums.forEach((album) => {
        album.songs.forEach((song) => {
          if (ids.includes(song.id)) {
            songs.push({
              ...song,
              artist: artist.artist,
              album: album.album,
              cover: utils.getAlbumImageUrl(album.album),
            });
          }
        });
      });
    });

    return songs;
  },

  getAlbumsByIds: (ids) => {
    if (!window.music || !ids.length) return [];
    const albums = [];
    window.music.forEach((artist) => {
      artist.albums.forEach((album) => {
        const albumId = album.id || album.album;
        if (ids.includes(albumId)) {
          albums.push({
            ...album,
            id: albumId,
            artist: artist.artist,
            cover: utils.getAlbumImageUrl(album.album),
          });
        }
      });
    });
    return albums;
  },

  // Show loading spinner
  showLoading: () => {
    const dynamicContent = $byId(IDS.dynamicContent);
    if (!dynamicContent) return;

    dynamicContent.innerHTML = `
      <div class="loading-container flex items-center justify-center py-20">
        <div class="text-center">
          <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-accent-primary mx-auto mb-4"></div>
          <p class="text-gray-400">Loading...</p>
        </div>
      </div>
    `;
  },

  // Render empty state with call-to-action
  renderEmptyState: (title, subtitle, description) => {
    return `
      <div class="empty-state-container flex items-center justify-center py-20">
        <div class="text-center max-w-md">
          <div class="mb-6">
            <svg class="w-20 h-20 mx-auto text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
            </svg>
          </div>
          <h2 class="text-2xl font-bold mb-2">${title}</h2>
          <p class="text-gray-400 mb-4">${subtitle}</p>
          <p class="text-gray-500 text-sm">${description}</p>
          <button class="mt-6 bg-accent-primary text-white px-6 py-2 rounded-full hover:bg-accent-secondary transition-colors" onclick="app.goHome()">
            Browse Music
          </button>
        </div>
      </div>
    `;
  },
};

// Site navigation and routing system
const siteMap = {
  // Initialize navigation system
  initialize: () => {
    appState.siteMapInstance = {
      routes: {
        [ROUTES.HOME]: {
          pattern: /^\/$/,
          handler: siteMap.loadHomePage,
        },
        [ROUTES.ARTIST]: {
          pattern: /^\/artist\/(.+)$/,
          handler: (params) => {
            const artistName = params.artist || siteMap.getParameterByName("artist", window.location.href);
            const artistData = window.music?.find((a) => a.artist === artistName);
            if (artistData) {
              siteMap.loadArtistPage(artistData);
            } else {
              appState.siteMapInstance.navigateTo(ROUTES.HOME);
            }
          },
        },
        [ROUTES.ALL_ARTISTS]: {
          pattern: /^\/artists$/,
          handler: siteMap.loadAllArtistsPage,
        },
      },

      // Handle initial route on page load
      handleInitialRoute: function() {
        const path = window.location.pathname + window.location.search;
        this.handleRoute(path);
      },

      // Route handler
      handleRoute: function(path) {
        let matchedRoute = false;

        for (const key in this.routes) {
          const route = this.routes[key];
          const match = path.match(route.pattern);

          if (match) {
            const params = {};

            if (key === ROUTES.ARTIST) {
              params.artist = decodeURIComponent(match[1]);
            }

            route.handler(params);
            matchedRoute = true;
            break;
          }
        }

        if (!matchedRoute) {
          siteMap.loadHomePage();
        }
      },

      // Navigate to specific route
      navigateTo: function(routeName, params = {}) {
        let url;

        switch (routeName) {
          case ROUTES.HOME:
            url = "/";
            break;
          case ROUTES.ARTIST:
            url = `/artist/${encodeURIComponent(params.artist)}`;
            break;
          case ROUTES.ALL_ARTISTS:
            url = "/artists";
            break;
          default:
            url = "/";
        }

        window.history.pushState({}, "", url);

        if (this.routes[routeName]) {
          this.routes[routeName].handler(params);
        }

        siteMap.showLoading();
      },

      // Open search dialog
      openSearchDialog: siteMap.openSearchDialog,
      closeSearchDialog: siteMap.closeSearchDialog,
      updateBreadcrumb: siteMap.updateBreadcrumb,
    };

    // Handle browser navigation
    window.addEventListener("popstate", () => {
      appState.siteMapInstance.handleRoute(window.location.pathname + window.location.search);
    });

    appState.siteMapInstance.handleInitialRoute();
  },

  // Show loading animation during navigation
  showLoading: () => {
    const contentLoading = $byId(IDS.contentLoading);
    if (contentLoading) {
      contentLoading.classList.remove(CLASSES.hidden);
      setTimeout(() => {
        contentLoading.classList.add(CLASSES.hidden);
      }, 800);
    }
  },

  // Load home page
  loadHomePage: () => {
    if (appState.homePageManagerInstance) {
      const dynamicContent = $byId(IDS.dynamicContent);
      if (dynamicContent) {
        dynamicContent.innerHTML = "";
      }

      siteMap.showLoading();

      setTimeout(() => {
        appState.homePageManagerInstance.renderHomePage();
        appState.siteMapInstance.updateBreadcrumb([{
          text: "Home",
          type: "home",
          url: "/",
          active: true
        }]);
      }, 200);
    }
  },

  // Load artist page
  loadArtistPage: (artistData) => {
    const dynamicContent = $byId(IDS.dynamicContent);
    if (!dynamicContent) return;

    siteMap.showLoading();
    dynamicContent.innerHTML = "";

    setTimeout(() => {
      siteMap.renderArtistPage(artistData);
    }, 300);
  },

  // Load all artists page
  loadAllArtistsPage: () => {
    const dynamicContent = $byId(IDS.dynamicContent);
    if (!dynamicContent || !window.music) return;

    siteMap.showLoading();
    dynamicContent.innerHTML = "";

    setTimeout(() => {
      siteMap.renderAllArtistsPage();
    }, 300);
  },

  // Render artist albums section
  renderArtistAlbums: (artistData) => {
    const albumsContainer = $byId(IDS.albumsContainer);
    if (!albumsContainer) return;

    albumsContainer.innerHTML = `<h2 class="section-title text-2xl font-bold mb-6">Albums</h2>`;

    const albumsGrid = document.createElement("div");
    albumsGrid.className = "grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6";

    artistData.albums.forEach((album) => {
      const albumCard = document.createElement("div");
      albumCard.className = "album-card animate__animated animate__fadeIn";
      albumCard.style.animationDelay = "0.2s";
      albumCard.dataset.album = album.album;

      albumCard.innerHTML = render.album("card", {
        albumId: `${artistData.artist}-${album.album}`.replace(/\s+/g, "").toLowerCase(),
        album: album.album,
        cover: utils.getAlbumImageUrl(album.album),
        year: album.year || "Unknown",
        songCount: album.songs.length,
      });

      albumsGrid.appendChild(albumCard);
      siteMap.renderAlbumSongs(albumCard, album, artistData.artist);
    });

    albumsContainer.appendChild(albumsGrid);
  },

  // Handle song action buttons (favorite, queue, etc.)
  handleSongAction: (action, songData) => {
    switch (action) {
      case "favorite":
        appState.favorites.toggle("songs", songData.id);
        break;
      case "play-next":
        appState.queue.add(songData, 0);
        notifications.show("Added to play next");
        break;
      case "add-queue":
        appState.queue.add(songData);
        break;
      case "add-playlist":
        siteMap.showPlaylistSelector(songData);
        break;
      case "share":
        notifications.show("Share functionality coming soon");
        break;
    }
  },

  // Show playlist selector modal for adding songs
  showPlaylistSelector: (songData) => {
    if (appState.playlists.length === 0) {
      const createNew = confirm("No playlists found. Create a new playlist?");
      if (createNew) {
        const playlist = playlists.promptCreate();
        if (playlist) {
          playlists.addSong(playlist.id, songData);
        }
      }
      return;
    }

    const modal = document.createElement("div");
    modal.className = "fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center";
    modal.innerHTML = `
      <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4">
        <h3 class="text-xl font-bold mb-4">Add to Playlist</h3>
        <div class="space-y-2 max-h-64 overflow-y-auto">
          ${appState.playlists
            .map(
              (playlist) => `
            <button class="playlist-option w-full text-left p-3 rounded hover:bg-gray-700 transition-colors" data-playlist-id="${playlist.id}">
              <div class="font-medium">${playlist.name}</div>
              <div class="text-sm text-gray-400">${playlist.songs.length} songs</div>
            </button>
          `
            )
            .join("")}
        </div>
        <div class="flex gap-3 mt-6">
          <button class="create-new-playlist flex-1 bg-accent-primary text-white py-2 px-4 rounded hover:bg-accent-secondary transition-colors">
            Create New Playlist
          </button>
          <button class="cancel-playlist-modal bg-gray-600 text-white py-2 px-4 rounded hover:bg-gray-500 transition-colors">
            Cancel
          </button>
        </div>
      </div>
    `;

    document.body.appendChild(modal);

    // Bind modal events
    modal.querySelectorAll(".playlist-option").forEach((btn) => {
      btn.addEventListener("click", () => {
        const playlistId = btn.dataset.playlistId;
        playlists.addSong(playlistId, songData);
        document.body.removeChild(modal);
      });
    });

    modal.querySelector(".create-new-playlist").addEventListener("click", () => {
      const playlist = playlists.promptCreate();
      if (playlist) {
        playlists.addSong(playlist.id, songData);
      }
      document.body.removeChild(modal);
    });

    modal.querySelector(".cancel-playlist-modal").addEventListener("click", () => {
      document.body.removeChild(modal);
    });

    modal.addEventListener("click", (e) => {
      if (e.target === modal) {
        document.body.removeChild(modal);
      }
    });
  },

  // Play all songs by an artist
  playArtistSongs: (artistData) => {
    const allSongs = [];
    artistData.albums.forEach((album) => {
      album.songs.forEach((song) => {
        allSongs.push({
          ...song,
          artist: artistData.artist,
          album: album.album,
          cover: utils.getAlbumImageUrl(album.album),
        });
      });
    });

    if (allSongs.length > 0) {
      appState.queue.clear();
      allSongs.slice(1).forEach((song) => appState.queue.add(song));
      player.playSong(allSongs[0]);
    }
  },

  // Play all songs in an album
  playAlbumSongs: (album, artistName) => {
    if (album.songs.length === 0) return;

    appState.queue.clear();
    album.songs.slice(1).forEach((song) => {
      appState.queue.add({
        ...song,
        artist: artistName,
        album: album.album,
        cover: utils.getAlbumImageUrl(album.album),
      });
    });

    player.playSong({
      ...album.songs[0],
      artist: artistName,
      album: album.album,
      cover: utils.getAlbumImageUrl(album.album),
    });
  },

  // Render all artists page
  renderAllArtistsPage: () => {
    const dynamicContent = $byId(IDS.dynamicContent);
    if (!dynamicContent) return;

    dynamicContent.innerHTML = render.page("allArtists");

    const artistsGrid = $byId(IDS.artistsGrid);
    if (artistsGrid && window.music) {
      window.music.forEach((artist, index) => {
        const artistCard = document.createElement("div");
        artistCard.className = "animate__animated animate__fadeIn";
        artistCard.style.animationDelay = `${0.05 * index}s`;

        artistCard.innerHTML = render.artist("card", {
          id: artist.artist.replace(/\s+/g, "").toLowerCase(),
          artist: artist.artist,
          cover: utils.getArtistImageUrl(artist.artist),
          genre: artist.genre || "Various",
          albumCount: artist.albums.length,
        });

        artistsGrid.appendChild(artistCard);

        artistCard.querySelector(".artist-card").addEventListener("click", () => {
          appState.siteMapInstance.navigateTo(ROUTES.ARTIST, {
            artist: artist.artist
          });
        });
      });
    }

    appState.siteMapInstance.updateBreadcrumb([{
        text: "Home",
        type: "home",
        url: "/"
      },
      {
        text: "All Artists",
        type: "allArtists",
        url: "/artists",
        active: true
      },
    ]);

    siteMap.bindAllArtistsEvents();
  },

  // Bind events for all artists page
  bindAllArtistsEvents: () => {
    // Artist search functionality
    const artistSearch = $byId(IDS.artistSearch);
    if (artistSearch) {
      artistSearch.addEventListener("input", (e) => {
        const query = e.target.value.toLowerCase().trim();

        document.querySelectorAll(".artist-card").forEach((card) => {
          const artistName = card.querySelector("h3").textContent.toLowerCase();
          const genreTag = card.querySelector(".genre-tag")?.textContent.toLowerCase() || "";

          const matches = artistName.includes(query) || genreTag.includes(query);
          card.parentElement.style.display = matches ? "block" : "none";
        });
      });
    }

    // Genre filter functionality
    const genreFilters = $byId(IDS.genreFilters);
    if (genreFilters && window.music) {
      const genres = new Set();
      window.music.forEach((artist) => {
        if (artist.genre) genres.add(artist.genre);
      });

      genreFilters.innerHTML = "";
      Array.from(genres)
        .sort()
        .forEach((genre) => {
          const genreBtn = document.createElement("button");
          genreBtn.className = "px-3 py-1 text-xs font-medium rounded-full bg-bg-subtle hover:bg-bg-muted transition-colors";
          genreBtn.textContent = genre;

          genreBtn.addEventListener("click", () => {
            genreBtn.classList.toggle(CLASSES.active);
            genreBtn.classList.toggle("bg-accent-primary");
            genreBtn.classList.toggle("text-white");

            const activeFilters = Array.from(genreFilters.querySelectorAll("." + CLASSES.active)).map((btn) => btn.textContent.toLowerCase());

            document.querySelectorAll(".artist-card").forEach((card) => {
              const cardGenre = card.querySelector(".genre-tag")?.textContent.toLowerCase() || "";

              if (activeFilters.length === 0 || activeFilters.includes(cardGenre)) {
                card.parentElement.style.display = "block";
              } else {
                card.parentElement.style.display = "none";
              }
            });
          });

          genreFilters.appendChild(genreBtn);
        });
    }
  },

  // Get URL parameter by name
  getParameterByName: (name, url) => {
    name = name.replace(/[\[\]]/g, "\\$&");
    const regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)");
    const results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return "";
    return decodeURIComponent(results[2].replace(/\+/g, " "));
  },

  // Open search dialog - placeholder for future implementation
  openSearchDialog: () => {
    notifications.show("Search functionality coming soon");
  },

  // Close search dialog - placeholder for future implementation
  closeSearchDialog: () => {},

  // Update breadcrumb navigation
  updateBreadcrumb: (items) => {
    const breadcrumbList = document.querySelector(".breadcrumb-list");
    if (!breadcrumbList) return;

    breadcrumbList.innerHTML = "";

    items.forEach((item, index) => {
      if (index > 0) {
        const separator = document.createElement("li");
        separator.innerHTML = '<span class="text-gray-500">/</span>';
        breadcrumbList.appendChild(separator);
      }

      const breadcrumbItem = document.createElement("li");
      breadcrumbItem.innerHTML = item.active ? `<span class="text-accent-primary font-medium">${item.text}</span>` : `<a href="${item.url}" class="text-gray-400 hover:text-gray-200 transition-colors">${item.text}</a>`;
      breadcrumbList.appendChild(breadcrumbItem);
    });
  },

  // Render individual artist page
  renderArtistPage: (artistData) => {
    const dynamicContent = $byId(IDS.dynamicContent);
    if (!dynamicContent) return;

    dynamicContent.innerHTML = render.artist("enhancedArtist", {
      artist: artistData.artist,
      cover: utils.getArtistImageUrl(artistData.artist),
      genre: artistData.genre || "Various",
      albumCount: artistData.albums.length,
      songCount: utils.getTotalSongs(artistData),
    });

    siteMap.setupAlbumsSection(artistData);

    appState.siteMapInstance.updateBreadcrumb([{
        text: "Home",
        type: "home",
        url: "/"
      },
      {
        text: artistData.artist,
        type: "artist",
        url: `/artist/${encodeURIComponent(artistData.artist)}`,
        active: true
      },
    ]);

    siteMap.bindArtistPageEvents(artistData);
  },

  // Set up albums section with tab switching
  setupAlbumsSection: (artistData) => {
    const albumsContainer = $byId(IDS.albumsContainer);
    if (!albumsContainer || !artistData.albums.length) return;

    albumsContainer.innerHTML = `
      <div class="albums-section">
        <div class="albums-header mb-6">
          <h2 class="section-title text-2xl font-bold mb-4">Albums</h2>
          
          <div class="album-selector flex flex-wrap gap-2 mb-4">
            ${artistData.albums
              .map(
                (album, index) => `
              <button class="album-tab px-4 py-2 rounded-lg transition-all duration-300 ${index === 0 ? "active bg-accent-primary text-white" : "bg-gray-700 text-gray-300 hover:bg-gray-600"}" 
                      data-album-index="${index}" 
                      data-album-name="${album.album}">
                <div class="flex items-center gap-2">
                  <span class="album-tab-title">${album.album}</span>
                  <span class="album-tab-year text-xs opacity-75">${album.year || ""}</span>
                </div>
              </button>
            `
              )
              .join("")}
          </div>
        </div>
        
        <div class="current-album-container">
          <div id="current-album-display" class="transition-all duration-500 ease-in-out"></div>
        </div>
      </div>
    `;

    siteMap.displaySingleAlbum(artistData, 0);
    siteMap.bindAlbumSwitcher(artistData);
  },

  // Display single album with songs
  displaySingleAlbum: (artistData, albumIndex) => {
    const currentAlbumDisplay = $byId("current-album-display");
    if (!currentAlbumDisplay || !artistData.albums[albumIndex]) return;

    const album = artistData.albums[albumIndex];
    const albumId = `${artistData.artist}-${album.album}`.replace(/\s+/g, "").toLowerCase();

    currentAlbumDisplay.style.opacity = "0";
    currentAlbumDisplay.style.transform = "translateY(10px)";

    setTimeout(() => {
      currentAlbumDisplay.innerHTML = render.album("singleAlbumCard", {
        albumId: albumId,
        album: album.album,
        cover: utils.getAlbumImageUrl(album.album),
        year: album.year || "Unknown",
        songCount: album.songs.length,
      });

      siteMap.renderAlbumSongs(currentAlbumDisplay, album, artistData.artist);

      currentAlbumDisplay.style.opacity = "1";
      currentAlbumDisplay.style.transform = "translateY(0)";

      console.log(`Displayed album: ${album.album} with ${album.songs.length} songs`);
    }, 250);
  },

  // Bind album tab switching events
  bindAlbumSwitcher: (artistData) => {
    const albumTabs = document.querySelectorAll(".album-tab");

    albumTabs.forEach((tab) => {
      tab.addEventListener("click", (e) => {
        e.preventDefault();

        const albumIndex = parseInt(tab.dataset.albumIndex);
        const albumName = tab.dataset.albumName;

        albumTabs.forEach((t) => {
          t.classList.remove("active", "bg-accent-primary", "text-white");
          t.classList.add("bg-gray-700", "text-gray-300");
        });

        tab.classList.add("active", "bg-accent-primary", "text-white");
        tab.classList.remove("bg-gray-700", "text-gray-300");

        siteMap.displaySingleAlbum(artistData, albumIndex);
        console.log(`Switched to album: ${albumName}`);
      });
    });
  },

  // Render album songs list
  renderAlbumSongs: (albumContainer, album, artistName) => {
    const songsContainer = albumContainer.querySelector(".songs-container");
    if (!songsContainer) {
      console.warn("Songs container not found in album template");
      return;
    }

    songsContainer.innerHTML = "";

    if (!album.songs || album.songs.length === 0) {
      songsContainer.innerHTML = '<p class="text-gray-400 text-center py-4">No songs found in this album</p>';
      return;
    }

    album.songs.forEach((song, index) => {
      const songData = {
        ...song,
        artist: artistName,
        album: album.album,
        cover: utils.getAlbumImageUrl(album.album),
      };

      const songElement = create(
        render.track("row", {
          trackNumber: index + 1,
          title: song.title,
          duration: song.duration || "0:00",
          songData: songData,
        })
      );

      songsContainer.appendChild(songElement);
    });

    // Bind song events
    songsContainer.querySelectorAll(".song-item").forEach((songItem) => {
      songItem.addEventListener("click", (e) => {
        if (e.target.closest(".song-toolbar")) return;

        try {
          const songData = JSON.parse(songItem.dataset.song);
          player.playSong(songData);
          console.log(`Playing song: ${songData.title}`);
        } catch (error) {
          console.error("Error playing song:", error);
        }
      });

      // Bind action buttons
      songItem.querySelectorAll("[data-action]").forEach((actionBtn) => {
        actionBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          const action = actionBtn.dataset.action;
          const songData = JSON.parse(songItem.dataset.song);

          siteMap.handleSongAction(action, songData);
        });
      });
    });

    console.log(`Rendered ${album.songs.length} songs for album: ${album.album}`);
  },

  // Bind artist page events
  bindArtistPageEvents: (artistData) => {
    // Play artist button - plays all artist songs
    const playButton = document.querySelector(".artist-header .play");
    if (playButton) {
      playButton.addEventListener("click", () => {
        siteMap.playArtistSongs(artistData);
      });
    }

    // Follow/Favorite artist button
    const followButton = document.querySelector(".artist-header .follow");
    if (followButton) {
      const isFavorite = appState.favorites.has("artists", artistData.artist);
      followButton.textContent = isFavorite ? "Unfavorite" : "Favorite";
      followButton.classList.toggle(CLASSES.active, isFavorite);

      followButton.addEventListener("click", () => {
        const wasFavorite = appState.favorites.toggle("artists", artistData.artist);
        followButton.textContent = wasFavorite ? "Unfavorite" : "Favorite";
        followButton.classList.toggle(CLASSES.active, wasFavorite);
      });
    }

    // Album play button (for the currently displayed album)
    document.addEventListener("click", (e) => {
      const playAlbumBtn = e.target.closest(".play-album");
      if (playAlbumBtn) {
        e.stopPropagation();

        const activeTab = document.querySelector(".album-tab.active");
        if (activeTab) {
          const albumIndex = parseInt(activeTab.dataset.albumIndex);
          const album = artistData.albums[albumIndex];
          if (album) {
            siteMap.playAlbumSongs(album, artistData.artist);
          }
        }
      }
    });
  },
};

// Home page management system
const homePage = {
  // Initialize home page manager
  initialize: () => {
    appState.homePageManagerInstance = {
      renderHomePage: homePage.render,
    };
  },

  // Render complete home page
  render: () => {
    const dynamicContent = $byId(IDS.dynamicContent);
    if (!dynamicContent) return;

    dynamicContent.innerHTML = "";

    dynamicContent.innerHTML = `
      <div class="home-page-header text-center py-8 md:py-12">
        <h1 class="text-4xl md:text-5xl font-bold mb-6 gradient-text">Your Music Universe</h1>
        <p class="text-lg md:text-xl text-gray-400 mb-8 md:mb-12 max-w-2xl mx-auto">Discover your personal collection with an immersive listening experience</p>
      </div>
      
      <div class="bento-grid px-4 md:px-6 gap-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
        <div class="bento-card col-span-full md:col-span-1">
          <div class="card-header">
            <h2 class="text-xl font-bold">Recently Played</h2>
            <a href="#" class="text-blue-400 hover:text-blue-300 text-sm" data-view="recent">View All</a>
          </div>
          <div id="${IDS.recentlyPlayedSection}" class="card-content">
            <div class="skeleton-loader"></div>
          </div>
        </div>
        
        <div class="bento-card col-span-full md:col-span-2">
          <div class="card-header">
            <h2 class="text-xl font-bold">Discover Albums</h2>
            <a href="#" class="text-blue-400 hover:text-blue-300 text-sm" data-view="albums">Explore More</a>
          </div>
          <div id="${IDS.randomAlbumsSection}" class="card-content">
            <div class="skeleton-loader"></div>
          </div>
        </div>
        
        <div class="bento-card col-span-full md:col-span-1">
          <div class="card-header">
            <h2 class="text-xl font-bold">Favorite Artists</h2>
            <a href="#" class="text-blue-400 hover:text-blue-300 text-sm" data-view="favorite-artists">View All</a>
          </div>
          <div id="${IDS.favoriteArtistsSection}" class="card-content">
            <div class="skeleton-loader"></div>
          </div>
        </div>
        
        <div class="bento-card col-span-full md:col-span-1">
          <div class="card-header">
            <h2 class="text-xl font-bold">Your Playlists</h2>
            <a href="#" class="text-blue-400 hover:text-blue-300 text-sm" data-view="playlists">View All</a>
          </div>
          <div id="${IDS.playlistsSection}" class="card-content">
            <div class="skeleton-loader"></div>
          </div>
        </div>
        
        <div class="bento-card col-span-full md:col-span-1">
          <div class="card-header">
            <h2 class="text-xl font-bold">Favorite Songs</h2>
            <a href="#" class="text-blue-400 hover:text-blue-300 text-sm" data-view="favorite-songs">View All</a>
          </div>
          <div id="${IDS.favoriteSongsSection}" class="card-content">
            <div class="skeleton-loader"></div>
          </div>
        </div>
      </div>
    `;

    homePage.addStyles();

    // Staggered rendering for better UX
    setTimeout(() => homePage.renderRecentlyPlayed(), 100);
    setTimeout(() => homePage.renderRandomAlbums(), 300);
    setTimeout(() => homePage.renderFavoriteArtists(), 500);
    setTimeout(() => homePage.renderPlaylists(), 700);
    setTimeout(() => homePage.renderFavoriteSongs(), 900);

    homePage.bindEvents();
  },

  // Add custom CSS styles for home page
  addStyles: () => {
    if ($byId("bento-grid-styles")) return;

    const styleEl = document.createElement("style");
    styleEl.id = "bento-grid-styles";
    styleEl.textContent = `
      .bento-grid {
        display: grid;
        gap: 1.5rem;
      }
      
      .bento-card {
        background: rgba(30, 41, 59, 0.5);
        border-radius: 1rem;
        padding: 1.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      
      .bento-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }
      
      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }
      
      .card-content {
        min-height: 200px;
      }
      
      .skeleton-loader {
        height: 200px;
        background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
        border-radius: 0.5rem;
      }
      
      @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
      }
      
      .recent-tracks, .album-grid, .artist-grid, .playlists-list {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }
      
      .recent-track, .playlist-card {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.5rem;
        border-radius: 0.5rem;
        background: rgba(255, 255, 255, 0.05);
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
      }
      
      .recent-track:hover, .playlist-card:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateY(-2px);
      }
      
      .track-art, .artist-avatar {
        width: 40px;
        height: 40px;
        border-radius: 0.25rem;
        object-fit: cover;
        flex-shrink: 0;
      }
      
      .artist-avatar {
        border-radius: 50%;
      }
      
      .track-info, .playlist-info {
        flex: 1;
        min-width: 0;
      }
      
      .track-title, .playlist-name {
        font-weight: 500;
        margin-bottom: 0.125rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      
      .track-artist, .playlist-tracks {
        font-size: 0.875rem;
        color: rgba(255, 255, 255, 0.7);
        cursor: pointer;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      
      .track-artist:hover {
        color: rgba(255, 255, 255, 0.9);
        text-decoration: underline;
      }
      
      .album-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 1rem;
      }
      
      .album-card {
        text-align: center;
        cursor: pointer;
        transition: transform 0.2s ease;
        position: relative;
      }
      
      .album-card:hover {
        transform: scale(1.05);
      }
      
      .album-cover {
        width: 100%;
        aspect-ratio: 1;
        border-radius: 0.5rem;
        object-fit: cover;
        margin-bottom: 0.5rem;
        position: relative;
      }
      
      .album-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.2s ease;
        border-radius: 0.5rem;
        margin-bottom: 0.5rem;
      }
      
      .album-card:hover .album-overlay {
        opacity: 1;
      }
      
      .album-play-btn {
        width: 3rem;
        height: 3rem;
        background: rgba(59, 130, 246, 0.9);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      
      .album-play-btn:hover {
        transform: scale(1.1);
        background: rgba(59, 130, 246, 1);
      }
      
      .album-play-btn svg {
        width: 1.2rem;
        height: 1.2rem;
      }
      
      .album-info {
        font-size: 0.875rem;
      }
      
      .album-title {
        font-weight: 500;
        margin-bottom: 0.125rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      
      .album-artist {
        color: rgba(255, 255, 255, 0.7);
        cursor: pointer;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      
      .album-artist:hover {
        color: rgba(255, 255, 255, 0.9);
        text-decoration: underline;
      }
      
      .artist-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 1rem;
      }
      
      .artist-card {
        text-align: center;
        cursor: pointer;
        transition: transform 0.2s ease;
      }
      
      .artist-card:hover {
        transform: scale(1.05);
      }
      
      .artist-name {
        font-size: 0.875rem;
        font-weight: 500;
        margin-top: 0.5rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      
      .create-playlist-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem;
        border-radius: 0.5rem;
        background: rgba(59, 130, 246, 0.1);
        border: 1px dashed rgba(59, 130, 246, 0.3);
        color: rgb(59, 130, 246);
        cursor: pointer;
        transition: all 0.2s ease;
        width: 100%;
        margin-top: 0.5rem;
        text-align: center;
        justify-content: center;
      }
      
      .create-playlist-btn:hover {
        background: rgba(59, 130, 246, 0.2);
        border-color: rgba(59, 130, 246, 0.5);
        transform: translateY(-1px);
      }
      
      .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: rgba(255, 255, 255, 0.5);
        font-size: 0.875rem;
        text-align: center;
        padding: 2rem 1rem;
      }
      
      .empty-state svg {
        margin-bottom: 1rem;
        opacity: 0.6;
      }
      
      .play-button-overlay {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        opacity: 0;
        transition: opacity 0.2s ease;
        background: rgba(59, 130, 246, 0.9);
        border-radius: 50%;
        width: 2rem;
        height: 2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
      }
      
      .recent-track:hover .play-button-overlay,
      .artist-card:hover .play-button-overlay {
        opacity: 1;
      }
      
      .animate-fade-in {
        animation: fadeIn 0.3s ease-in;
      }
      
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
    `;
    document.head.appendChild(styleEl);
  },

  // Render recently played section
  renderRecentlyPlayed: () => {
    const container = $byId(IDS.recentlyPlayedSection);
    if (!container) return;

    if (!appState.recentlyPlayed || appState.recentlyPlayed.length === 0) {
      container.innerHTML = homePage.renderEmptyState("No recently played tracks", "music-note");
      return;
    }

    const recentTracks = appState.recentlyPlayed.slice(0, 5);

    let html = `<div class="recent-tracks animate-fade-in">`;

    recentTracks.forEach((track, index) => {
      html += `
        <div class="recent-track" data-song='${JSON.stringify(track).replace(/"/g, "&quot;")}' style="animation-delay: ${index * 100}ms;">
          <img src="${utils.getAlbumImageUrl(track.album)}" alt="${track.title}" class="track-art">
          <div class="track-info">
            <div class="track-title">${track.title}</div>
            <div class="track-artist" data-artist="${track.artist}">${track.artist}</div>
          </div>
          <div class="play-button-overlay">
            ${ICONS.play}
          </div>
        </div>
      `;
    });

    html += `</div>`;
    container.innerHTML = html;

    // Bind events for track playing and artist navigation
    container.querySelectorAll(".recent-track").forEach((track) => {
      track.addEventListener("click", (e) => {
        if (e.target.closest(".track-artist")) return;

        try {
          const songData = JSON.parse(track.dataset.song);
          player.playSong(songData);
        } catch (error) {
          console.error("Error playing track:", error);
        }
      });
    });

    // Artist navigation events
    container.querySelectorAll(".track-artist").forEach((artistEl) => {
      artistEl.addEventListener("click", (e) => {
        e.stopPropagation();
        const artistName = artistEl.dataset.artist;
        if (appState.siteMapInstance) {
          appState.siteMapInstance.navigateTo(ROUTES.ARTIST, {
            artist: artistName
          });
        }
      });
    });
  },

  // Render random albums section
  renderRandomAlbums: () => {
    const container = $byId(IDS.randomAlbumsSection);
    if (!container) return;

    const albums = homePage.getRandomAlbums(6);

    if (!albums || albums.length === 0) {
      container.innerHTML = homePage.renderEmptyState("No albums found", "album");
      return;
    }

    let html = `<div class="album-grid animate-fade-in">`;

    albums.forEach((album, index) => {
      html += `
        <div class="album-card" style="animation-delay: ${index * 100}ms;" data-artist="${album.artist}" data-album="${album.album}">
          <div style="position: relative;">
            <img src="${utils.getAlbumImageUrl(album.album)}" alt="${album.album}" class="album-cover">
            <div class="album-overlay">
              <button class="album-play-btn" data-artist="${album.artist}" data-album="${album.album}">
                ${ICONS.play}
              </button>
            </div>
          </div>
          <div class="album-info">
            <div class="album-title">${album.album}</div>
            <div class="album-artist" data-artist="${album.artist}">${album.artist}</div>
          </div>
        </div>
      `;
    });

    html += `</div>`;
    container.innerHTML = html;

    // Album play functionality
    container.querySelectorAll(".album-play-btn").forEach((playBtn) => {
      playBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        const artistName = playBtn.dataset.artist;
        const albumName = playBtn.dataset.album;
        homePage.playAlbum(artistName, albumName);
      });
    });

    // Album click to play
    container.querySelectorAll(".album-card").forEach((albumCard) => {
      albumCard.addEventListener("click", (e) => {
        if (e.target.closest(".album-play-btn") || e.target.closest(".album-artist")) return;

        const artistName = albumCard.dataset.artist;
        const albumName = albumCard.dataset.album;
        homePage.playAlbum(artistName, albumName);
      });
    });

    // Artist navigation
    container.querySelectorAll(".album-artist").forEach((artistEl) => {
      artistEl.addEventListener("click", (e) => {
        e.stopPropagation();
        const artistName = artistEl.dataset.artist;
        if (appState.siteMapInstance) {
          appState.siteMapInstance.navigateTo(ROUTES.ARTIST, {
            artist: artistName
          });
        }
      });
    });
  },

  // Render favorite artists section
  renderFavoriteArtists: () => {
    const container = $byId(IDS.favoriteArtistsSection);
    if (!container) return;

    if (!appState.favorites.artists || appState.favorites.artists.size === 0) {
      container.innerHTML = homePage.renderEmptyState("No favorite artists", "artist");
      return;
    }

    const artists = Array.from(appState.favorites.artists).slice(0, 6);

    let html = `<div class="artist-grid animate-fade-in">`;

    artists.forEach((artistName, index) => {
      const artistData = window.music?.find((a) => a.artist === artistName);
      if (!artistData) return;

      html += `
        <div class="artist-card" data-artist="${artistName}" style="animation-delay: ${index * 100}ms;">
          <div style="position: relative;">
            <img src="${utils.getArtistImageUrl(artistName)}" alt="${artistName}" class="artist-avatar">
            <div class="play-button-overlay">
              ${ICONS.play}
            </div>
          </div>
          <div class="artist-name">${artistName}</div>
        </div>
      `;
    });

    html += `</div>`;
    container.innerHTML = html;

    // Artist navigation and play functionality
    container.querySelectorAll(".artist-card").forEach((artistEl) => {
      artistEl.addEventListener("click", () => {
        const artistName = artistEl.dataset.artist;
        if (appState.siteMapInstance) {
          appState.siteMapInstance.navigateTo(ROUTES.ARTIST, {
            artist: artistName
          });
        }
      });
    });
  },

  // Render playlists section
  renderPlaylists: () => {
    const container = $byId(IDS.playlistsSection);
    if (!container) return;

    let html = "";

    if (!appState.playlists || appState.playlists.length === 0) {
      html = homePage.renderEmptyState("No playlists yet", "playlist");
    } else {
      html = `<div class="playlists-list animate-fade-in">`;

      const displayPlaylists = appState.playlists.slice(0, 3);

      displayPlaylists.forEach((playlist, index) => {
        html += `
          <div class="playlist-card" data-playlist-id="${playlist.id}" style="animation-delay: ${index * 100}ms;">
            <div class="playlist-icon" style="width: 40px; height: 40px; background: linear-gradient(45deg, #6366f1, #8b5cf6); border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="20" height="20">
                <path d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v2H3v-2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"/>
              </svg>
            </div>
            <div class="playlist-info">
              <div class="playlist-name">${playlist.name}</div>
              <div class="playlist-tracks">${playlist.songs?.length || 0} track${playlist.songs?.length !== 1 ? "s" : ""}</div>
            </div>
            <div class="play-button-overlay">
              ${ICONS.play}
            </div>
          </div>
        `;
      });

      html += `</div>`;
    }

    html += `
      <button class="create-playlist-btn">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
        </svg>
        Create Playlist
      </button>
    `;

    container.innerHTML = html;

    // Playlist functionality
    container.querySelectorAll(".playlist-card").forEach((playlistEl) => {
      playlistEl.addEventListener("click", () => {
        const playlistId = playlistEl.dataset.playlistId;
        playlists.show(playlistId);
      });
    });

    const createBtn = container.querySelector(".create-playlist-btn");
    if (createBtn) {
      createBtn.addEventListener("click", () => {
        const newPlaylist = playlists.create();
        if (newPlaylist) {
          setTimeout(() => homePage.renderPlaylists(), 100);
        }
      });
    }
  },

  // Render favorite songs section
  renderFavoriteSongs: () => {
    const container = $byId(IDS.favoriteSongsSection);
    if (!container) return;

    if (!appState.favorites.songs || appState.favorites.songs.size === 0) {
      container.innerHTML = homePage.renderEmptyState("No favorite songs", "heart");
      return;
    }

    const songs = homePage.getSongsByIds(Array.from(appState.favorites.songs).slice(0, 5));

    let html = `<div class="recent-tracks animate-fade-in">`;

    songs.forEach((song, index) => {
      html += `
        <div class="recent-track" data-song='${JSON.stringify(song).replace(/"/g, "&quot;")}' style="animation-delay: ${index * 100}ms;">
          <img src="${utils.getAlbumImageUrl(song.album)}" alt="${song.title}" class="track-art">
          <div class="track-info">
            <div class="track-title">${song.title}</div>
            <div class="track-artist" data-artist="${song.artist}">${song.artist}</div>
          </div>
          <div class="play-button-overlay">
            ${ICONS.play}
          </div>
          <button class="favorite-heart" data-song-id="${song.id}" style="position: absolute; top: 0.5rem; right: 0.5rem; color: #ef4444; opacity: 0.8; background: none; border: none; cursor: pointer;">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
              <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
            </svg>
          </button>
        </div>
      `;
    });

    html += `</div>`;
    container.innerHTML = html;

    // Favorite songs functionality
    container.querySelectorAll(".recent-track").forEach((track) => {
      track.addEventListener("click", (e) => {
        if (e.target.closest(".track-artist") || e.target.closest(".favorite-heart")) return;

        try {
          const songData = JSON.parse(track.dataset.song);
          player.playSong(songData);
        } catch (error) {
          console.error("Error playing track:", error);
        }
      });
    });

    // Artist navigation
    container.querySelectorAll(".track-artist").forEach((artistEl) => {
      artistEl.addEventListener("click", (e) => {
        e.stopPropagation();
        const artistName = artistEl.dataset.artist;
        if (appState.siteMapInstance) {
          appState.siteMapInstance.navigateTo(ROUTES.ARTIST, {
            artist: artistName
          });
        }
      });
    });

    // Favorite heart functionality
    container.querySelectorAll(".favorite-heart").forEach((heartBtn) => {
      heartBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        const songId = heartBtn.dataset.songId;
        appState.favorites.remove("songs", songId);

        const track = heartBtn.closest(".recent-track");
        track.style.transition = "all 0.3s ease";
        track.style.opacity = "0";
        track.style.transform = "translateX(-20px)";

        setTimeout(() => {
          track.remove();
          const remaining = container.querySelectorAll(".recent-track");
          if (remaining.length === 0) {
            homePage.renderFavoriteSongs();
          }
        }, 300);
      });
    });
  },

  // Bind home page view navigation events
  bindEvents: () => {
    document.querySelectorAll("[data-view]").forEach((link) => {
      link.addEventListener("click", (e) => {
        e.preventDefault();
        const view = link.dataset.view;

        switch (view) {
          case "recent":
            popup.open();
            setTimeout(() => popup.switchTab("recent"), 50);
            break;
          case "albums":
            notifications.show("Albums view coming soon");
            break;
          case "favorite-artists":
            views.showFavoriteArtists();
            break;
          case "playlists":
            playlists.showAll();
            break;
          case "favorite-songs":
            views.showFavoriteSongs();
            break;
          default:
            notifications.show("View coming soon");
        }
      });
    });
  },

  // Get random albums for display
  getRandomAlbums: (count = 6) => {
    if (!window.music) return [];

    const allAlbums = [];
    window.music.forEach((artist) => {
      artist.albums.forEach((album) => {
        allAlbums.push({
          artist: artist.artist,
          album: album.album,
          cover: utils.getAlbumImageUrl(album.album),
          songs: album.songs,
        });
      });
    });

    const shuffled = [...allAlbums].sort(() => 0.5 - Math.random());
    return shuffled.slice(0, count);
  },

  // Get songs by their IDs
  getSongsByIds: (ids) => {
    if (!window.music || !ids.length) return [];

    const songs = [];

    window.music.forEach((artist) => {
      artist.albums.forEach((album) => {
        album.songs.forEach((song) => {
          if (ids.includes(song.id)) {
            songs.push({
              ...song,
              artist: artist.artist,
              album: album.album,
              cover: utils.getAlbumImageUrl(album.album),
            });
          }
        });
      });
    });

    return songs;
  },

  // Play entire album
  playAlbum: (artistName, albumName) => {
    if (!window.music) return;

    const artist = window.music.find((a) => a.artist === artistName);
    if (!artist) return;

    const album = artist.albums.find((a) => a.album === albumName);
    if (!album || album.songs.length === 0) return;

    appState.queue.clear();

    album.songs.slice(1).forEach((song) => {
      appState.queue.add({
        ...song,
        artist: artistName,
        album: albumName,
        cover: utils.getAlbumImageUrl(albumName),
      });
    });

    player.playSong({
      ...album.songs[0],
      artist: artistName,
      album: albumName,
      cover: utils.getAlbumImageUrl(albumName),
    });

    notifications.show(`Playing album "${albumName}"`, NOTIFICATION_TYPES.SUCCESS);
  },

  // Render empty state for sections
  renderEmptyState: (message, iconType) => {
    const icons = {
      "music-note": '<path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>',
      album: '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14.5c-2.49 0-4.5-2.01-4.5-4.5S9.51 7.5 12 7.5s4.5 2.01 4.5 4.5-2.01 4.5-4.5 4.5zm0-5.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"/>',
      artist: '<path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>',
      playlist: '<path d="M14 10H2v2h12v-2zm0-4H2v2h12V6zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zM2 16h8v-2H2v2z"/>',
      heart: '<path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>',
    };

    return `
      <div class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-12 h-12 mb-3 opacity-50">
          ${icons[iconType] || icons["music-note"]}
        </svg>
        <p>${message}</p>
      </div>
    `;
  },
};

// Main application controller - CRITICAL for initialization
const app = {
  // Initialize entire application with all systems
  initialize: () => {
    console.log("Initializing MyTunes app...");

    // Set global music reference
    window.music = music;

    // Initialize core systems in proper order
    storage.initialize(); // Load saved data first
    theme.initialize(); // Apply saved theme
    notifications.initialize(); // Set up notification system
    player.initialize(); // Initialize audio player

    // Initialize UI managers
    siteMap.initialize(); // Set up navigation system
    homePage.initialize(); // Set up home page manager

    // Bind all event handlers - CRITICAL for functionality
    eventHandlers.init();

    // Reset and sync UI state
    app.resetUI();
    app.syncGlobalState();

    console.log("MyTunes app initialized successfully");
  },

  // Reset UI to clean state
  resetUI: () => {
    const nowPlayingArea = $byId(IDS.nowPlayingArea);
    if (nowPlayingArea) {
      nowPlayingArea.classList.remove(CLASSES.hasSong);
    }
    ui.updateCounts();
  },

  // Expose API for external access and debugging
  syncGlobalState: () => {
    window.appState = appState;
    window.playerController = {
      playSong: player.playSong,
      toggle: player.toggle,
      next: controls.next,
      previous: controls.previous,
      seekTo: controls.seekTo,
      skip: controls.skip(),
    };
    window.musicAppAPI = {
      player,
      controls,
      ui,
      popup,
      dropdown,
      theme,
      notifications,
      playlists,
      utils,
      favorites: appState.favorites,
      queue: appState.queue,
      views,
      siteMap,
      homePage,
    };
  },

  // Helper method to navigate back to home
  goHome: () => {
    if (appState.siteMapInstance) {
      appState.siteMapInstance.navigateTo(ROUTES.HOME);
    }
  },
};

// Application initialization - CRITICAL startup sequence
document.addEventListener("DOMContentLoaded", () => {
  app.initialize();
});

// Fallback initialization on window load
window.addEventListener("load", () => {
  if (!window.appState) {
    app.initialize();
  }
});

// Global application interface for external access
window.MyTunesApp = {
  initialize: app.initialize,
  state: () => appState,
  api: () => window.musicAppAPI,
  goHome: app.goHome,
};

// Auto-initialize if music library is already loaded
if (window.music) {
  app.initialize();
}

// Debug function for troubleshooting - can be called from browser console
window.debugMusicPlayer = () => {
  console.log("=== MUSIC PLAYER DEBUG INFO ===");
  console.log("Current song:", appState.currentSong);
  console.log("Is popup visible:", appState.isPopupVisible);
  console.log("Is playing:", appState.isPlaying);

  const musicPlayer = $byId(IDS.musicPlayer);
  console.log("Music player element exists:", !!musicPlayer);
  if (musicPlayer) {
    console.log("Music player classes:", musicPlayer.className);
    console.log("Music player style display:", musicPlayer.style.display);
  }

  const nowPlayingArea = $byId(IDS.nowPlayingArea);
  console.log("Now playing area exists:", !!nowPlayingArea);
  if (nowPlayingArea) {
    console.log("Now playing area classes:", nowPlayingArea.className);
  }

  const albumArtwork = $byId(NAVBAR.albumArtwork);
  console.log("Navbar album cover exists:", !!albumArtwork);
  if (albumArtwork) {
    console.log("Navbar album cover src:", albumArtwork.src);
  }

  console.log("Audio element:", appState.audio);
  console.log("=== END DEBUG INFO ===");
};
</script>




</body>
</html>